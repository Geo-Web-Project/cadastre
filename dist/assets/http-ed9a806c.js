import{p as a,q as f,r as C,t as A,u as E}from"./index-64320997.js";function D(t){if(typeof t!="string")throw new Error(`Cannot safe json parse value of type ${typeof t}`);try{return JSON.parse(t)}catch{return t}}function l(t){return typeof t=="string"?t:JSON.stringify(t)}const I="PARSE_ERROR",M="INVALID_REQUEST",j="METHOD_NOT_FOUND",$="INVALID_PARAMS",w="INTERNAL_ERROR",h="SERVER_ERROR",U=[-32700,-32600,-32601,-32602,-32603],u={[I]:{code:-32700,message:"Parse error"},[M]:{code:-32600,message:"Invalid Request"},[j]:{code:-32601,message:"Method not found"},[$]:{code:-32602,message:"Invalid params"},[w]:{code:-32603,message:"Internal error"},[h]:{code:-32e3,message:"Server error"}},T=h;function x(t){return U.includes(t)}function p(t){return Object.keys(u).includes(t)?u[t]:u[T]}function H(t){const e=Object.values(u).find(n=>n.code===t);return e||u[T]}var J={},i={},g;function V(){if(g)return i;g=1,Object.defineProperty(i,"__esModule",{value:!0}),i.isBrowserCryptoAvailable=i.getSubtleCrypto=i.getBrowerCrypto=void 0;function t(){return(a===null||a===void 0?void 0:a.crypto)||(a===null||a===void 0?void 0:a.msCrypto)||{}}i.getBrowerCrypto=t;function e(){const s=t();return s.subtle||s.webkitSubtle}i.getSubtleCrypto=e;function n(){return!!t()&&!!e()}return i.isBrowserCryptoAvailable=n,i}var c={},v;function B(){if(v)return c;v=1,Object.defineProperty(c,"__esModule",{value:!0}),c.isBrowser=c.isNode=c.isReactNative=void 0;function t(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}c.isReactNative=t;function e(){return typeof f.process<"u"&&typeof f.process.versions<"u"&&typeof f.process.versions.node<"u"}c.isNode=e;function n(){return!t()&&!e()}return c.isBrowser=n,c}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=C;e.__exportStar(V(),t),e.__exportStar(B(),t)})(J);function b(t=3){const e=Date.now()*Math.pow(10,t),n=Math.floor(Math.random()*Math.pow(10,t));return e+n}function F(t=6){return BigInt(b(t))}function q(t,e,n){return{id:n||b(),jsonrpc:"2.0",method:t,params:e}}function Re(t,e){return{id:t,jsonrpc:"2.0",result:e}}function Ee(t,e,n){return{id:t,jsonrpc:"2.0",error:k(e,n)}}function k(t,e){return typeof t>"u"?p(w):(typeof t=="string"&&(t=Object.assign(Object.assign({},p(h)),{message:t})),typeof e<"u"&&(t.data=e),x(t.code)&&(t=H(t.code)),t)}class Q{}class G extends Q{constructor(){super()}}class X extends G{constructor(e){super()}}function P(t){return typeof t=="object"&&"id"in t&&"jsonrpc"in t&&t.jsonrpc==="2.0"}function le(t){return P(t)&&"method"in t}function W(t){return P(t)&&(z(t)||S(t))}function z(t){return"result"in t}function S(t){return"error"in t}class pe extends X{constructor(e){super(e),this.events=new A.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,n){this.events.on(e,n)}once(e,n){this.events.once(e,n)}off(e,n){this.events.off(e,n)}removeListener(e,n){this.events.removeListener(e,n)}async request(e,n){return this.requestStrict(q(e.method,e.params||[],e.id||F().toString()),n)}async requestStrict(e,n){return new Promise(async(s,o)=>{if(!this.connection.connected)try{await this.open()}catch(r){o(r)}this.events.on(`${e.id}`,r=>{S(r)?o(r.error):s(r.result)});try{await this.connection.send(e,n)}catch(r){o(r)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),W(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}onClose(e){e&&e.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${e.code} ${e.reason?`(${e.reason})`:""}`)),this.events.emit("disconnect")}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),typeof e=="string"&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",e=>this.onClose(e)),this.connection.on("error",e=>this.events.emit("error",e)),this.connection.on("register_error",e=>this.onClose()),this.hasRegisteredEventListeners=!0)}}const K="PARSE_ERROR",Y="INVALID_REQUEST",Z="METHOD_NOT_FOUND",ee="INVALID_PARAMS",N="INTERNAL_ERROR",R="SERVER_ERROR",te=[-32700,-32600,-32601,-32602,-32603],d={[K]:{code:-32700,message:"Parse error"},[Y]:{code:-32600,message:"Invalid Request"},[Z]:{code:-32601,message:"Method not found"},[ee]:{code:-32602,message:"Invalid params"},[N]:{code:-32603,message:"Internal error"},[R]:{code:-32e3,message:"Server error"}},L=R;function ne(t){return te.includes(t)}function m(t){return Object.keys(d).includes(t)?d[t]:d[L]}function se(t){const e=Object.values(d).find(n=>n.code===t);return e||d[L]}function re(t,e,n){return t.message.includes("getaddrinfo ENOTFOUND")||t.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${n} RPC url at ${e}`):t}function oe(t,e,n){return{id:t,jsonrpc:"2.0",error:ie(e,n)}}function ie(t,e){return typeof t>"u"?m(N):(typeof t=="string"&&(t=Object.assign(Object.assign({},m(R)),{message:t})),typeof e<"u"&&(t.data=e),ne(t.code)&&(t=se(t.code)),t)}const ce="^https?:";function ae(t){const e=t.match(new RegExp(/^\w+:/,"gi"));if(!(!e||!e.length))return e[0]}function ue(t,e){const n=ae(t);return typeof n>"u"?!1:new RegExp(e).test(n)}function _(t){return ue(t,ce)}const de={Accept:"application/json","Content-Type":"application/json"},fe="POST",y={headers:de,method:fe},O=10;class ge{constructor(e,n=!1){if(this.url=e,this.disableProviderPing=n,this.events=new A.EventEmitter,this.isAvailable=!1,this.registering=!1,!_(e))throw new Error(`Provided URL is not compatible with HTTP connection: ${e}`);this.url=e,this.disableProviderPing=n}get connected(){return this.isAvailable}get connecting(){return this.registering}on(e,n){this.events.on(e,n)}once(e,n){this.events.once(e,n)}off(e,n){this.events.off(e,n)}removeListener(e,n){this.events.removeListener(e,n)}async open(e=this.url){await this.register(e)}async close(){if(!this.isAvailable)throw new Error("Connection already closed");this.onClose()}async send(e,n){this.isAvailable||await this.register();try{const s=l(e),r=await(await E(this.url,Object.assign(Object.assign({},y),{body:s}))).json();this.onPayload({data:r})}catch(s){this.onError(e.id,s)}}async register(e=this.url){if(!_(e))throw new Error(`Provided URL is not compatible with HTTP connection: ${e}`);if(this.registering){const n=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=n||this.events.listenerCount("open")>=n)&&this.events.setMaxListeners(n+1),new Promise((s,o)=>{this.events.once("register_error",r=>{this.resetMaxListeners(),o(r)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.isAvailable>"u")return o(new Error("HTTP connection is missing or invalid"));s()})})}this.url=e,this.registering=!0;try{if(!this.disableProviderPing){const n=l({id:1,jsonrpc:"2.0",method:"test",params:[]});await E(e,Object.assign(Object.assign({},y),{body:n}))}this.onOpen()}catch(n){const s=this.parseError(n);throw this.events.emit("register_error",s),this.onClose(),s}}onOpen(){this.isAvailable=!0,this.registering=!1,this.events.emit("open")}onClose(){this.isAvailable=!1,this.registering=!1,this.events.emit("close")}onPayload(e){if(typeof e.data>"u")return;const n=typeof e.data=="string"?D(e.data):e.data;this.events.emit("payload",n)}onError(e,n){const s=this.parseError(n),o=s.message||s.toString(),r=oe(e,o);this.events.emit("payload",r)}parseError(e,n=this.url){return re(e,n,"HTTP")}resetMaxListeners(){this.events.getMaxListeners()>O&&this.events.setMaxListeners(O)}}export{ge as H,pe as J,l as a,W as b,J as c,Re as d,z as e,Ee as f,S as g,q as h,le as i,F as j,b as p,D as s};
