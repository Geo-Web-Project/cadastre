import{q as jt,Q as Sp,r as zi,T as G,t as Zt,U as xp,V as O1,p as lo,v as Ap,W as zr,X as R1,Y as N1,Z as M,$ as T1,a0 as Iu,a1 as j1,a2 as z1,a3 as q1,a4 as Op,a5 as F1,a6 as L1,a7 as U1,a8 as Rp,a9 as M1,aa as $1,ab as qi,ac as Np,ad as k1,ae as B1,S as Pu,af as Tp,ag as Vt,ah as V1,ai as jp,aj as Bn,ak as ze,al as Xe,am as qr,an as gt,ao as H1,ap as Vn,aq as zp,ar as K1,as as G1,at as W1,au as qp,av as Q1,aw as Fp,ax as Lp,ay as Y1,az as Hn,aA as Su,aB as po,aC as Kn,aD as J1,aE as fo,aF as X1,aG as Z1,aH as e8,aI as t8,aJ as go,aK as r8,aL as n8,aM as xu,aN as Up,aO as i8,aP as s8,aQ as o8,aR as Mp,aS as a8,aT as u8,aU as c8,aV as h8,aW as l8,aX as p8,aY as f8,aZ as Fi,a_ as $p,a$ as Au,b0 as d8,b1 as g8,_ as D8,__tla as v8}from"./index-64320997.js";import{a as Ou,s as kp,c as y8,J as Dr,i as Ru,b as Nu,d as Tu,f as Bp,e as Fr,g as vr,h as Li,j as m8,p as w8,H as Lr}from"./http-ed9a806c.js";let Vp,ju,zu,Ui,Mi,Do,b8=Promise.all([(()=>{try{return v8}catch{}})()]).then(async()=>{const Kp=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,Gp=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,Wp=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function Qp(o,n){if(o==="__proto__"||o==="constructor"&&n&&typeof n=="object"&&"prototype"in n){Yp(o);return}return n}function Yp(o){console.warn(`[destr] Dropping "${o}" key to prevent prototype pollution.`)}function $i(o,n={}){if(typeof o!="string")return o;const r=o.trim();if(o[0]==='"'&&o.at(-1)==='"'&&!o.includes("\\"))return r.slice(1,-1);if(r.length<=9){const s=r.toLowerCase();if(s==="true")return!0;if(s==="false")return!1;if(s==="undefined")return;if(s==="null")return null;if(s==="nan")return Number.NaN;if(s==="infinity")return Number.POSITIVE_INFINITY;if(s==="-infinity")return Number.NEGATIVE_INFINITY}if(!Wp.test(o)){if(n.strict)throw new SyntaxError("[destr] Invalid JSON");return o}try{if(Kp.test(o)||Gp.test(o)){if(n.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(o,Qp)}return JSON.parse(o)}catch(s){if(n.strict)throw s;return o}}function Jp(o){return!o||typeof o.then!="function"?Promise.resolve(o):o}function Ue(o,...n){try{return Jp(o(...n))}catch(r){return Promise.reject(r)}}function Xp(o){const n=typeof o;return o===null||n!=="object"&&n!=="function"}function Zp(o){const n=Object.getPrototypeOf(o);return!n||n.isPrototypeOf(Object)}function ki(o){if(Xp(o))return String(o);if(Zp(o)||Array.isArray(o))return JSON.stringify(o);if(typeof o.toJSON=="function")return ki(o.toJSON());throw new Error("[unstorage] Cannot stringify value!")}function qu(){if(typeof jt.Buffer===void 0)throw new TypeError("[unstorage] Buffer is not supported!")}const vo="base64:";function ef(o){if(typeof o=="string")return o;qu();const n=jt.Buffer.from(o).toString("base64");return vo+n}function tf(o){return typeof o!="string"||!o.startsWith(vo)?o:(qu(),jt.Buffer.from(o.slice(vo.length),"base64"))}function st(o){return o?o.split("?")[0].replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,""):""}function rf(...o){return st(o.join(":"))}function Bi(o){return o=st(o),o?o+":":""}const nf="memory",sf=()=>{const o=new Map;return{name:nf,options:{},hasItem(n){return o.has(n)},getItem(n){return o.get(n)??null},getItemRaw(n){return o.get(n)??null},setItem(n,r){o.set(n,r)},setItemRaw(n,r){o.set(n,r)},removeItem(n){o.delete(n)},getKeys(){return Array.from(o.keys())},clear(){o.clear()},dispose(){o.clear()}}};function of(o={}){const n={mounts:{"":o.driver||sf()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},r=v=>{for(const E of n.mountpoints)if(v.startsWith(E))return{base:E,relativeKey:v.slice(E.length),driver:n.mounts[E]};return{base:"",relativeKey:v,driver:n.mounts[""]}},s=(v,E)=>n.mountpoints.filter(C=>C.startsWith(v)||E&&v.startsWith(C)).map(C=>({relativeBase:v.length>C.length?v.slice(C.length):void 0,mountpoint:C,driver:n.mounts[C]})),a=(v,E)=>{if(n.watching){E=st(E);for(const C of n.watchListeners)C(v,E)}},h=async()=>{if(!n.watching){n.watching=!0;for(const v in n.mounts)n.unwatch[v]=await Fu(n.mounts[v],a,v)}},p=async()=>{if(n.watching){for(const v in n.unwatch)await n.unwatch[v]();n.unwatch={},n.watching=!1}},d=(v,E,C)=>{const S=new Map,z=I=>{let T=S.get(I.base);return T||(T={driver:I.driver,base:I.base,items:[]},S.set(I.base,T)),T};for(const I of v){const T=typeof I=="string",k=st(T?I:I.key),K=T?void 0:I.value,X=T||!I.options?E:{...E,...I.options},H=r(k);z(H).items.push({key:k,value:K,relativeKey:H.relativeKey,options:X})}return Promise.all([...S.values()].map(I=>C(I))).then(I=>I.flat())},m={hasItem(v,E={}){v=st(v);const{relativeKey:C,driver:S}=r(v);return Ue(S.hasItem,C,E)},getItem(v,E={}){v=st(v);const{relativeKey:C,driver:S}=r(v);return Ue(S.getItem,C,E).then(z=>$i(z))},getItems(v,E){return d(v,E,C=>C.driver.getItems?Ue(C.driver.getItems,C.items.map(S=>({key:S.relativeKey,options:S.options})),E).then(S=>S.map(z=>({key:rf(C.base,z.key),value:$i(z.value)}))):Promise.all(C.items.map(S=>Ue(C.driver.getItem,S.relativeKey,S.options).then(z=>({key:S.key,value:$i(z)})))))},getItemRaw(v,E={}){v=st(v);const{relativeKey:C,driver:S}=r(v);return S.getItemRaw?Ue(S.getItemRaw,C,E):Ue(S.getItem,C,E).then(z=>tf(z))},async setItem(v,E,C={}){if(E===void 0)return m.removeItem(v);v=st(v);const{relativeKey:S,driver:z}=r(v);z.setItem&&(await Ue(z.setItem,S,ki(E),C),z.watch||a("update",v))},async setItems(v,E){await d(v,E,async C=>{C.driver.setItems&&await Ue(C.driver.setItems,C.items.map(S=>({key:S.relativeKey,value:ki(S.value),options:S.options})),E),C.driver.setItem&&await Promise.all(C.items.map(S=>Ue(C.driver.setItem,S.relativeKey,ki(S.value),S.options)))})},async setItemRaw(v,E,C={}){if(E===void 0)return m.removeItem(v,C);v=st(v);const{relativeKey:S,driver:z}=r(v);if(z.setItemRaw)await Ue(z.setItemRaw,S,E,C);else if(z.setItem)await Ue(z.setItem,S,ef(E),C);else return;z.watch||a("update",v)},async removeItem(v,E={}){typeof E=="boolean"&&(E={removeMeta:E}),v=st(v);const{relativeKey:C,driver:S}=r(v);S.removeItem&&(await Ue(S.removeItem,C,E),(E.removeMeta||E.removeMata)&&await Ue(S.removeItem,C+"$",E),S.watch||a("remove",v))},async getMeta(v,E={}){typeof E=="boolean"&&(E={nativeOnly:E}),v=st(v);const{relativeKey:C,driver:S}=r(v),z=Object.create(null);if(S.getMeta&&Object.assign(z,await Ue(S.getMeta,C,E)),!E.nativeOnly){const I=await Ue(S.getItem,C+"$",E).then(T=>$i(T));I&&typeof I=="object"&&(typeof I.atime=="string"&&(I.atime=new Date(I.atime)),typeof I.mtime=="string"&&(I.mtime=new Date(I.mtime)),Object.assign(z,I))}return z},setMeta(v,E,C={}){return this.setItem(v+"$",E,C)},removeMeta(v,E={}){return this.removeItem(v+"$",E)},async getKeys(v,E={}){v=Bi(v);const C=s(v,!0);let S=[];const z=[];for(const I of C){const T=(await Ue(I.driver.getKeys,I.relativeBase,E)).map(k=>I.mountpoint+st(k)).filter(k=>!S.some(K=>k.startsWith(K)));z.push(...T),S=[I.mountpoint,...S.filter(k=>!k.startsWith(I.mountpoint))]}return v?z.filter(I=>I.startsWith(v)&&!I.endsWith("$")):z.filter(I=>!I.endsWith("$"))},async clear(v,E={}){v=Bi(v),await Promise.all(s(v,!1).map(async C=>{if(C.driver.clear)return Ue(C.driver.clear,C.relativeBase,E);if(C.driver.removeItem){const S=await C.driver.getKeys(C.relativeBase||"",E);return Promise.all(S.map(z=>C.driver.removeItem(z,E)))}}))},async dispose(){await Promise.all(Object.values(n.mounts).map(v=>Lu(v)))},async watch(v){return await h(),n.watchListeners.push(v),async()=>{n.watchListeners=n.watchListeners.filter(E=>E!==v),n.watchListeners.length===0&&await p()}},async unwatch(){n.watchListeners=[],await p()},mount(v,E){if(v=Bi(v),v&&n.mounts[v])throw new Error(`already mounted at ${v}`);return v&&(n.mountpoints.push(v),n.mountpoints.sort((C,S)=>S.length-C.length)),n.mounts[v]=E,n.watching&&Promise.resolve(Fu(E,a,v)).then(C=>{n.unwatch[v]=C}).catch(console.error),m},async unmount(v,E=!0){v=Bi(v),!(!v||!n.mounts[v])&&(n.watching&&v in n.unwatch&&(n.unwatch[v](),delete n.unwatch[v]),E&&await Lu(n.mounts[v]),n.mountpoints=n.mountpoints.filter(C=>C!==v),delete n.mounts[v])},getMount(v=""){v=st(v)+":";const E=r(v);return{driver:E.driver,base:E.base}},getMounts(v="",E={}){return v=st(v),s(v,E.parents).map(C=>({driver:C.driver,base:C.mountpoint}))}};return m}function Fu(o,n,r){return o.watch?o.watch((s,a)=>n(s,r+a)):()=>{}}async function Lu(o){typeof o.dispose=="function"&&await Ue(o.dispose)}function Ur(o){return new Promise((n,r)=>{o.oncomplete=o.onsuccess=()=>n(o.result),o.onabort=o.onerror=()=>r(o.error)})}function Uu(o,n){const r=indexedDB.open(o);r.onupgradeneeded=()=>r.result.createObjectStore(n);const s=Ur(r);return(a,h)=>s.then(p=>h(p.transaction(n,a).objectStore(n)))}let yo;function Gn(){return yo||(yo=Uu("keyval-store","keyval")),yo}function Mu(o,n=Gn()){return n("readonly",r=>Ur(r.get(o)))}function af(o,n,r=Gn()){return r("readwrite",s=>(s.put(n,o),Ur(s.transaction)))}function uf(o,n=Gn()){return n("readwrite",r=>(r.delete(o),Ur(r.transaction)))}function cf(o=Gn()){return o("readwrite",n=>(n.clear(),Ur(n.transaction)))}function hf(o,n){return o.openCursor().onsuccess=function(){this.result&&(n(this.result),this.result.continue())},Ur(o.transaction)}function lf(o=Gn()){return o("readonly",n=>{if(n.getAllKeys)return Ur(n.getAllKeys());const r=[];return hf(n,s=>r.push(s.key)).then(()=>r)})}const pf="idb-keyval";var ff=(o={})=>{const n=o.base&&o.base.length>0?`${o.base}:`:"",r=a=>n+a;let s;return o.dbName&&o.storeName&&(s=Uu(o.dbName,o.storeName)),{name:pf,options:o,async hasItem(a){return!(typeof await Mu(r(a),s)>"u")},async getItem(a){return await Mu(r(a),s)??null},setItem(a,h){return af(r(a),h,s)},removeItem(a){return uf(r(a),s)},getKeys(){return lf(s)},clear(){return cf(s)}}};const df="WALLET_CONNECT_V2_INDEXED_DB",gf="keyvaluestorage";let Df=class{constructor(){this.indexedDb=of({driver:ff({dbName:df,storeName:gf})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(o=>[o.key,o.value])}async getItem(o){const n=await this.indexedDb.getItem(o);if(n!==null)return n}async setItem(o,n){await this.indexedDb.setItem(o,Ou(n))}async removeItem(o){await this.indexedDb.removeItem(o)}};var mo=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof jt.global<"u"?jt.global:typeof self<"u"?self:{},Vi={exports:{}};(function(){let o;function n(){}o=n,o.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},o.prototype.setItem=function(r,s){this[r]=String(s)},o.prototype.removeItem=function(r){delete this[r]},o.prototype.clear=function(){const r=this;Object.keys(r).forEach(function(s){r[s]=void 0,delete r[s]})},o.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},o.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof mo<"u"&&mo.localStorage?Vi.exports=mo.localStorage:typeof window<"u"&&window.localStorage?Vi.exports=window.localStorage:Vi.exports=new n})();function vf(o){var n;return[o[0],kp((n=o[1])!=null?n:"")]}class yf{constructor(){this.localStorage=Vi.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(vf)}async getItem(n){const r=this.localStorage.getItem(n);if(r!==null)return kp(r)}async setItem(n,r){this.localStorage.setItem(n,Ou(r))}async removeItem(n){this.localStorage.removeItem(n)}}const mf="wc_storage_version",$u=1,wf=async(o,n,r)=>{const s=mf,a=await n.getItem(s);if(a&&a>=$u){r(n);return}const h=await o.getKeys();if(!h.length){r(n);return}const p=[];for(;h.length;){const d=h.shift();if(!d)continue;const m=d.toLowerCase();if(m.includes("wc@")||m.includes("walletconnect")||m.includes("wc_")||m.includes("wallet_connect")){const v=await o.getItem(d);await n.setItem(d,v),p.push(d)}}await n.setItem(s,$u),r(n),bf(o,p)},bf=async(o,n)=>{n.length&&n.forEach(async r=>{await o.removeItem(r)})};let _f=class{constructor(){this.initialized=!1,this.setInitialized=n=>{this.storage=n,this.initialized=!0};const o=new yf;this.storage=o;try{const n=new Df;wf(o,n,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(o){return await this.initialize(),this.storage.getItem(o)}async setItem(o,n){return await this.initialize(),this.storage.setItem(o,n)}async removeItem(o){return await this.initialize(),this.storage.removeItem(o)}async initialize(){this.initialized||await new Promise(o=>{const n=setInterval(()=>{this.initialized&&(clearInterval(n),o())},20)})}};var hn={},Wn={},ku={},Qn={};class Mr{}const Ef=Object.freeze(Object.defineProperty({__proto__:null,IEvents:Mr},Symbol.toStringTag,{value:"Module"})),Cf=Sp(Ef);var Bu;function If(){if(Bu)return Qn;Bu=1,Object.defineProperty(Qn,"__esModule",{value:!0}),Qn.IHeartBeat=void 0;const o=Cf;class n extends o.IEvents{constructor(s){super()}}return Qn.IHeartBeat=n,Qn}var Vu;function Hu(){return Vu||(Vu=1,function(o){Object.defineProperty(o,"__esModule",{value:!0}),zi.__exportStar(If(),o)}(ku)),ku}var Ku={},$r={},Gu;function Pf(){if(Gu)return $r;Gu=1,Object.defineProperty($r,"__esModule",{value:!0}),$r.HEARTBEAT_EVENTS=$r.HEARTBEAT_INTERVAL=void 0;const o=G;return $r.HEARTBEAT_INTERVAL=o.FIVE_SECONDS,$r.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},$r}var Wu;function Qu(){return Wu||(Wu=1,function(o){Object.defineProperty(o,"__esModule",{value:!0}),zi.__exportStar(Pf(),o)}(Ku)),Ku}var Yu;function Sf(){if(Yu)return Wn;Yu=1,Object.defineProperty(Wn,"__esModule",{value:!0}),Wn.HeartBeat=void 0;const o=zi,n=Zt,r=G,s=Hu(),a=Qu();class h extends s.IHeartBeat{constructor(d){super(d),this.events=new n.EventEmitter,this.interval=a.HEARTBEAT_INTERVAL,this.interval=d?.interval||a.HEARTBEAT_INTERVAL}static init(d){return o.__awaiter(this,void 0,void 0,function*(){const m=new h(d);return yield m.init(),m})}init(){return o.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(d,m){this.events.on(d,m)}once(d,m){this.events.once(d,m)}off(d,m){this.events.off(d,m)}removeListener(d,m){this.events.removeListener(d,m)}initialize(){return o.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),r.toMiliseconds(this.interval))})}pulse(){this.events.emit(a.HEARTBEAT_EVENTS.pulse)}}return Wn.HeartBeat=h,Wn}(function(o){Object.defineProperty(o,"__esModule",{value:!0});const n=zi;n.__exportStar(Sf(),o),n.__exportStar(Hu(),o),n.__exportStar(Qu(),o)})(hn);var ce={},wo,Ju;function xf(){if(Ju)return wo;Ju=1;function o(r){try{return JSON.stringify(r)}catch{return'"[Circular]"'}}wo=n;function n(r,s,a){var h=a&&a.stringify||o,p=1;if(typeof r=="object"&&r!==null){var d=s.length+p;if(d===1)return r;var m=new Array(d);m[0]=h(r);for(var v=1;v<d;v++)m[v]=h(s[v]);return m.join(" ")}if(typeof r!="string")return r;var E=s.length;if(E===0)return r;for(var C="",S=1-p,z=-1,I=r&&r.length||0,T=0;T<I;){if(r.charCodeAt(T)===37&&T+1<I){switch(z=z>-1?z:0,r.charCodeAt(T+1)){case 100:case 102:if(S>=E||s[S]==null)break;z<T&&(C+=r.slice(z,T)),C+=Number(s[S]),z=T+2,T++;break;case 105:if(S>=E||s[S]==null)break;z<T&&(C+=r.slice(z,T)),C+=Math.floor(Number(s[S])),z=T+2,T++;break;case 79:case 111:case 106:if(S>=E||s[S]===void 0)break;z<T&&(C+=r.slice(z,T));var k=typeof s[S];if(k==="string"){C+="'"+s[S]+"'",z=T+2,T++;break}if(k==="function"){C+=s[S].name||"<anonymous>",z=T+2,T++;break}C+=h(s[S]),z=T+2,T++;break;case 115:if(S>=E)break;z<T&&(C+=r.slice(z,T)),C+=String(s[S]),z=T+2,T++;break;case 37:z<T&&(C+=r.slice(z,T)),C+="%",z=T+2,T++,S--;break}++S}++T}return z===-1?r:(z<I&&(C+=r.slice(z)),C)}return wo}var bo,Xu;function Af(){if(Xu)return bo;Xu=1;const o=xf();bo=a;const n=W().console||{},r={mapHttpRequest:I,mapHttpResponse:I,wrapRequestSerializer:T,wrapResponseSerializer:T,wrapErrorSerializer:T,req:I,res:I,err:S};function s(x,q){return Array.isArray(x)?x.filter(function(F){return F!=="!stdSerializers.err"}):x===!0?Object.keys(q):!1}function a(x){x=x||{},x.browser=x.browser||{};const q=x.browser.transmit;if(q&&typeof q.send!="function")throw Error("pino: transmit option must have a send function");const F=x.browser.write||n;x.browser.write&&(x.browser.asObject=!0);const ie=x.serializers||{},re=s(x.browser.serialize,ie);let de=x.browser.serialize;Array.isArray(x.browser.serialize)&&x.browser.serialize.indexOf("!stdSerializers.err")>-1&&(de=!1);const qe=["error","fatal","warn","info","debug","trace"];typeof F=="function"&&(F.error=F.fatal=F.warn=F.info=F.debug=F.trace=F),x.enabled===!1&&(x.level="silent");const We=x.level||"info",Z=Object.create(F);Z.log||(Z.log=k),Object.defineProperty(Z,"levelVal",{get:wr}),Object.defineProperty(Z,"level",{get:qt,set:Ct});const at={transmit:q,serialize:re,asObject:x.browser.asObject,levels:qe,timestamp:z(x)};Z.levels=a.levels,Z.level=We,Z.setMaxListeners=Z.getMaxListeners=Z.emit=Z.addListener=Z.on=Z.prependListener=Z.once=Z.prependOnceListener=Z.removeListener=Z.removeAllListeners=Z.listeners=Z.listenerCount=Z.eventNames=Z.write=Z.flush=k,Z.serializers=ie,Z._serialize=re,Z._stdErrSerialize=de,Z.child=ai,q&&(Z._logEvent=C());function wr(){return this.level==="silent"?1/0:this.levels.values[this.level]}function qt(){return this._level}function Ct(Pe){if(Pe!=="silent"&&!this.levels.values[Pe])throw Error("unknown level "+Pe);this._level=Pe,h(at,Z,"error","log"),h(at,Z,"fatal","error"),h(at,Z,"warn","error"),h(at,Z,"info","log"),h(at,Z,"debug","log"),h(at,Z,"trace","log")}function ai(Pe,He){if(!Pe)throw new Error("missing bindings for child Pino");He=He||{},re&&Pe.serializers&&(He.serializers=Pe.serializers);const fn=He.serializers;if(re&&fn){var br=Object.assign({},ie,fn),dn=x.browser.serialize===!0?Object.keys(br):re;delete Pe.serializers,m([Pe],dn,br,this._stdErrSerialize)}function le(Qe){this._childLevel=(Qe._childLevel|0)+1,this.error=v(Qe,Pe,"error"),this.fatal=v(Qe,Pe,"fatal"),this.warn=v(Qe,Pe,"warn"),this.info=v(Qe,Pe,"info"),this.debug=v(Qe,Pe,"debug"),this.trace=v(Qe,Pe,"trace"),br&&(this.serializers=br,this._serialize=dn),q&&(this._logEvent=C([].concat(Qe._logEvent.bindings,Pe)))}return le.prototype=this,new le(this)}return Z}a.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},a.stdSerializers=r,a.stdTimeFunctions=Object.assign({},{nullTime:K,epochTime:X,unixTime:H,isoTime:B});function h(x,q,F,ie){const re=Object.getPrototypeOf(q);q[F]=q.levelVal>q.levels.values[F]?k:re[F]?re[F]:n[F]||n[ie]||k,p(x,q,F)}function p(x,q,F){!x.transmit&&q[F]===k||(q[F]=function(ie){return function(){const re=x.timestamp(),de=new Array(arguments.length),qe=Object.getPrototypeOf&&Object.getPrototypeOf(this)===n?n:this;for(var We=0;We<de.length;We++)de[We]=arguments[We];if(x.serialize&&!x.asObject&&m(de,this._serialize,this.serializers,this._stdErrSerialize),x.asObject?ie.call(qe,d(this,F,de,re)):ie.apply(qe,de),x.transmit){const Z=x.transmit.level||q.level,at=a.levels.values[Z],wr=a.levels.values[F];if(wr<at)return;E(this,{ts:re,methodLevel:F,methodValue:wr,transmitLevel:Z,transmitValue:a.levels.values[x.transmit.level||q.level],send:x.transmit.send,val:q.levelVal},de)}}}(q[F]))}function d(x,q,F,ie){x._serialize&&m(F,x._serialize,x.serializers,x._stdErrSerialize);const re=F.slice();let de=re[0];const qe={};ie&&(qe.time=ie),qe.level=a.levels.values[q];let We=(x._childLevel|0)+1;if(We<1&&(We=1),de!==null&&typeof de=="object"){for(;We--&&typeof re[0]=="object";)Object.assign(qe,re.shift());de=re.length?o(re.shift(),re):void 0}else typeof de=="string"&&(de=o(re.shift(),re));return de!==void 0&&(qe.msg=de),qe}function m(x,q,F,ie){for(const re in x)if(ie&&x[re]instanceof Error)x[re]=a.stdSerializers.err(x[re]);else if(typeof x[re]=="object"&&!Array.isArray(x[re]))for(const de in x[re])q&&q.indexOf(de)>-1&&de in F&&(x[re][de]=F[de](x[re][de]))}function v(x,q,F){return function(){const ie=new Array(1+arguments.length);ie[0]=q;for(var re=1;re<ie.length;re++)ie[re]=arguments[re-1];return x[F].apply(this,ie)}}function E(x,q,F){const ie=q.send,re=q.ts,de=q.methodLevel,qe=q.methodValue,We=q.val,Z=x._logEvent.bindings;m(F,x._serialize||Object.keys(x.serializers),x.serializers,x._stdErrSerialize===void 0?!0:x._stdErrSerialize),x._logEvent.ts=re,x._logEvent.messages=F.filter(function(at){return Z.indexOf(at)===-1}),x._logEvent.level.label=de,x._logEvent.level.value=qe,ie(de,x._logEvent,We),x._logEvent=C(Z)}function C(x){return{ts:0,messages:[],bindings:x||[],level:{label:"",value:0}}}function S(x){const q={type:x.constructor.name,msg:x.message,stack:x.stack};for(const F in x)q[F]===void 0&&(q[F]=x[F]);return q}function z(x){return typeof x.timestamp=="function"?x.timestamp:x.timestamp===!1?K:X}function I(){return{}}function T(x){return x}function k(){}function K(){return!1}function X(){return Date.now()}function H(){return Math.round(Date.now()/1e3)}function B(){return new Date(Date.now()).toISOString()}function W(){function x(q){return typeof q<"u"&&q}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return x(self)||x(window)||x(this)||{}}}return bo}var ln={},Zu;function ec(){return Zu||(Zu=1,Object.defineProperty(ln,"__esModule",{value:!0}),ln.PINO_CUSTOM_CONTEXT_KEY=ln.PINO_LOGGER_DEFAULTS=void 0,ln.PINO_LOGGER_DEFAULTS={level:"info"},ln.PINO_CUSTOM_CONTEXT_KEY="custom_context"),ln}var Ze={},tc;function Of(){if(tc)return Ze;tc=1,Object.defineProperty(Ze,"__esModule",{value:!0}),Ze.generateChildLogger=Ze.formatChildLoggerContext=Ze.getLoggerContext=Ze.setBrowserLoggerContext=Ze.getBrowserLoggerContext=Ze.getDefaultLoggerOptions=void 0;const o=ec();function n(d){return Object.assign(Object.assign({},d),{level:d?.level||o.PINO_LOGGER_DEFAULTS.level})}Ze.getDefaultLoggerOptions=n;function r(d,m=o.PINO_CUSTOM_CONTEXT_KEY){return d[m]||""}Ze.getBrowserLoggerContext=r;function s(d,m,v=o.PINO_CUSTOM_CONTEXT_KEY){return d[v]=m,d}Ze.setBrowserLoggerContext=s;function a(d,m=o.PINO_CUSTOM_CONTEXT_KEY){let v="";return typeof d.bindings>"u"?v=r(d,m):v=d.bindings().context||"",v}Ze.getLoggerContext=a;function h(d,m,v=o.PINO_CUSTOM_CONTEXT_KEY){const E=a(d,v);return E.trim()?`${E}/${m}`:m}Ze.formatChildLoggerContext=h;function p(d,m,v=o.PINO_CUSTOM_CONTEXT_KEY){const E=h(d,m,v),C=d.child({context:E});return s(C,E,v)}return Ze.generateChildLogger=p,Ze}(function(o){Object.defineProperty(o,"__esModule",{value:!0}),o.pino=void 0;const n=zi,r=n.__importDefault(Af());Object.defineProperty(o,"pino",{enumerable:!0,get:function(){return r.default}}),n.__exportStar(ec(),o),n.__exportStar(Of(),o)})(ce);class Rf extends Mr{constructor(n){super(),this.opts=n,this.protocol="wc",this.version=2}}let Nf=class extends Mr{constructor(o,n){super(),this.core=o,this.logger=n,this.records=new Map}},Tf=class{constructor(o,n){this.logger=o,this.core=n}},jf=class extends Mr{constructor(o,n){super(),this.relayer=o,this.logger=n}},zf=class extends Mr{constructor(o){super()}},qf=class{constructor(o,n,r,s){this.core=o,this.logger=n,this.name=r}};class Ff extends Mr{constructor(n,r){super(),this.relayer=n,this.logger=r}}let Lf=class extends Mr{constructor(o,n){super(),this.core=o,this.logger=n}},Uf=class{constructor(o,n){this.projectId=o,this.logger=n}},Mf=class{constructor(o,n){this.projectId=o,this.logger=n}},$f=class{constructor(o){this.opts=o,this.protocol="wc",this.version=2}},kf=class{constructor(o){this.client=o}};const Bf=o=>JSON.stringify(o,(n,r)=>typeof r=="bigint"?r.toString()+"n":r),Vf=o=>{const n=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,r=o.replace(n,'$1"$2n"$3');return JSON.parse(r,(s,a)=>typeof a=="string"&&a.match(/^\d+n$/)?BigInt(a.substring(0,a.length-1)):a)};function Hf(o){if(typeof o!="string")throw new Error(`Cannot safe json parse value of type ${typeof o}`);try{return Vf(o)}catch{return o}}function Kf(o){return typeof o=="string"?o:Bf(o)||""}const Gf="EdDSA",Wf="JWT",rc=".",nc="base64url",Qf="utf8",Yf="utf8",Jf=":",Xf="did",Zf="key",ic="base58btc",ed="z",td="K36",rd=32;function sc(o=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(o):new Uint8Array(o)}function nd(o,n){n||(n=o.reduce((a,h)=>a+h.length,0));const r=sc(n);let s=0;for(const a of o)r.set(a,s),s+=a.length;return r}function id(o,n){if(o.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),s=0;s<r.length;s++)r[s]=255;for(var a=0;a<o.length;a++){var h=o.charAt(a),p=h.charCodeAt(0);if(r[p]!==255)throw new TypeError(h+" is ambiguous");r[p]=a}var d=o.length,m=o.charAt(0),v=Math.log(d)/Math.log(256),E=Math.log(256)/Math.log(d);function C(I){if(I instanceof Uint8Array||(ArrayBuffer.isView(I)?I=new Uint8Array(I.buffer,I.byteOffset,I.byteLength):Array.isArray(I)&&(I=Uint8Array.from(I))),!(I instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(I.length===0)return"";for(var T=0,k=0,K=0,X=I.length;K!==X&&I[K]===0;)K++,T++;for(var H=(X-K)*E+1>>>0,B=new Uint8Array(H);K!==X;){for(var W=I[K],x=0,q=H-1;(W!==0||x<k)&&q!==-1;q--,x++)W+=256*B[q]>>>0,B[q]=W%d>>>0,W=W/d>>>0;if(W!==0)throw new Error("Non-zero carry");k=x,K++}for(var F=H-k;F!==H&&B[F]===0;)F++;for(var ie=m.repeat(T);F<H;++F)ie+=o.charAt(B[F]);return ie}function S(I){if(typeof I!="string")throw new TypeError("Expected String");if(I.length===0)return new Uint8Array;var T=0;if(I[T]!==" "){for(var k=0,K=0;I[T]===m;)k++,T++;for(var X=(I.length-T)*v+1>>>0,H=new Uint8Array(X);I[T];){var B=r[I.charCodeAt(T)];if(B===255)return;for(var W=0,x=X-1;(B!==0||W<K)&&x!==-1;x--,W++)B+=d*H[x]>>>0,H[x]=B%256>>>0,B=B/256>>>0;if(B!==0)throw new Error("Non-zero carry");K=W,T++}if(I[T]!==" "){for(var q=X-K;q!==X&&H[q]===0;)q++;for(var F=new Uint8Array(k+(X-q)),ie=k;q!==X;)F[ie++]=H[q++];return F}}}function z(I){var T=S(I);if(T)return T;throw new Error(`Non-${n} character`)}return{encode:C,decodeUnsafe:S,decode:z}}var sd=id,od=sd;const ad=o=>{if(o instanceof Uint8Array&&o.constructor.name==="Uint8Array")return o;if(o instanceof ArrayBuffer)return new Uint8Array(o);if(ArrayBuffer.isView(o))return new Uint8Array(o.buffer,o.byteOffset,o.byteLength);throw new Error("Unknown type, must be binary type")},ud=o=>new TextEncoder().encode(o),cd=o=>new TextDecoder().decode(o);let hd=class{constructor(o,n,r){this.name=o,this.prefix=n,this.baseEncode=r}encode(o){if(o instanceof Uint8Array)return`${this.prefix}${this.baseEncode(o)}`;throw Error("Unknown type, must be binary type")}},ld=class{constructor(o,n,r){if(this.name=o,this.prefix=n,n.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=n.codePointAt(0),this.baseDecode=r}decode(o){if(typeof o=="string"){if(o.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(o)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(o.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(o){return oc(this,o)}},pd=class{constructor(o){this.decoders=o}or(o){return oc(this,o)}decode(o){const n=o[0],r=this.decoders[n];if(r)return r.decode(o);throw RangeError(`Unable to decode multibase string ${JSON.stringify(o)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const oc=(o,n)=>new pd({...o.decoders||{[o.prefix]:o},...n.decoders||{[n.prefix]:n}});let fd=class{constructor(o,n,r,s){this.name=o,this.prefix=n,this.baseEncode=r,this.baseDecode=s,this.encoder=new hd(o,n,r),this.decoder=new ld(o,n,s)}encode(o){return this.encoder.encode(o)}decode(o){return this.decoder.decode(o)}};const Hi=({name:o,prefix:n,encode:r,decode:s})=>new fd(o,n,r,s),Yn=({prefix:o,name:n,alphabet:r})=>{const{encode:s,decode:a}=od(r,n);return Hi({prefix:o,name:n,encode:s,decode:h=>ad(a(h))})},dd=(o,n,r,s)=>{const a={};for(let E=0;E<n.length;++E)a[n[E]]=E;let h=o.length;for(;o[h-1]==="=";)--h;const p=new Uint8Array(h*r/8|0);let d=0,m=0,v=0;for(let E=0;E<h;++E){const C=a[o[E]];if(C===void 0)throw new SyntaxError(`Non-${s} character`);m=m<<r|C,d+=r,d>=8&&(d-=8,p[v++]=255&m>>d)}if(d>=r||255&m<<8-d)throw new SyntaxError("Unexpected end of data");return p},gd=(o,n,r)=>{const s=n[n.length-1]==="=",a=(1<<r)-1;let h="",p=0,d=0;for(let m=0;m<o.length;++m)for(d=d<<8|o[m],p+=8;p>r;)p-=r,h+=n[a&d>>p];if(p&&(h+=n[a&d<<r-p]),s)for(;h.length*r&7;)h+="=";return h},ke=({name:o,prefix:n,bitsPerChar:r,alphabet:s})=>Hi({prefix:n,name:o,encode(a){return gd(a,s,r)},decode(a){return dd(a,s,r,o)}}),Dd=Hi({prefix:"\0",name:"identity",encode:o=>cd(o),decode:o=>ud(o)}),vd=Object.freeze(Object.defineProperty({__proto__:null,identity:Dd},Symbol.toStringTag,{value:"Module"})),yd=ke({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),md=Object.freeze(Object.defineProperty({__proto__:null,base2:yd},Symbol.toStringTag,{value:"Module"})),wd=ke({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),bd=Object.freeze(Object.defineProperty({__proto__:null,base8:wd},Symbol.toStringTag,{value:"Module"})),_d=Yn({prefix:"9",name:"base10",alphabet:"0123456789"}),Ed=Object.freeze(Object.defineProperty({__proto__:null,base10:_d},Symbol.toStringTag,{value:"Module"})),Cd=ke({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Id=ke({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),Pd=Object.freeze(Object.defineProperty({__proto__:null,base16:Cd,base16upper:Id},Symbol.toStringTag,{value:"Module"})),Sd=ke({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),xd=ke({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Ad=ke({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Od=ke({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Rd=ke({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Nd=ke({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Td=ke({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),jd=ke({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),zd=ke({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),qd=Object.freeze(Object.defineProperty({__proto__:null,base32:Sd,base32hex:Rd,base32hexpad:Td,base32hexpadupper:jd,base32hexupper:Nd,base32pad:Ad,base32padupper:Od,base32upper:xd,base32z:zd},Symbol.toStringTag,{value:"Module"})),Fd=Yn({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Ld=Yn({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),Ud=Object.freeze(Object.defineProperty({__proto__:null,base36:Fd,base36upper:Ld},Symbol.toStringTag,{value:"Module"})),Md=Yn({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),$d=Yn({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),kd=Object.freeze(Object.defineProperty({__proto__:null,base58btc:Md,base58flickr:$d},Symbol.toStringTag,{value:"Module"})),Bd=ke({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Vd=ke({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Hd=ke({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Kd=ke({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),Gd=Object.freeze(Object.defineProperty({__proto__:null,base64:Bd,base64pad:Vd,base64url:Hd,base64urlpad:Kd},Symbol.toStringTag,{value:"Module"})),ac=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),Wd=ac.reduce((o,n,r)=>(o[r]=n,o),[]),Qd=ac.reduce((o,n,r)=>(o[n.codePointAt(0)]=r,o),[]);function Yd(o){return o.reduce((n,r)=>(n+=Wd[r],n),"")}function Jd(o){const n=[];for(const r of o){const s=Qd[r.codePointAt(0)];if(s===void 0)throw new Error(`Non-base256emoji character: ${r}`);n.push(s)}return new Uint8Array(n)}const Xd=Hi({prefix:"\u{1F680}",name:"base256emoji",encode:Yd,decode:Jd}),Zd=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:Xd},Symbol.toStringTag,{value:"Module"}));new TextEncoder,new TextDecoder;const uc={...vd,...md,...bd,...Ed,...Pd,...qd,...Ud,...kd,...Gd,...Zd};function cc(o,n,r,s){return{name:o,prefix:n,encoder:{name:o,prefix:n,encode:r},decoder:{decode:s}}}const hc=cc("utf8","u",o=>"u"+new TextDecoder("utf8").decode(o),o=>new TextEncoder().encode(o.substring(1))),_o=cc("ascii","a",o=>{let n="a";for(let r=0;r<o.length;r++)n+=String.fromCharCode(o[r]);return n},o=>{o=o.substring(1);const n=sc(o.length);for(let r=0;r<o.length;r++)n[r]=o.charCodeAt(r);return n}),lc={utf8:hc,"utf-8":hc,hex:uc.base16,latin1:_o,ascii:_o,binary:_o,...uc};function Eo(o,n="utf8"){const r=lc[n];if(!r)throw new Error(`Unsupported encoding "${n}"`);return(n==="utf8"||n==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(o.buffer,o.byteOffset,o.byteLength).toString("utf8"):r.encoder.encode(o).substring(1)}function Co(o,n="utf8"){const r=lc[n];if(!r)throw new Error(`Unsupported encoding "${n}"`);return(n==="utf8"||n==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(o,"utf8"):r.decoder.decode(`${r.prefix}${o}`)}function Ki(o){return Eo(Co(Ou(o),Qf),nc)}function pc(o){const n=Co(td,ic),r=ed+Eo(nd([n,o]),ic);return[Xf,Zf,r].join(Jf)}function eg(o){return Eo(o,nc)}function tg(o){return Co([Ki(o.header),Ki(o.payload)].join(rc),Yf)}function rg(o){return[Ki(o.header),Ki(o.payload),eg(o.signature)].join(rc)}function fc(o=O1.randomBytes(rd)){return xp.generateKeyPairFromSeed(o)}async function ng(o,n,r,s,a=G.fromMiliseconds(Date.now())){const h={alg:Gf,typ:Wf},p=pc(s.publicKey),d=a+r,m={iss:p,sub:o,aud:n,iat:a,exp:d},v=tg({header:h,payload:m}),E=xp.sign(s.secretKey,v);return rg({header:h,payload:m,signature:E})}function ig(o=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(o):new Uint8Array(o)}function sg(o,n){if(o.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),s=0;s<r.length;s++)r[s]=255;for(var a=0;a<o.length;a++){var h=o.charAt(a),p=h.charCodeAt(0);if(r[p]!==255)throw new TypeError(h+" is ambiguous");r[p]=a}var d=o.length,m=o.charAt(0),v=Math.log(d)/Math.log(256),E=Math.log(256)/Math.log(d);function C(I){if(I instanceof Uint8Array||(ArrayBuffer.isView(I)?I=new Uint8Array(I.buffer,I.byteOffset,I.byteLength):Array.isArray(I)&&(I=Uint8Array.from(I))),!(I instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(I.length===0)return"";for(var T=0,k=0,K=0,X=I.length;K!==X&&I[K]===0;)K++,T++;for(var H=(X-K)*E+1>>>0,B=new Uint8Array(H);K!==X;){for(var W=I[K],x=0,q=H-1;(W!==0||x<k)&&q!==-1;q--,x++)W+=256*B[q]>>>0,B[q]=W%d>>>0,W=W/d>>>0;if(W!==0)throw new Error("Non-zero carry");k=x,K++}for(var F=H-k;F!==H&&B[F]===0;)F++;for(var ie=m.repeat(T);F<H;++F)ie+=o.charAt(B[F]);return ie}function S(I){if(typeof I!="string")throw new TypeError("Expected String");if(I.length===0)return new Uint8Array;var T=0;if(I[T]!==" "){for(var k=0,K=0;I[T]===m;)k++,T++;for(var X=(I.length-T)*v+1>>>0,H=new Uint8Array(X);I[T];){var B=r[I.charCodeAt(T)];if(B===255)return;for(var W=0,x=X-1;(B!==0||W<K)&&x!==-1;x--,W++)B+=d*H[x]>>>0,H[x]=B%256>>>0,B=B/256>>>0;if(B!==0)throw new Error("Non-zero carry");K=W,T++}if(I[T]!==" "){for(var q=X-K;q!==X&&H[q]===0;)q++;for(var F=new Uint8Array(k+(X-q)),ie=k;q!==X;)F[ie++]=H[q++];return F}}}function z(I){var T=S(I);if(T)return T;throw new Error(`Non-${n} character`)}return{encode:C,decodeUnsafe:S,decode:z}}var og=sg,ag=og;const ug=o=>{if(o instanceof Uint8Array&&o.constructor.name==="Uint8Array")return o;if(o instanceof ArrayBuffer)return new Uint8Array(o);if(ArrayBuffer.isView(o))return new Uint8Array(o.buffer,o.byteOffset,o.byteLength);throw new Error("Unknown type, must be binary type")},cg=o=>new TextEncoder().encode(o),hg=o=>new TextDecoder().decode(o);class lg{constructor(n,r,s){this.name=n,this.prefix=r,this.baseEncode=s}encode(n){if(n instanceof Uint8Array)return`${this.prefix}${this.baseEncode(n)}`;throw Error("Unknown type, must be binary type")}}class pg{constructor(n,r,s){if(this.name=n,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=s}decode(n){if(typeof n=="string"){if(n.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(n)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(n.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(n){return dc(this,n)}}class fg{constructor(n){this.decoders=n}or(n){return dc(this,n)}decode(n){const r=n[0],s=this.decoders[r];if(s)return s.decode(n);throw RangeError(`Unable to decode multibase string ${JSON.stringify(n)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const dc=(o,n)=>new fg({...o.decoders||{[o.prefix]:o},...n.decoders||{[n.prefix]:n}});class dg{constructor(n,r,s,a){this.name=n,this.prefix=r,this.baseEncode=s,this.baseDecode=a,this.encoder=new lg(n,r,s),this.decoder=new pg(n,r,a)}encode(n){return this.encoder.encode(n)}decode(n){return this.decoder.decode(n)}}const Gi=({name:o,prefix:n,encode:r,decode:s})=>new dg(o,n,r,s),Jn=({prefix:o,name:n,alphabet:r})=>{const{encode:s,decode:a}=ag(r,n);return Gi({prefix:o,name:n,encode:s,decode:h=>ug(a(h))})},gg=(o,n,r,s)=>{const a={};for(let E=0;E<n.length;++E)a[n[E]]=E;let h=o.length;for(;o[h-1]==="=";)--h;const p=new Uint8Array(h*r/8|0);let d=0,m=0,v=0;for(let E=0;E<h;++E){const C=a[o[E]];if(C===void 0)throw new SyntaxError(`Non-${s} character`);m=m<<r|C,d+=r,d>=8&&(d-=8,p[v++]=255&m>>d)}if(d>=r||255&m<<8-d)throw new SyntaxError("Unexpected end of data");return p},Dg=(o,n,r)=>{const s=n[n.length-1]==="=",a=(1<<r)-1;let h="",p=0,d=0;for(let m=0;m<o.length;++m)for(d=d<<8|o[m],p+=8;p>r;)p-=r,h+=n[a&d>>p];if(p&&(h+=n[a&d<<r-p]),s)for(;h.length*r&7;)h+="=";return h},Be=({name:o,prefix:n,bitsPerChar:r,alphabet:s})=>Gi({prefix:n,name:o,encode(a){return Dg(a,s,r)},decode(a){return gg(a,s,r,o)}}),vg=Gi({prefix:"\0",name:"identity",encode:o=>hg(o),decode:o=>cg(o)}),yg=Object.freeze(Object.defineProperty({__proto__:null,identity:vg},Symbol.toStringTag,{value:"Module"})),mg=Be({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),wg=Object.freeze(Object.defineProperty({__proto__:null,base2:mg},Symbol.toStringTag,{value:"Module"})),bg=Be({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),_g=Object.freeze(Object.defineProperty({__proto__:null,base8:bg},Symbol.toStringTag,{value:"Module"})),Eg=Jn({prefix:"9",name:"base10",alphabet:"0123456789"}),Cg=Object.freeze(Object.defineProperty({__proto__:null,base10:Eg},Symbol.toStringTag,{value:"Module"})),Ig=Be({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Pg=Be({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),Sg=Object.freeze(Object.defineProperty({__proto__:null,base16:Ig,base16upper:Pg},Symbol.toStringTag,{value:"Module"})),xg=Be({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Ag=Be({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Og=Be({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Rg=Be({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Ng=Be({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Tg=Be({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),jg=Be({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),zg=Be({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),qg=Be({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),Fg=Object.freeze(Object.defineProperty({__proto__:null,base32:xg,base32hex:Ng,base32hexpad:jg,base32hexpadupper:zg,base32hexupper:Tg,base32pad:Og,base32padupper:Rg,base32upper:Ag,base32z:qg},Symbol.toStringTag,{value:"Module"})),Lg=Jn({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Ug=Jn({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),Mg=Object.freeze(Object.defineProperty({__proto__:null,base36:Lg,base36upper:Ug},Symbol.toStringTag,{value:"Module"})),$g=Jn({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),kg=Jn({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),Bg=Object.freeze(Object.defineProperty({__proto__:null,base58btc:$g,base58flickr:kg},Symbol.toStringTag,{value:"Module"})),Vg=Be({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Hg=Be({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Kg=Be({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Gg=Be({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),Wg=Object.freeze(Object.defineProperty({__proto__:null,base64:Vg,base64pad:Hg,base64url:Kg,base64urlpad:Gg},Symbol.toStringTag,{value:"Module"})),gc=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),Qg=gc.reduce((o,n,r)=>(o[r]=n,o),[]),Yg=gc.reduce((o,n,r)=>(o[n.codePointAt(0)]=r,o),[]);function Jg(o){return o.reduce((n,r)=>(n+=Qg[r],n),"")}function Xg(o){const n=[];for(const r of o){const s=Yg[r.codePointAt(0)];if(s===void 0)throw new Error(`Non-base256emoji character: ${r}`);n.push(s)}return new Uint8Array(n)}const Zg=Gi({prefix:"\u{1F680}",name:"base256emoji",encode:Jg,decode:Xg}),eD=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:Zg},Symbol.toStringTag,{value:"Module"}));new TextEncoder,new TextDecoder;const Dc={...yg,...wg,..._g,...Cg,...Sg,...Fg,...Mg,...Bg,...Wg,...eD};function vc(o,n,r,s){return{name:o,prefix:n,encoder:{name:o,prefix:n,encode:r},decoder:{decode:s}}}const yc=vc("utf8","u",o=>"u"+new TextDecoder("utf8").decode(o),o=>new TextEncoder().encode(o.substring(1))),Io=vc("ascii","a",o=>{let n="a";for(let r=0;r<o.length;r++)n+=String.fromCharCode(o[r]);return n},o=>{o=o.substring(1);const n=ig(o.length);for(let r=0;r<o.length;r++)n[r]=o.charCodeAt(r);return n}),tD={utf8:yc,"utf-8":yc,hex:Dc.base16,latin1:Io,ascii:Io,binary:Io,...Dc};function rD(o,n="utf8"){const r=tD[n];if(!r)throw new Error(`Unsupported encoding "${n}"`);return(n==="utf8"||n==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(o.buffer,o.byteOffset,o.byteLength).toString("utf8"):r.encoder.encode(o).substring(1)}const nD=o=>JSON.stringify(o,(n,r)=>typeof r=="bigint"?r.toString()+"n":r),iD=o=>{const n=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,r=o.replace(n,'$1"$2n"$3');return JSON.parse(r,(s,a)=>typeof a=="string"&&a.match(/^\d+n$/)?BigInt(a.substring(0,a.length-1)):a)};function sD(o){if(typeof o!="string")throw new Error(`Cannot safe json parse value of type ${typeof o}`);try{return iD(o)}catch{return o}}function oD(o){return typeof o=="string"?o:nD(o)||""}const aD="PARSE_ERROR",uD="INVALID_REQUEST",cD="METHOD_NOT_FOUND",hD="INVALID_PARAMS",mc="INTERNAL_ERROR",Po="SERVER_ERROR",lD=[-32700,-32600,-32601,-32602,-32603],Xn={[aD]:{code:-32700,message:"Parse error"},[uD]:{code:-32600,message:"Invalid Request"},[cD]:{code:-32601,message:"Method not found"},[hD]:{code:-32602,message:"Invalid params"},[mc]:{code:-32603,message:"Internal error"},[Po]:{code:-32e3,message:"Server error"}},wc=Po;function pD(o){return lD.includes(o)}function bc(o){return Object.keys(Xn).includes(o)?Xn[o]:Xn[wc]}function fD(o){return Object.values(Xn).find(r=>r.code===o)||Xn[wc]}function dD(o,n,r){return o.message.includes("getaddrinfo ENOTFOUND")||o.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${r} RPC url at ${n}`):o}function gD(o,n,r){return{id:o,jsonrpc:"2.0",error:DD(n,r)}}function DD(o,n){return typeof o>"u"?bc(mc):(typeof o=="string"&&(o=Object.assign(Object.assign({},bc(Po)),{message:o})),typeof n<"u"&&(o.data=n),pD(o.code)&&(o=fD(o.code)),o)}const vD="^wss?:";function yD(o){const n=o.match(new RegExp(/^\w+:/,"gi"));if(!(!n||!n.length))return n[0]}function mD(o,n){const r=yD(o);return typeof r>"u"?!1:new RegExp(n).test(r)}function _c(o){return mD(o,vD)}function wD(o){return new RegExp("wss?://localhost(:d{2,5})?").test(o)}const bD=()=>typeof WebSocket<"u"?WebSocket:typeof jt.global<"u"&&typeof jt.global.WebSocket<"u"?jt.global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),_D=()=>typeof WebSocket<"u"||typeof jt.global<"u"&&typeof jt.global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",Ec=o=>o.split("?")[0],Cc=10,ED=bD();let CD=class{constructor(o){if(this.url=o,this.events=new Zt.EventEmitter,this.registering=!1,!_c(o))throw new Error(`Provided URL is not compatible with WebSocket connection: ${o}`);this.url=o}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(o,n){this.events.on(o,n)}once(o,n){this.events.once(o,n)}off(o,n){this.events.off(o,n)}removeListener(o,n){this.events.removeListener(o,n)}async open(o=this.url){await this.register(o)}async close(){return new Promise((o,n)=>{if(typeof this.socket>"u"){n(new Error("Connection already closed"));return}this.socket.onclose=r=>{this.onClose(r),o()},this.socket.close()})}async send(o){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(oD(o))}catch(n){this.onError(o.id,n)}}register(o=this.url){if(!_c(o))throw new Error(`Provided URL is not compatible with WebSocket connection: ${o}`);if(this.registering){const n=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=n||this.events.listenerCount("open")>=n)&&this.events.setMaxListeners(n+1),new Promise((r,s)=>{this.events.once("register_error",a=>{this.resetMaxListeners(),s(a)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return s(new Error("WebSocket connection is missing or invalid"));r(this.socket)})})}return this.url=o,this.registering=!0,new Promise((n,r)=>{const s=new URLSearchParams(o).get("origin"),a=y8.isReactNative()?{headers:{origin:s}}:{rejectUnauthorized:!wD(o)},h=new ED(o,[],a);_D()?h.onerror=p=>{const d=p;r(this.emitError(d.error))}:h.on("error",p=>{r(this.emitError(p))}),h.onopen=()=>{this.onOpen(h),n(h)}})}onOpen(o){o.onmessage=n=>this.onPayload(n),o.onclose=n=>this.onClose(n),this.socket=o,this.registering=!1,this.events.emit("open")}onClose(o){this.socket=void 0,this.registering=!1,this.events.emit("close",o)}onPayload(o){if(typeof o.data>"u")return;const n=typeof o.data=="string"?sD(o.data):o.data;this.events.emit("payload",n)}onError(o,n){const r=this.parseError(n),s=r.message||r.toString(),a=gD(o,s);this.events.emit("payload",a)}parseError(o,n=this.url){return dD(o,Ec(n),"WS")}resetMaxListeners(){this.events.getMaxListeners()>Cc&&this.events.setMaxListeners(Cc)}emitError(o){const n=this.parseError(new Error(o?.message||`WebSocket connection failed for host: ${Ec(this.url)}`));return this.events.emit("register_error",n),n}};var Wi={exports:{}};Wi.exports,function(o,n){var r=200,s="__lodash_hash_undefined__",a=1,h=2,p=9007199254740991,d="[object Arguments]",m="[object Array]",v="[object AsyncFunction]",E="[object Boolean]",C="[object Date]",S="[object Error]",z="[object Function]",I="[object GeneratorFunction]",T="[object Map]",k="[object Number]",K="[object Null]",X="[object Object]",H="[object Promise]",B="[object Proxy]",W="[object RegExp]",x="[object Set]",q="[object String]",F="[object Symbol]",ie="[object Undefined]",re="[object WeakMap]",de="[object ArrayBuffer]",qe="[object DataView]",We="[object Float32Array]",Z="[object Float64Array]",at="[object Int8Array]",wr="[object Int16Array]",qt="[object Int32Array]",Ct="[object Uint8Array]",ai="[object Uint8ClampedArray]",Pe="[object Uint16Array]",He="[object Uint32Array]",fn=/[\\^$.*+?()[\]{}|]/g,br=/^\[object .+?Constructor\]$/,dn=/^(?:0|[1-9]\d*)$/,le={};le[We]=le[Z]=le[at]=le[wr]=le[qt]=le[Ct]=le[ai]=le[Pe]=le[He]=!0,le[d]=le[m]=le[de]=le[E]=le[qe]=le[C]=le[S]=le[z]=le[T]=le[k]=le[X]=le[W]=le[x]=le[q]=le[re]=!1;var Qe=typeof lo=="object"&&lo&&lo.Object===Object&&lo,Vo=typeof self=="object"&&self&&self.Object===Object&&self,et=Qe||Vo||Function("return this")(),_r=n&&!n.nodeType&&n,ts=_r&&!0&&o&&!o.nodeType&&o,Br=ts&&ts.exports===_r,Er=Br&&Qe.process,ui=function(){try{return Er&&Er.binding&&Er.binding("util")}catch{}}(),ut=ui&&ui.isTypedArray;function Vr(g,b){for(var N=-1,U=g==null?0:g.length,we=0,ne=[];++N<U;){var Ee=g[N];b(Ee,N,g)&&(ne[we++]=Ee)}return ne}function Ho(g,b){for(var N=-1,U=b.length,we=g.length;++N<U;)g[we+N]=b[N];return g}function Ft(g,b){for(var N=-1,U=g==null?0:g.length;++N<U;)if(b(g[N],N,g))return!0;return!1}function rs(g,b){for(var N=-1,U=Array(g);++N<g;)U[N]=b(N);return U}function Ko(g){return function(b){return g(b)}}function Hr(g,b){return g.has(b)}function Dt(g,b){return g?.[b]}function Kr(g){var b=-1,N=Array(g.size);return g.forEach(function(U,we){N[++b]=[we,U]}),N}function gn(g,b){return function(N){return g(b(N))}}function Go(g){var b=-1,N=Array(g.size);return g.forEach(function(U){N[++b]=U}),N}var Gr=Array.prototype,Wo=Function.prototype,Kt=Object.prototype,Gt=et["__core-js_shared__"],Dn=Wo.toString,ct=Kt.hasOwnProperty,vn=function(){var g=/[^.]+$/.exec(Gt&&Gt.keys&&Gt.keys.IE_PROTO||"");return g?"Symbol(src)_1."+g:""}(),yn=Kt.toString,ci=RegExp("^"+Dn.call(ct).replace(fn,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),mn=Br?et.Buffer:void 0,Cr=et.Symbol,wn=et.Uint8Array,bn=Kt.propertyIsEnumerable,Qo=Gr.splice,nr=Cr?Cr.toStringTag:void 0,ns=Object.getOwnPropertySymbols,is=mn?mn.isBuffer:void 0,ss=gn(Object.keys,Object),hi=vt(et,"DataView"),Wr=vt(et,"Map"),li=vt(et,"Promise"),pi=vt(et,"Set"),_n=vt(et,"WeakMap"),Qr=vt(Object,"create"),Yo=or(hi),Jo=or(Wr),fi=or(li),Xo=or(pi),di=or(_n),os=Cr?Cr.prototype:void 0,gi=os?os.valueOf:void 0;function ir(g){var b=-1,N=g==null?0:g.length;for(this.clear();++b<N;){var U=g[b];this.set(U[0],U[1])}}function Zo(){this.__data__=Qr?Qr(null):{},this.size=0}function ea(g){var b=this.has(g)&&delete this.__data__[g];return this.size-=b?1:0,b}function ta(g){var b=this.__data__;if(Qr){var N=b[g];return N===s?void 0:N}return ct.call(b,g)?b[g]:void 0}function ra(g){var b=this.__data__;return Qr?b[g]!==void 0:ct.call(b,g)}function na(g,b){var N=this.__data__;return this.size+=this.has(g)?0:1,N[g]=Qr&&b===void 0?s:b,this}ir.prototype.clear=Zo,ir.prototype.delete=ea,ir.prototype.get=ta,ir.prototype.has=ra,ir.prototype.set=na;function It(g){var b=-1,N=g==null?0:g.length;for(this.clear();++b<N;){var U=g[b];this.set(U[0],U[1])}}function ia(){this.__data__=[],this.size=0}function sa(g){var b=this.__data__,N=Yr(b,g);if(N<0)return!1;var U=b.length-1;return N==U?b.pop():Qo.call(b,N,1),--this.size,!0}function oa(g){var b=this.__data__,N=Yr(b,g);return N<0?void 0:b[N][1]}function aa(g){return Yr(this.__data__,g)>-1}function ua(g,b){var N=this.__data__,U=Yr(N,g);return U<0?(++this.size,N.push([g,b])):N[U][1]=b,this}It.prototype.clear=ia,It.prototype.delete=sa,It.prototype.get=oa,It.prototype.has=aa,It.prototype.set=ua;function sr(g){var b=-1,N=g==null?0:g.length;for(this.clear();++b<N;){var U=g[b];this.set(U[0],U[1])}}function En(){this.size=0,this.__data__={hash:new ir,map:new(Wr||It),string:new ir}}function ca(g){var b=Ir(this,g).delete(g);return this.size-=b?1:0,b}function Cn(g){return Ir(this,g).get(g)}function ha(g){return Ir(this,g).has(g)}function la(g,b){var N=Ir(this,g),U=N.size;return N.set(g,b),this.size+=N.size==U?0:1,this}sr.prototype.clear=En,sr.prototype.delete=ca,sr.prototype.get=Cn,sr.prototype.has=ha,sr.prototype.set=la;function In(g){var b=-1,N=g==null?0:g.length;for(this.__data__=new sr;++b<N;)this.add(g[b])}function as(g){return this.__data__.set(g,s),this}function us(g){return this.__data__.has(g)}In.prototype.add=In.prototype.push=as,In.prototype.has=us;function Lt(g){var b=this.__data__=new It(g);this.size=b.size}function pa(){this.__data__=new It,this.size=0}function fa(g){var b=this.__data__,N=b.delete(g);return this.size=b.size,N}function da(g){return this.__data__.get(g)}function ga(g){return this.__data__.has(g)}function cs(g,b){var N=this.__data__;if(N instanceof It){var U=N.__data__;if(!Wr||U.length<r-1)return U.push([g,b]),this.size=++N.size,this;N=this.__data__=new sr(U)}return N.set(g,b),this.size=N.size,this}Lt.prototype.clear=pa,Lt.prototype.delete=fa,Lt.prototype.get=da,Lt.prototype.has=ga,Lt.prototype.set=cs;function hs(g,b){var N=xn(g),U=!N&&_s(g),we=!N&&!U&&yi(g),ne=!N&&!U&&!we&&Is(g),Ee=N||U||we||ne,Te=Ee?rs(g.length,String):[],pe=Te.length;for(var be in g)(b||ct.call(g,be))&&!(Ee&&(be=="length"||we&&(be=="offset"||be=="parent")||ne&&(be=="buffer"||be=="byteLength"||be=="byteOffset")||vs(be,pe)))&&Te.push(be);return Te}function Yr(g,b){for(var N=g.length;N--;)if(bs(g[N][0],b))return N;return-1}function Di(g,b,N){var U=b(g);return xn(g)?U:Ho(U,N(g))}function Jr(g){return g==null?g===void 0?ie:K:nr&&nr in Object(g)?gs(g):ya(g)}function vi(g){return Zr(g)&&Jr(g)==d}function Xr(g,b,N,U,we){return g===b?!0:g==null||b==null||!Zr(g)&&!Zr(b)?g!==g&&b!==b:ls(g,b,N,U,Xr,we)}function ls(g,b,N,U,we,ne){var Ee=xn(g),Te=xn(b),pe=Ee?m:Wt(g),be=Te?m:Wt(b);pe=pe==d?X:pe,be=be==d?X:be;var Oe=pe==X,ht=be==X,je=pe==be;if(je&&yi(g)){if(!yi(b))return!1;Ee=!0,Oe=!1}if(je&&!Oe)return ne||(ne=new Lt),Ee||Is(g)?Pn(g,b,N,U,we,ne):va(g,b,pe,N,U,we,ne);if(!(N&a)){var Ce=Oe&&ct.call(g,"__wrapped__"),tt=ht&&ct.call(b,"__wrapped__");if(Ce||tt){var Ut=Ce?g.value():g,Pt=tt?b.value():b;return ne||(ne=new Lt),we(Ut,Pt,N,U,ne)}}return je?(ne||(ne=new Lt),ds(g,b,N,U,we,ne)):!1}function Da(g){if(!Cs(g)||ms(g))return!1;var b=An(g)?ci:br;return b.test(or(g))}function ps(g){return Zr(g)&&Es(g.length)&&!!le[Jr(g)]}function fs(g){if(!ws(g))return ss(g);var b=[];for(var N in Object(g))ct.call(g,N)&&N!="constructor"&&b.push(N);return b}function Pn(g,b,N,U,we,ne){var Ee=N&a,Te=g.length,pe=b.length;if(Te!=pe&&!(Ee&&pe>Te))return!1;var be=ne.get(g);if(be&&ne.get(b))return be==b;var Oe=-1,ht=!0,je=N&h?new In:void 0;for(ne.set(g,b),ne.set(b,g);++Oe<Te;){var Ce=g[Oe],tt=b[Oe];if(U)var Ut=Ee?U(tt,Ce,Oe,b,g,ne):U(Ce,tt,Oe,g,b,ne);if(Ut!==void 0){if(Ut)continue;ht=!1;break}if(je){if(!Ft(b,function(Pt,Qt){if(!Hr(je,Qt)&&(Ce===Pt||we(Ce,Pt,N,U,ne)))return je.push(Qt)})){ht=!1;break}}else if(!(Ce===tt||we(Ce,tt,N,U,ne))){ht=!1;break}}return ne.delete(g),ne.delete(b),ht}function va(g,b,N,U,we,ne,Ee){switch(N){case qe:if(g.byteLength!=b.byteLength||g.byteOffset!=b.byteOffset)return!1;g=g.buffer,b=b.buffer;case de:return!(g.byteLength!=b.byteLength||!ne(new wn(g),new wn(b)));case E:case C:case k:return bs(+g,+b);case S:return g.name==b.name&&g.message==b.message;case W:case q:return g==b+"";case T:var Te=Kr;case x:var pe=U&a;if(Te||(Te=Go),g.size!=b.size&&!pe)return!1;var be=Ee.get(g);if(be)return be==b;U|=h,Ee.set(g,b);var Oe=Pn(Te(g),Te(b),U,we,ne,Ee);return Ee.delete(g),Oe;case F:if(gi)return gi.call(g)==gi.call(b)}return!1}function ds(g,b,N,U,we,ne){var Ee=N&a,Te=Sn(g),pe=Te.length,be=Sn(b),Oe=be.length;if(pe!=Oe&&!Ee)return!1;for(var ht=pe;ht--;){var je=Te[ht];if(!(Ee?je in b:ct.call(b,je)))return!1}var Ce=ne.get(g);if(Ce&&ne.get(b))return Ce==b;var tt=!0;ne.set(g,b),ne.set(b,g);for(var Ut=Ee;++ht<pe;){je=Te[ht];var Pt=g[je],Qt=b[je];if(U)var mi=Ee?U(Qt,Pt,je,b,g,ne):U(Pt,Qt,je,g,b,ne);if(!(mi===void 0?Pt===Qt||we(Pt,Qt,N,U,ne):mi)){tt=!1;break}Ut||(Ut=je=="constructor")}if(tt&&!Ut){var en=g.constructor,Me=b.constructor;en!=Me&&"constructor"in g&&"constructor"in b&&!(typeof en=="function"&&en instanceof en&&typeof Me=="function"&&Me instanceof Me)&&(tt=!1)}return ne.delete(g),ne.delete(b),tt}function Sn(g){return Di(g,ba,Ds)}function Ir(g,b){var N=g.__data__;return ys(b)?N[typeof b=="string"?"string":"hash"]:N.map}function vt(g,b){var N=Dt(g,b);return Da(N)?N:void 0}function gs(g){var b=ct.call(g,nr),N=g[nr];try{g[nr]=void 0;var U=!0}catch{}var we=yn.call(g);return U&&(b?g[nr]=N:delete g[nr]),we}var Ds=ns?function(g){return g==null?[]:(g=Object(g),Vr(ns(g),function(b){return bn.call(g,b)}))}:me,Wt=Jr;(hi&&Wt(new hi(new ArrayBuffer(1)))!=qe||Wr&&Wt(new Wr)!=T||li&&Wt(li.resolve())!=H||pi&&Wt(new pi)!=x||_n&&Wt(new _n)!=re)&&(Wt=function(g){var b=Jr(g),N=b==X?g.constructor:void 0,U=N?or(N):"";if(U)switch(U){case Yo:return qe;case Jo:return T;case fi:return H;case Xo:return x;case di:return re}return b});function vs(g,b){return b=b??p,!!b&&(typeof g=="number"||dn.test(g))&&g>-1&&g%1==0&&g<b}function ys(g){var b=typeof g;return b=="string"||b=="number"||b=="symbol"||b=="boolean"?g!=="__proto__":g===null}function ms(g){return!!vn&&vn in g}function ws(g){var b=g&&g.constructor,N=typeof b=="function"&&b.prototype||Kt;return g===N}function ya(g){return yn.call(g)}function or(g){if(g!=null){try{return Dn.call(g)}catch{}try{return g+""}catch{}}return""}function bs(g,b){return g===b||g!==g&&b!==b}var _s=vi(function(){return arguments}())?vi:function(g){return Zr(g)&&ct.call(g,"callee")&&!bn.call(g,"callee")},xn=Array.isArray;function ma(g){return g!=null&&Es(g.length)&&!An(g)}var yi=is||ye;function wa(g,b){return Xr(g,b)}function An(g){if(!Cs(g))return!1;var b=Jr(g);return b==z||b==I||b==v||b==B}function Es(g){return typeof g=="number"&&g>-1&&g%1==0&&g<=p}function Cs(g){var b=typeof g;return g!=null&&(b=="object"||b=="function")}function Zr(g){return g!=null&&typeof g=="object"}var Is=ut?Ko(ut):ps;function ba(g){return ma(g)?hs(g):fs(g)}function me(){return[]}function ye(){return!1}o.exports=wa}(Wi,Wi.exports);var ID=Wi.exports;const PD=Ap(ID);function SD(o,n){return n=n||{},new Promise(function(r,s){var a=new XMLHttpRequest,h=[],p=[],d={},m=function(){return{ok:(a.status/100|0)==2,statusText:a.statusText,status:a.status,url:a.responseURL,text:function(){return Promise.resolve(a.responseText)},json:function(){return Promise.resolve(a.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([a.response]))},clone:m,headers:{keys:function(){return h},entries:function(){return p},get:function(E){return d[E.toLowerCase()]},has:function(E){return E.toLowerCase()in d}}}};for(var v in a.open(n.method||"get",o,!0),a.onload=function(){a.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(E,C,S){h.push(C=C.toLowerCase()),p.push([C,S]),d[C]=d[C]?d[C]+","+S:S}),r(m())},a.onerror=s,a.withCredentials=n.credentials=="include",n.headers)a.setRequestHeader(v,n.headers[v]);a.send(n.body||null)})}const xD=Object.freeze(Object.defineProperty({__proto__:null,default:SD},Symbol.toStringTag,{value:"Module"})),Ic=Sp(xD);var AD=self.fetch||(self.fetch=Ic.default||Ic);const OD=Ap(AD);function RD(o,n){if(o.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),s=0;s<r.length;s++)r[s]=255;for(var a=0;a<o.length;a++){var h=o.charAt(a),p=h.charCodeAt(0);if(r[p]!==255)throw new TypeError(h+" is ambiguous");r[p]=a}var d=o.length,m=o.charAt(0),v=Math.log(d)/Math.log(256),E=Math.log(256)/Math.log(d);function C(I){if(I instanceof Uint8Array||(ArrayBuffer.isView(I)?I=new Uint8Array(I.buffer,I.byteOffset,I.byteLength):Array.isArray(I)&&(I=Uint8Array.from(I))),!(I instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(I.length===0)return"";for(var T=0,k=0,K=0,X=I.length;K!==X&&I[K]===0;)K++,T++;for(var H=(X-K)*E+1>>>0,B=new Uint8Array(H);K!==X;){for(var W=I[K],x=0,q=H-1;(W!==0||x<k)&&q!==-1;q--,x++)W+=256*B[q]>>>0,B[q]=W%d>>>0,W=W/d>>>0;if(W!==0)throw new Error("Non-zero carry");k=x,K++}for(var F=H-k;F!==H&&B[F]===0;)F++;for(var ie=m.repeat(T);F<H;++F)ie+=o.charAt(B[F]);return ie}function S(I){if(typeof I!="string")throw new TypeError("Expected String");if(I.length===0)return new Uint8Array;var T=0;if(I[T]!==" "){for(var k=0,K=0;I[T]===m;)k++,T++;for(var X=(I.length-T)*v+1>>>0,H=new Uint8Array(X);I[T];){var B=r[I.charCodeAt(T)];if(B===255)return;for(var W=0,x=X-1;(B!==0||W<K)&&x!==-1;x--,W++)B+=d*H[x]>>>0,H[x]=B%256>>>0,B=B/256>>>0;if(B!==0)throw new Error("Non-zero carry");K=W,T++}if(I[T]!==" "){for(var q=X-K;q!==X&&H[q]===0;)q++;for(var F=new Uint8Array(k+(X-q)),ie=k;q!==X;)F[ie++]=H[q++];return F}}}function z(I){var T=S(I);if(T)return T;throw new Error(`Non-${n} character`)}return{encode:C,decodeUnsafe:S,decode:z}}var ND=RD,TD=ND;const Pc=o=>{if(o instanceof Uint8Array&&o.constructor.name==="Uint8Array")return o;if(o instanceof ArrayBuffer)return new Uint8Array(o);if(ArrayBuffer.isView(o))return new Uint8Array(o.buffer,o.byteOffset,o.byteLength);throw new Error("Unknown type, must be binary type")},jD=o=>new TextEncoder().encode(o),zD=o=>new TextDecoder().decode(o);class qD{constructor(n,r,s){this.name=n,this.prefix=r,this.baseEncode=s}encode(n){if(n instanceof Uint8Array)return`${this.prefix}${this.baseEncode(n)}`;throw Error("Unknown type, must be binary type")}}class FD{constructor(n,r,s){if(this.name=n,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=s}decode(n){if(typeof n=="string"){if(n.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(n)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(n.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(n){return Sc(this,n)}}class LD{constructor(n){this.decoders=n}or(n){return Sc(this,n)}decode(n){const r=n[0],s=this.decoders[r];if(s)return s.decode(n);throw RangeError(`Unable to decode multibase string ${JSON.stringify(n)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Sc=(o,n)=>new LD({...o.decoders||{[o.prefix]:o},...n.decoders||{[n.prefix]:n}});class UD{constructor(n,r,s,a){this.name=n,this.prefix=r,this.baseEncode=s,this.baseDecode=a,this.encoder=new qD(n,r,s),this.decoder=new FD(n,r,a)}encode(n){return this.encoder.encode(n)}decode(n){return this.decoder.decode(n)}}const Qi=({name:o,prefix:n,encode:r,decode:s})=>new UD(o,n,r,s),Zn=({prefix:o,name:n,alphabet:r})=>{const{encode:s,decode:a}=TD(r,n);return Qi({prefix:o,name:n,encode:s,decode:h=>Pc(a(h))})},MD=(o,n,r,s)=>{const a={};for(let E=0;E<n.length;++E)a[n[E]]=E;let h=o.length;for(;o[h-1]==="=";)--h;const p=new Uint8Array(h*r/8|0);let d=0,m=0,v=0;for(let E=0;E<h;++E){const C=a[o[E]];if(C===void 0)throw new SyntaxError(`Non-${s} character`);m=m<<r|C,d+=r,d>=8&&(d-=8,p[v++]=255&m>>d)}if(d>=r||255&m<<8-d)throw new SyntaxError("Unexpected end of data");return p},$D=(o,n,r)=>{const s=n[n.length-1]==="=",a=(1<<r)-1;let h="",p=0,d=0;for(let m=0;m<o.length;++m)for(d=d<<8|o[m],p+=8;p>r;)p-=r,h+=n[a&d>>p];if(p&&(h+=n[a&d<<r-p]),s)for(;h.length*r&7;)h+="=";return h},Ve=({name:o,prefix:n,bitsPerChar:r,alphabet:s})=>Qi({prefix:n,name:o,encode(a){return $D(a,s,r)},decode(a){return MD(a,s,r,o)}}),kD=Qi({prefix:"\0",name:"identity",encode:o=>zD(o),decode:o=>jD(o)});var BD=Object.freeze({__proto__:null,identity:kD});const VD=Ve({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var HD=Object.freeze({__proto__:null,base2:VD});const KD=Ve({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var GD=Object.freeze({__proto__:null,base8:KD});const WD=Zn({prefix:"9",name:"base10",alphabet:"0123456789"});var QD=Object.freeze({__proto__:null,base10:WD});const YD=Ve({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),JD=Ve({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var XD=Object.freeze({__proto__:null,base16:YD,base16upper:JD});const ZD=Ve({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),ev=Ve({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),tv=Ve({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),rv=Ve({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),nv=Ve({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),iv=Ve({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),sv=Ve({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),ov=Ve({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),av=Ve({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var uv=Object.freeze({__proto__:null,base32:ZD,base32upper:ev,base32pad:tv,base32padupper:rv,base32hex:nv,base32hexupper:iv,base32hexpad:sv,base32hexpadupper:ov,base32z:av});const cv=Zn({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),hv=Zn({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var lv=Object.freeze({__proto__:null,base36:cv,base36upper:hv});const pv=Zn({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),fv=Zn({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var dv=Object.freeze({__proto__:null,base58btc:pv,base58flickr:fv});const gv=Ve({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Dv=Ve({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),vv=Ve({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),yv=Ve({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var mv=Object.freeze({__proto__:null,base64:gv,base64pad:Dv,base64url:vv,base64urlpad:yv});const xc=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),wv=xc.reduce((o,n,r)=>(o[r]=n,o),[]),bv=xc.reduce((o,n,r)=>(o[n.codePointAt(0)]=r,o),[]);function _v(o){return o.reduce((n,r)=>(n+=wv[r],n),"")}function Ev(o){const n=[];for(const r of o){const s=bv[r.codePointAt(0)];if(s===void 0)throw new Error(`Non-base256emoji character: ${r}`);n.push(s)}return new Uint8Array(n)}const Cv=Qi({prefix:"\u{1F680}",name:"base256emoji",encode:_v,decode:Ev});var Iv=Object.freeze({__proto__:null,base256emoji:Cv}),Pv=Oc,Ac=128,Sv=127,xv=~Sv,Av=Math.pow(2,31);function Oc(o,n,r){n=n||[],r=r||0;for(var s=r;o>=Av;)n[r++]=o&255|Ac,o/=128;for(;o&xv;)n[r++]=o&255|Ac,o>>>=7;return n[r]=o|0,Oc.bytes=r-s+1,n}var Ov=So,Rv=128,Rc=127;function So(o,s){var r=0,s=s||0,a=0,h=s,p,d=o.length;do{if(h>=d)throw So.bytes=0,new RangeError("Could not decode varint");p=o[h++],r+=a<28?(p&Rc)<<a:(p&Rc)*Math.pow(2,a),a+=7}while(p>=Rv);return So.bytes=h-s,r}var Nv=Math.pow(2,7),Tv=Math.pow(2,14),jv=Math.pow(2,21),zv=Math.pow(2,28),qv=Math.pow(2,35),Fv=Math.pow(2,42),Lv=Math.pow(2,49),Uv=Math.pow(2,56),Mv=Math.pow(2,63),$v=function(o){return o<Nv?1:o<Tv?2:o<jv?3:o<zv?4:o<qv?5:o<Fv?6:o<Lv?7:o<Uv?8:o<Mv?9:10},kv={encode:Pv,decode:Ov,encodingLength:$v},Nc=kv;const Tc=(o,n,r=0)=>(Nc.encode(o,n,r),n),jc=o=>Nc.encodingLength(o),xo=(o,n)=>{const r=n.byteLength,s=jc(o),a=s+jc(r),h=new Uint8Array(a+r);return Tc(o,h,0),Tc(r,h,s),h.set(n,a),new Bv(o,r,n,h)};class Bv{constructor(n,r,s,a){this.code=n,this.size=r,this.digest=s,this.bytes=a}}const zc=({name:o,code:n,encode:r})=>new Vv(o,n,r);class Vv{constructor(n,r,s){this.name=n,this.code=r,this.encode=s}digest(n){if(n instanceof Uint8Array){const r=this.encode(n);return r instanceof Uint8Array?xo(this.code,r):r.then(s=>xo(this.code,s))}else throw Error("Unknown type, must be binary type")}}const qc=o=>async n=>new Uint8Array(await crypto.subtle.digest(o,n)),Hv=zc({name:"sha2-256",code:18,encode:qc("SHA-256")}),Kv=zc({name:"sha2-512",code:19,encode:qc("SHA-512")});var Gv=Object.freeze({__proto__:null,sha256:Hv,sha512:Kv});const Fc=0,Wv="identity",Lc=Pc;var Qv=Object.freeze({__proto__:null,identity:{code:Fc,name:Wv,encode:Lc,digest:o=>xo(Fc,Lc(o))}});new TextEncoder,new TextDecoder;const Uc={...BD,...HD,...GD,...QD,...XD,...uv,...lv,...dv,...mv,...Iv};({...Gv,...Qv});function Mc(o){return globalThis.Buffer!=null?new Uint8Array(o.buffer,o.byteOffset,o.byteLength):o}function Yv(o=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Mc(globalThis.Buffer.allocUnsafe(o)):new Uint8Array(o)}function $c(o,n,r,s){return{name:o,prefix:n,encoder:{name:o,prefix:n,encode:r},decoder:{decode:s}}}const kc=$c("utf8","u",o=>"u"+new TextDecoder("utf8").decode(o),o=>new TextEncoder().encode(o.substring(1))),Ao=$c("ascii","a",o=>{let n="a";for(let r=0;r<o.length;r++)n+=String.fromCharCode(o[r]);return n},o=>{o=o.substring(1);const n=Yv(o.length);for(let r=0;r<o.length;r++)n[r]=o.charCodeAt(r);return n}),Jv={utf8:kc,"utf-8":kc,hex:Uc.base16,latin1:Ao,ascii:Ao,binary:Ao,...Uc};function Xv(o,n="utf8"){const r=Jv[n];if(!r)throw new Error(`Unsupported encoding "${n}"`);return(n==="utf8"||n==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Mc(globalThis.Buffer.from(o,"utf-8")):r.decoder.decode(`${r.prefix}${o}`)}const Bc="wc",Zv=2,Oo="core",yr=`${Bc}@2:${Oo}:`,ey={name:Oo,logger:"error"},ty={database:":memory:"},ry="crypto",Vc="client_ed25519_seed",ny=G.ONE_DAY,iy="keychain",sy="0.3",oy="messages",ay="0.3",uy=G.SIX_HOURS,cy="publisher",Hc="irn",hy="error",Kc="wss://relay.walletconnect.com",Gc="wss://relay.walletconnect.org",ly="relayer",Ge={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},py="_subscription",er={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},fy=G.ONE_SECOND,dy="2.11.0",gy=1e4,Dy="0.3",vy="WALLETCONNECT_CLIENT_ID",zt={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},yy="subscription",my="0.3",wy=G.FIVE_SECONDS*1e3,by="pairing",_y="0.3",ei={wc_pairingDelete:{req:{ttl:G.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:G.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:G.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:G.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:G.ONE_DAY,prompt:!1,tag:0},res:{ttl:G.ONE_DAY,prompt:!1,tag:0}}},ti={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},Ht={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},Ey="history",Cy="0.3",Iy="expirer",Et={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},Py="0.3",Ro="verify-api",pn="https://verify.walletconnect.com",No="https://verify.walletconnect.org",Sy=[pn,No],xy="echo",Ay="https://echo.walletconnect.com";class Oy{constructor(n,r){this.core=n,this.logger=r,this.keychain=new Map,this.name=iy,this.version=sy,this.initialized=!1,this.storagePrefix=yr,this.init=async()=>{if(!this.initialized){const s=await this.getKeyChain();typeof s<"u"&&(this.keychain=s),this.initialized=!0}},this.has=s=>(this.isInitialized(),this.keychain.has(s)),this.set=async(s,a)=>{this.isInitialized(),this.keychain.set(s,a),await this.persist()},this.get=s=>{this.isInitialized();const a=this.keychain.get(s);if(typeof a>"u"){const{message:h}=M("NO_MATCHING_KEY",`${this.name}: ${s}`);throw new Error(h)}return a},this.del=async s=>{this.isInitialized(),this.keychain.delete(s),await this.persist()},this.core=n,this.logger=ce.generateChildLogger(r,this.name)}get context(){return ce.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(n){await this.core.storage.setItem(this.storageKey,Fp(n))}async getKeyChain(){const n=await this.core.storage.getItem(this.storageKey);return typeof n<"u"?Lp(n):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:n}=M("NOT_INITIALIZED",this.name);throw new Error(n)}}}class Ry{constructor(n,r,s){this.core=n,this.logger=r,this.name=ry,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=a=>(this.isInitialized(),this.keychain.has(a)),this.getClientId=async()=>{this.isInitialized();const a=await this.getClientSeed(),h=fc(a);return pc(h.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const a=T1();return this.setPrivateKey(a.publicKey,a.privateKey)},this.signJWT=async a=>{this.isInitialized();const h=await this.getClientSeed(),p=fc(h),d=Iu();return await ng(d,a,ny,p)},this.generateSharedKey=(a,h,p)=>{this.isInitialized();const d=this.getPrivateKey(a),m=j1(d,h);return this.setSymKey(m,p)},this.setSymKey=async(a,h)=>{this.isInitialized();const p=h||z1(a);return await this.keychain.set(p,a),p},this.deleteKeyPair=async a=>{this.isInitialized(),await this.keychain.del(a)},this.deleteSymKey=async a=>{this.isInitialized(),await this.keychain.del(a)},this.encode=async(a,h,p)=>{this.isInitialized();const d=q1(p),m=Kf(h);if(Op(d)){const S=d.senderPublicKey,z=d.receiverPublicKey;a=await this.generateSharedKey(S,z)}const v=this.getSymKey(a),{type:E,senderPublicKey:C}=d;return F1({type:E,symKey:v,message:m,senderPublicKey:C})},this.decode=async(a,h,p)=>{this.isInitialized();const d=L1(h,p);if(Op(d)){const m=d.receiverPublicKey,v=d.senderPublicKey;a=await this.generateSharedKey(m,v)}try{const m=this.getSymKey(a),v=U1({symKey:m,encoded:h});return Hf(v)}catch(m){this.logger.error(`Failed to decode message from topic: '${a}', clientId: '${await this.getClientId()}'`),this.logger.error(m)}},this.getPayloadType=a=>{const h=Rp(a);return M1(h.type)},this.getPayloadSenderPublicKey=a=>{const h=Rp(a);return h.senderPublicKey?rD(h.senderPublicKey,Y1):void 0},this.core=n,this.logger=ce.generateChildLogger(r,this.name),this.keychain=s||new Oy(this.core,this.logger)}get context(){return ce.getLoggerContext(this.logger)}async setPrivateKey(n,r){return await this.keychain.set(n,r),n}getPrivateKey(n){return this.keychain.get(n)}async getClientSeed(){let n="";try{n=this.keychain.get(Vc)}catch{n=Iu(),await this.keychain.set(Vc,n)}return Xv(n,"base16")}getSymKey(n){return this.keychain.get(n)}isInitialized(){if(!this.initialized){const{message:n}=M("NOT_INITIALIZED",this.name);throw new Error(n)}}}class Ny extends Tf{constructor(n,r){super(n,r),this.logger=n,this.core=r,this.messages=new Map,this.name=oy,this.version=ay,this.initialized=!1,this.storagePrefix=yr,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const s=await this.getRelayerMessages();typeof s<"u"&&(this.messages=s),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(s){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(s)}finally{this.initialized=!0}}},this.set=async(s,a)=>{this.isInitialized();const h=Hn(a);let p=this.messages.get(s);return typeof p>"u"&&(p={}),typeof p[h]<"u"||(p[h]=a,this.messages.set(s,p),await this.persist()),h},this.get=s=>{this.isInitialized();let a=this.messages.get(s);return typeof a>"u"&&(a={}),a},this.has=(s,a)=>{this.isInitialized();const h=this.get(s),p=Hn(a);return typeof h[p]<"u"},this.del=async s=>{this.isInitialized(),this.messages.delete(s),await this.persist()},this.logger=ce.generateChildLogger(n,this.name),this.core=r}get context(){return ce.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setRelayerMessages(n){await this.core.storage.setItem(this.storageKey,Fp(n))}async getRelayerMessages(){const n=await this.core.storage.getItem(this.storageKey);return typeof n<"u"?Lp(n):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:n}=M("NOT_INITIALIZED",this.name);throw new Error(n)}}}class Ty extends jf{constructor(n,r){super(n,r),this.relayer=n,this.logger=r,this.events=new Zt.EventEmitter,this.name=cy,this.queue=new Map,this.publishTimeout=G.toMiliseconds(G.TEN_SECONDS),this.needsTransportRestart=!1,this.publish=async(s,a,h)=>{var p;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:s,message:a,opts:h}});try{const d=h?.ttl||uy,m=Su(h),v=h?.prompt||!1,E=h?.tag||0,C=h?.id||m8().toString(),S={topic:s,message:a,opts:{ttl:d,relay:m,prompt:v,tag:E,id:C}},z=setTimeout(()=>this.queue.set(C,S),this.publishTimeout);try{await await qi(this.rpcPublish(s,a,d,m,v,E,C),this.publishTimeout,"Failed to publish payload, please try again."),this.removeRequestFromQueue(C),this.relayer.events.emit(Ge.publish,S)}catch(I){if(this.logger.debug("Publishing Payload stalled"),this.needsTransportRestart=!0,(p=h?.internal)!=null&&p.throwOnFailedPublish)throw this.removeRequestFromQueue(C),I;return}finally{clearTimeout(z)}this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:s,message:a,opts:h}})}catch(d){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(d),d}},this.on=(s,a)=>{this.events.on(s,a)},this.once=(s,a)=>{this.events.once(s,a)},this.off=(s,a)=>{this.events.off(s,a)},this.removeListener=(s,a)=>{this.events.removeListener(s,a)},this.relayer=n,this.logger=ce.generateChildLogger(r,this.name),this.registerEventListeners()}get context(){return ce.getLoggerContext(this.logger)}rpcPublish(n,r,s,a,h,p,d){var m,v,E,C;const S={method:po(a.protocol).publish,params:{topic:n,message:r,ttl:s,prompt:h,tag:p},id:d};return zr((m=S.params)==null?void 0:m.prompt)&&((v=S.params)==null||delete v.prompt),zr((E=S.params)==null?void 0:E.tag)&&((C=S.params)==null||delete C.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:S}),this.relayer.request(S)}removeRequestFromQueue(n){this.queue.delete(n)}checkQueue(){this.queue.forEach(async n=>{const{topic:r,message:s,opts:a}=n;await this.publish(r,s,a)})}registerEventListeners(){this.relayer.core.heartbeat.on(hn.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(Ge.connection_stalled);return}this.checkQueue()}),this.relayer.on(Ge.message_ack,n=>{this.removeRequestFromQueue(n.id.toString())})}}class jy{constructor(){this.map=new Map,this.set=(n,r)=>{const s=this.get(n);this.exists(n,r)||this.map.set(n,[...s,r])},this.get=n=>this.map.get(n)||[],this.exists=(n,r)=>this.get(n).includes(r),this.delete=(n,r)=>{if(typeof r>"u"){this.map.delete(n);return}if(!this.map.has(n))return;const s=this.get(n);if(!this.exists(n,r))return;const a=s.filter(h=>h!==r);if(!a.length){this.map.delete(n);return}this.map.set(n,a)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var zy=Object.defineProperty,qy=Object.defineProperties,Fy=Object.getOwnPropertyDescriptors,Wc=Object.getOwnPropertySymbols,Ly=Object.prototype.hasOwnProperty,Uy=Object.prototype.propertyIsEnumerable,Qc=(o,n,r)=>n in o?zy(o,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[n]=r,ri=(o,n)=>{for(var r in n||(n={}))Ly.call(n,r)&&Qc(o,r,n[r]);if(Wc)for(var r of Wc(n))Uy.call(n,r)&&Qc(o,r,n[r]);return o},To=(o,n)=>qy(o,Fy(n));class My extends Ff{constructor(n,r){super(n,r),this.relayer=n,this.logger=r,this.subscriptions=new Map,this.topicMap=new jy,this.events=new Zt.EventEmitter,this.name=yy,this.version=my,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=yr,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(s,a)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:s,opts:a}});try{const h=Su(a),p={topic:s,relay:h};this.pending.set(s,p);const d=await this.rpcSubscribe(s,h);return this.onSubscribe(d,p),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:s,opts:a}}),d}catch(h){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(h),h}},this.unsubscribe=async(s,a)=>{await this.restartToComplete(),this.isInitialized(),typeof a?.id<"u"?await this.unsubscribeById(s,a.id,a):await this.unsubscribeByTopic(s,a)},this.isSubscribed=async s=>this.topics.includes(s)?!0:await new Promise((a,h)=>{const p=new G.Watch;p.start(this.pendingSubscriptionWatchLabel);const d=setInterval(()=>{!this.pending.has(s)&&this.topics.includes(s)&&(clearInterval(d),p.stop(this.pendingSubscriptionWatchLabel),a(!0)),p.elapsed(this.pendingSubscriptionWatchLabel)>=wy&&(clearInterval(d),p.stop(this.pendingSubscriptionWatchLabel),h(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1),this.on=(s,a)=>{this.events.on(s,a)},this.once=(s,a)=>{this.events.once(s,a)},this.off=(s,a)=>{this.events.off(s,a)},this.removeListener=(s,a)=>{this.events.removeListener(s,a)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=n,this.logger=ce.generateChildLogger(r,this.name),this.clientId=""}get context(){return ce.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(n,r){let s=!1;try{s=this.getSubscription(n).topic===r}catch{}return s}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(n,r){const s=this.topicMap.get(n);await Promise.all(s.map(async a=>await this.unsubscribeById(n,a,r)))}async unsubscribeById(n,r,s){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:n,id:r,opts:s}});try{const a=Su(s);await this.rpcUnsubscribe(n,r,a);const h=Xe("USER_DISCONNECTED",`${this.name}, ${n}`);await this.onUnsubscribe(n,r,h),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:n,id:r,opts:s}})}catch(a){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(a),a}}async rpcSubscribe(n,r){const s={method:po(r.protocol).subscribe,params:{topic:n}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});try{await await qi(this.relayer.request(s),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(Ge.connection_stalled)}return Hn(n+this.clientId)}async rpcBatchSubscribe(n){if(!n.length)return;const r=n[0].relay,s={method:po(r.protocol).batchSubscribe,params:{topics:n.map(a=>a.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});try{return await await qi(this.relayer.request(s),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(Ge.connection_stalled)}}rpcUnsubscribe(n,r,s){const a={method:po(s.protocol).unsubscribe,params:{topic:n,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:a}),this.relayer.request(a)}onSubscribe(n,r){this.setSubscription(n,To(ri({},r),{id:n})),this.pending.delete(r.topic)}onBatchSubscribe(n){n.length&&n.forEach(r=>{this.setSubscription(r.id,ri({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(n,r,s){this.events.removeAllListeners(r),this.hasSubscription(r,n)&&this.deleteSubscription(r,s),await this.relayer.messages.del(n)}async setRelayerSubscriptions(n){await this.relayer.core.storage.setItem(this.storageKey,n)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(n,r){this.subscriptions.has(n)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:n,subscription:r}),this.addSubscription(n,r))}addSubscription(n,r){this.subscriptions.set(n,ri({},r)),this.topicMap.set(r.topic,n),this.events.emit(zt.created,r)}getSubscription(n){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:n});const r=this.subscriptions.get(n);if(!r){const{message:s}=M("NO_MATCHING_KEY",`${this.name}: ${n}`);throw new Error(s)}return r}deleteSubscription(n,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:n,reason:r});const s=this.getSubscription(n);this.subscriptions.delete(n),this.topicMap.delete(s.topic,n),this.events.emit(zt.deleted,To(ri({},s),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(zt.sync)}async reset(){if(this.cached.length){const n=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let r=0;r<n;r++){const s=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(s)}}this.events.emit(zt.resubscribed)}async restore(){try{const n=await this.getRelayerSubscriptions();if(typeof n>"u"||!n.length)return;if(this.subscriptions.size){const{message:r}=M("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=n,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(n){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(n)}}async batchSubscribe(n){if(!n.length)return;const r=await this.rpcBatchSubscribe(n);Kn(r)&&this.onBatchSubscribe(r.map((s,a)=>To(ri({},n[a]),{id:s})))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(!this.initialized||this.relayer.transportExplicitlyClosed)return;const n=[];this.pending.forEach(r=>{n.push(r)}),await this.batchSubscribe(n)}registerEventListeners(){this.relayer.core.heartbeat.on(hn.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.relayer.on(Ge.connect,async()=>{await this.onConnect()}),this.relayer.on(Ge.disconnect,()=>{this.onDisconnect()}),this.events.on(zt.created,async n=>{const r=zt.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:n}),await this.persist()}),this.events.on(zt.deleted,async n=>{const r=zt.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:n}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:n}=M("NOT_INITIALIZED",this.name);throw new Error(n)}}async restartToComplete(){this.restartInProgress&&await new Promise(n=>{const r=setInterval(()=>{this.restartInProgress||(clearInterval(r),n())},this.pollingInterval)})}}var $y=Object.defineProperty,Yc=Object.getOwnPropertySymbols,ky=Object.prototype.hasOwnProperty,By=Object.prototype.propertyIsEnumerable,Jc=(o,n,r)=>n in o?$y(o,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[n]=r,Vy=(o,n)=>{for(var r in n||(n={}))ky.call(n,r)&&Jc(o,r,n[r]);if(Yc)for(var r of Yc(n))By.call(n,r)&&Jc(o,r,n[r]);return o};class Hy extends zf{constructor(n){super(n),this.protocol="wc",this.version=2,this.events=new Zt.EventEmitter,this.name=ly,this.transportExplicitlyClosed=!1,this.initialized=!1,this.connectionAttemptInProgress=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled"],this.hasExperiencedNetworkDisruption=!1,this.request=async r=>{this.logger.debug("Publishing Request Payload");try{return await this.toEstablishConnection(),await this.provider.request(r)}catch(s){throw this.logger.debug("Failed to Publish Request"),this.logger.error(s),s}},this.onPayloadHandler=r=>{this.onProviderPayload(r)},this.onConnectHandler=()=>{this.events.emit(Ge.connect)},this.onDisconnectHandler=()=>{this.onProviderDisconnect()},this.onProviderErrorHandler=r=>{this.logger.error(r),this.events.emit(Ge.error,r),this.logger.info("Fatal socket error received, closing transport"),this.transportClose()},this.registerProviderListeners=()=>{this.provider.on(er.payload,this.onPayloadHandler),this.provider.on(er.connect,this.onConnectHandler),this.provider.on(er.disconnect,this.onDisconnectHandler),this.provider.on(er.error,this.onProviderErrorHandler)},this.core=n.core,this.logger=typeof n.logger<"u"&&typeof n.logger!="string"?ce.generateChildLogger(n.logger,this.name):ce.pino(ce.getDefaultLoggerOptions({level:n.logger||hy})),this.messages=new Ny(this.logger,n.core),this.subscriber=new My(this,this.logger),this.publisher=new Ty(this,this.logger),this.relayUrl=n?.relayUrl||Kc,this.projectId=n.projectId,this.bundleId=$1(),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await this.createProvider(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${Gc}...`),await this.restartTransport(Gc)}this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},gy)}get context(){return ce.getLoggerContext(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(n,r,s){this.isInitialized(),await this.publisher.publish(n,r,s),await this.recordMessageEvent({topic:n,message:r,publishedAt:Date.now()})}async subscribe(n,r){var s;this.isInitialized();let a=((s=this.subscriber.topicMap.get(n))==null?void 0:s[0])||"";if(a)return a;let h;const p=d=>{d.topic===n&&(this.subscriber.off(zt.created,p),h())};return await Promise.all([new Promise(d=>{h=d,this.subscriber.on(zt.created,p)}),new Promise(async d=>{a=await this.subscriber.subscribe(n,r),d()})]),a}async unsubscribe(n,r){this.isInitialized(),await this.subscriber.unsubscribe(n,r)}on(n,r){this.events.on(n,r)}once(n,r){this.events.once(n,r)}off(n,r){this.events.off(n,r)}removeListener(n,r){this.events.removeListener(n,r)}async transportClose(){this.transportExplicitlyClosed=!0,this.hasExperiencedNetworkDisruption&&this.connected?await qi(this.provider.disconnect(),1e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.connected&&await this.provider.disconnect()}async transportOpen(n){if(this.transportExplicitlyClosed=!1,await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress){n&&n!==this.relayUrl&&(this.relayUrl=n,await this.transportClose(),await this.createProvider()),this.connectionAttemptInProgress=!0;try{await Promise.all([new Promise(r=>{if(!this.initialized)return r();this.subscriber.once(zt.resubscribed,()=>{r()})}),new Promise(async(r,s)=>{try{await qi(this.provider.connect(),1e4,`Socket stalled when trying to connect to ${this.relayUrl}`)}catch(a){s(a);return}r()})])}catch(r){this.logger.error(r);const s=r;if(!this.isConnectionStalled(s.message))throw r;this.provider.events.emit(er.disconnect)}finally{this.connectionAttemptInProgress=!1,this.hasExperiencedNetworkDisruption=!1}}}async restartTransport(n){await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress&&(this.relayUrl=n||this.relayUrl,await this.transportClose(),await this.createProvider(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await Np())throw new Error("No internet connection detected. Please restart your network and try again.")}isConnectionStalled(n){return this.staleConnectionErrors.some(r=>n.includes(r))}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const n=await this.core.crypto.signJWT(this.relayUrl);this.provider=new Dr(new CD(k1({sdkVersion:dy,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:n,useOnCloseEvent:!0,bundleId:this.bundleId}))),this.registerProviderListeners()}async recordMessageEvent(n){const{topic:r,message:s}=n;await this.messages.set(r,s)}async shouldIgnoreMessageEvent(n){const{topic:r,message:s}=n;if(!s||s.length===0)return this.logger.debug(`Ignoring invalid/empty message: ${s}`),!0;if(!await this.subscriber.isSubscribed(r))return this.logger.debug(`Ignoring message for non-subscribed topic ${r}`),!0;const a=this.messages.has(r,s);return a&&this.logger.debug(`Ignoring duplicate message: ${s}`),a}async onProviderPayload(n){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:n}),Ru(n)){if(!n.method.endsWith(py))return;const r=n.params,{topic:s,message:a,publishedAt:h}=r.data,p={topic:s,message:a,publishedAt:h};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(Vy({type:"event",event:r.id},p)),this.events.emit(r.id,p),await this.acknowledgePayload(n),await this.onMessageEvent(p)}else Nu(n)&&this.events.emit(Ge.message_ack,n)}async onMessageEvent(n){await this.shouldIgnoreMessageEvent(n)||(this.events.emit(Ge.message,n),await this.recordMessageEvent(n))}async acknowledgePayload(n){const r=Tu(n.id,!0);await this.provider.connection.send(r)}unregisterProviderListeners(){this.provider.off(er.payload,this.onPayloadHandler),this.provider.off(er.connect,this.onConnectHandler),this.provider.off(er.disconnect,this.onDisconnectHandler),this.provider.off(er.error,this.onProviderErrorHandler)}async registerEventListeners(){this.events.on(Ge.connection_stalled,()=>{this.restartTransport().catch(r=>this.logger.error(r))});let n=await Np();B1(async r=>{this.initialized&&n!==r&&(n=r,r?await this.restartTransport().catch(s=>this.logger.error(s)):(this.hasExperiencedNetworkDisruption=!0,await this.transportClose().catch(s=>this.logger.error(s))))})}onProviderDisconnect(){this.events.emit(Ge.disconnect),this.attemptToReconnect()}attemptToReconnect(){this.transportExplicitlyClosed||(this.logger.info("attemptToReconnect called. Connecting..."),setTimeout(async()=>{await this.restartTransport().catch(n=>this.logger.error(n))},G.toMiliseconds(fy)))}isInitialized(){if(!this.initialized){const{message:n}=M("NOT_INITIALIZED",this.name);throw new Error(n)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectionAttemptInProgress)return await new Promise(n=>{const r=setInterval(()=>{this.connected&&(clearInterval(r),n())},this.connectionStatusPollingInterval)});await this.restartTransport()}}}var Ky=Object.defineProperty,Xc=Object.getOwnPropertySymbols,Gy=Object.prototype.hasOwnProperty,Wy=Object.prototype.propertyIsEnumerable,Zc=(o,n,r)=>n in o?Ky(o,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[n]=r,eh=(o,n)=>{for(var r in n||(n={}))Gy.call(n,r)&&Zc(o,r,n[r]);if(Xc)for(var r of Xc(n))Wy.call(n,r)&&Zc(o,r,n[r]);return o};class Yi extends qf{constructor(n,r,s,a=yr,h=void 0){super(n,r,s,a),this.core=n,this.logger=r,this.name=s,this.map=new Map,this.version=Dy,this.cached=[],this.initialized=!1,this.storagePrefix=yr,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(p=>{this.getKey&&p!==null&&!zr(p)?this.map.set(this.getKey(p),p):R1(p)?this.map.set(p.id,p):N1(p)&&this.map.set(p.topic,p)}),this.cached=[],this.initialized=!0)},this.set=async(p,d)=>{this.isInitialized(),this.map.has(p)?await this.update(p,d):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:p,value:d}),this.map.set(p,d),await this.persist())},this.get=p=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:p}),this.getData(p)),this.getAll=p=>(this.isInitialized(),p?this.values.filter(d=>Object.keys(p).every(m=>PD(d[m],p[m]))):this.values),this.update=async(p,d)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:p,update:d});const m=eh(eh({},this.getData(p)),d);this.map.set(p,m),await this.persist()},this.delete=async(p,d)=>{this.isInitialized(),this.map.has(p)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:p,reason:d}),this.map.delete(p),await this.persist())},this.logger=ce.generateChildLogger(r,this.name),this.storagePrefix=a,this.getKey=h}get context(){return ce.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(n){await this.core.storage.setItem(this.storageKey,n)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(n){const r=this.map.get(n);if(!r){const{message:s}=M("NO_MATCHING_KEY",`${this.name}: ${n}`);throw this.logger.error(s),new Error(s)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const n=await this.getDataStore();if(typeof n>"u"||!n.length)return;if(this.map.size){const{message:r}=M("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=n,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(n){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(n)}}isInitialized(){if(!this.initialized){const{message:n}=M("NOT_INITIALIZED",this.name);throw new Error(n)}}}class Qy{constructor(n,r){this.core=n,this.logger=r,this.name=by,this.version=_y,this.events=new Pu,this.initialized=!1,this.storagePrefix=yr,this.ignoredPayloadTypes=[Tp],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:s})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...s])]},this.create=async()=>{this.isInitialized();const s=Iu(),a=await this.core.crypto.setSymKey(s),h=Vt(G.FIVE_MINUTES),p={protocol:Hc},d={topic:a,expiry:h,relay:p,active:!1},m=V1({protocol:this.core.protocol,version:this.core.version,topic:a,symKey:s,relay:p});return await this.pairings.set(a,d),await this.core.relayer.subscribe(a),this.core.expirer.set(a,h),{topic:a,uri:m}},this.pair=async s=>{this.isInitialized(),this.isValidPair(s);const{topic:a,symKey:h,relay:p}=jp(s.uri);let d;if(this.pairings.keys.includes(a)&&(d=this.pairings.get(a),d.active))throw new Error(`Pairing already exists: ${a}. Please try again with a new connection URI.`);const m=Vt(G.FIVE_MINUTES),v={topic:a,relay:p,expiry:m,active:!1};return await this.pairings.set(a,v),this.core.expirer.set(a,m),s.activatePairing&&await this.activate({topic:a}),this.events.emit(ti.create,v),this.core.crypto.keychain.has(a)||(await this.core.crypto.setSymKey(h,a),await this.core.relayer.subscribe(a,{relay:p})),v},this.activate=async({topic:s})=>{this.isInitialized();const a=Vt(G.THIRTY_DAYS);await this.pairings.update(s,{active:!0,expiry:a}),this.core.expirer.set(s,a)},this.ping=async s=>{this.isInitialized(),await this.isValidPing(s);const{topic:a}=s;if(this.pairings.keys.includes(a)){const h=await this.sendRequest(a,"wc_pairingPing",{}),{done:p,resolve:d,reject:m}=Bn();this.events.once(ze("pairing_ping",h),({error:v})=>{v?m(v):d()}),await p()}},this.updateExpiry=async({topic:s,expiry:a})=>{this.isInitialized(),await this.pairings.update(s,{expiry:a})},this.updateMetadata=async({topic:s,metadata:a})=>{this.isInitialized(),await this.pairings.update(s,{peerMetadata:a})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async s=>{this.isInitialized(),await this.isValidDisconnect(s);const{topic:a}=s;this.pairings.keys.includes(a)&&(await this.sendRequest(a,"wc_pairingDelete",Xe("USER_DISCONNECTED")),await this.deletePairing(a))},this.sendRequest=async(s,a,h)=>{const p=Li(a,h),d=await this.core.crypto.encode(s,p),m=ei[a].req;return this.core.history.set(s,p),this.core.relayer.publish(s,d,m),p.id},this.sendResult=async(s,a,h)=>{const p=Tu(s,h),d=await this.core.crypto.encode(a,p),m=await this.core.history.get(a,s),v=ei[m.request.method].res;await this.core.relayer.publish(a,d,v),await this.core.history.resolve(p)},this.sendError=async(s,a,h)=>{const p=Bp(s,h),d=await this.core.crypto.encode(a,p),m=await this.core.history.get(a,s),v=ei[m.request.method]?ei[m.request.method].res:ei.unregistered_method.res;await this.core.relayer.publish(a,d,v),await this.core.history.resolve(p)},this.deletePairing=async(s,a)=>{await this.core.relayer.unsubscribe(s),await Promise.all([this.pairings.delete(s,Xe("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(s),a?Promise.resolve():this.core.expirer.del(s)])},this.cleanup=async()=>{const s=this.pairings.getAll().filter(a=>qr(a.expiry));await Promise.all(s.map(a=>this.deletePairing(a.topic)))},this.onRelayEventRequest=s=>{const{topic:a,payload:h}=s;switch(h.method){case"wc_pairingPing":return this.onPairingPingRequest(a,h);case"wc_pairingDelete":return this.onPairingDeleteRequest(a,h);default:return this.onUnknownRpcMethodRequest(a,h)}},this.onRelayEventResponse=async s=>{const{topic:a,payload:h}=s,p=(await this.core.history.get(a,h.id)).request.method;switch(p){case"wc_pairingPing":return this.onPairingPingResponse(a,h);default:return this.onUnknownRpcMethodResponse(p)}},this.onPairingPingRequest=async(s,a)=>{const{id:h}=a;try{this.isValidPing({topic:s}),await this.sendResult(h,s,!0),this.events.emit(ti.ping,{id:h,topic:s})}catch(p){await this.sendError(h,s,p),this.logger.error(p)}},this.onPairingPingResponse=(s,a)=>{const{id:h}=a;setTimeout(()=>{Fr(a)?this.events.emit(ze("pairing_ping",h),{}):vr(a)&&this.events.emit(ze("pairing_ping",h),{error:a.error})},500)},this.onPairingDeleteRequest=async(s,a)=>{const{id:h}=a;try{this.isValidDisconnect({topic:s}),await this.deletePairing(s),this.events.emit(ti.delete,{id:h,topic:s})}catch(p){await this.sendError(h,s,p),this.logger.error(p)}},this.onUnknownRpcMethodRequest=async(s,a)=>{const{id:h,method:p}=a;try{if(this.registeredMethods.includes(p))return;const d=Xe("WC_METHOD_UNSUPPORTED",p);await this.sendError(h,s,d),this.logger.error(d)}catch(d){await this.sendError(h,s,d),this.logger.error(d)}},this.onUnknownRpcMethodResponse=s=>{this.registeredMethods.includes(s)||this.logger.error(Xe("WC_METHOD_UNSUPPORTED",s))},this.isValidPair=s=>{var a;if(!gt(s)){const{message:p}=M("MISSING_OR_INVALID",`pair() params: ${s}`);throw new Error(p)}if(!H1(s.uri)){const{message:p}=M("MISSING_OR_INVALID",`pair() uri: ${s.uri}`);throw new Error(p)}const h=jp(s.uri);if(!((a=h?.relay)!=null&&a.protocol)){const{message:p}=M("MISSING_OR_INVALID","pair() uri#relay-protocol");throw new Error(p)}if(!(h!=null&&h.symKey)){const{message:p}=M("MISSING_OR_INVALID","pair() uri#symKey");throw new Error(p)}},this.isValidPing=async s=>{if(!gt(s)){const{message:h}=M("MISSING_OR_INVALID",`ping() params: ${s}`);throw new Error(h)}const{topic:a}=s;await this.isValidPairingTopic(a)},this.isValidDisconnect=async s=>{if(!gt(s)){const{message:h}=M("MISSING_OR_INVALID",`disconnect() params: ${s}`);throw new Error(h)}const{topic:a}=s;await this.isValidPairingTopic(a)},this.isValidPairingTopic=async s=>{if(!Vn(s,!1)){const{message:a}=M("MISSING_OR_INVALID",`pairing topic should be a string: ${s}`);throw new Error(a)}if(!this.pairings.keys.includes(s)){const{message:a}=M("NO_MATCHING_KEY",`pairing topic doesn't exist: ${s}`);throw new Error(a)}if(qr(this.pairings.get(s).expiry)){await this.deletePairing(s);const{message:a}=M("EXPIRED",`pairing topic: ${s}`);throw new Error(a)}},this.core=n,this.logger=ce.generateChildLogger(r,this.name),this.pairings=new Yi(this.core,this.logger,this.name,this.storagePrefix)}get context(){return ce.getLoggerContext(this.logger)}isInitialized(){if(!this.initialized){const{message:n}=M("NOT_INITIALIZED",this.name);throw new Error(n)}}registerRelayerEvents(){this.core.relayer.on(Ge.message,async n=>{const{topic:r,message:s}=n;if(!this.pairings.keys.includes(r)||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(s)))return;const a=await this.core.crypto.decode(r,s);try{Ru(a)?(this.core.history.set(r,a),this.onRelayEventRequest({topic:r,payload:a})):Nu(a)&&(await this.core.history.resolve(a),await this.onRelayEventResponse({topic:r,payload:a}),this.core.history.delete(r,a.id))}catch(h){this.logger.error(h)}})}registerExpirerEvents(){this.core.expirer.on(Et.expired,async n=>{const{topic:r}=zp(n.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit(ti.expire,{topic:r}))})}}class Yy extends Nf{constructor(n,r){super(n,r),this.core=n,this.logger=r,this.records=new Map,this.events=new Zt.EventEmitter,this.name=Ey,this.version=Cy,this.cached=[],this.initialized=!1,this.storagePrefix=yr,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(s=>this.records.set(s.id,s)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(s,a,h)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:s,request:a,chainId:h}),this.records.has(a.id))return;const p={id:a.id,topic:s,request:{method:a.method,params:a.params||null},chainId:h,expiry:Vt(G.THIRTY_DAYS)};this.records.set(p.id,p),this.events.emit(Ht.created,p)},this.resolve=async s=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:s}),!this.records.has(s.id))return;const a=await this.getRecord(s.id);typeof a.response>"u"&&(a.response=vr(s)?{error:s.error}:{result:s.result},this.records.set(a.id,a),this.events.emit(Ht.updated,a))},this.get=async(s,a)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:s,id:a}),await this.getRecord(a)),this.delete=(s,a)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:a}),this.values.forEach(h=>{if(h.topic===s){if(typeof a<"u"&&h.id!==a)return;this.records.delete(h.id),this.events.emit(Ht.deleted,h)}})},this.exists=async(s,a)=>(this.isInitialized(),this.records.has(a)?(await this.getRecord(a)).topic===s:!1),this.on=(s,a)=>{this.events.on(s,a)},this.once=(s,a)=>{this.events.once(s,a)},this.off=(s,a)=>{this.events.off(s,a)},this.removeListener=(s,a)=>{this.events.removeListener(s,a)},this.logger=ce.generateChildLogger(r,this.name)}get context(){return ce.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const n=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const s={topic:r.topic,request:Li(r.request.method,r.request.params,r.id),chainId:r.chainId};return n.push(s)}),n}async setJsonRpcRecords(n){await this.core.storage.setItem(this.storageKey,n)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(n){this.isInitialized();const r=this.records.get(n);if(!r){const{message:s}=M("NO_MATCHING_KEY",`${this.name}: ${n}`);throw new Error(s)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(Ht.sync)}async restore(){try{const n=await this.getJsonRpcRecords();if(typeof n>"u"||!n.length)return;if(this.records.size){const{message:r}=M("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=n,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(n){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(n)}}registerEventListeners(){this.events.on(Ht.created,n=>{const r=Ht.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:n}),this.persist()}),this.events.on(Ht.updated,n=>{const r=Ht.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:n}),this.persist()}),this.events.on(Ht.deleted,n=>{const r=Ht.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:n}),this.persist()}),this.core.heartbeat.on(hn.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.records.forEach(n=>{G.toMiliseconds(n.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${n.id}`),this.delete(n.topic,n.id))})}catch(n){this.logger.warn(n)}}isInitialized(){if(!this.initialized){const{message:n}=M("NOT_INITIALIZED",this.name);throw new Error(n)}}}class Jy extends Lf{constructor(n,r){super(n,r),this.core=n,this.logger=r,this.expirations=new Map,this.events=new Zt.EventEmitter,this.name=Iy,this.version=Py,this.cached=[],this.initialized=!1,this.storagePrefix=yr,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(s=>this.expirations.set(s.target,s)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=s=>{try{const a=this.formatTarget(s);return typeof this.getExpiration(a)<"u"}catch{return!1}},this.set=(s,a)=>{this.isInitialized();const h=this.formatTarget(s),p={target:h,expiry:a};this.expirations.set(h,p),this.checkExpiry(h,p),this.events.emit(Et.created,{target:h,expiration:p})},this.get=s=>{this.isInitialized();const a=this.formatTarget(s);return this.getExpiration(a)},this.del=s=>{if(this.isInitialized(),this.has(s)){const a=this.formatTarget(s),h=this.getExpiration(a);this.expirations.delete(a),this.events.emit(Et.deleted,{target:a,expiration:h})}},this.on=(s,a)=>{this.events.on(s,a)},this.once=(s,a)=>{this.events.once(s,a)},this.off=(s,a)=>{this.events.off(s,a)},this.removeListener=(s,a)=>{this.events.removeListener(s,a)},this.logger=ce.generateChildLogger(r,this.name)}get context(){return ce.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(n){if(typeof n=="string")return K1(n);if(typeof n=="number")return G1(n);const{message:r}=M("UNKNOWN_TYPE",`Target type: ${typeof n}`);throw new Error(r)}async setExpirations(n){await this.core.storage.setItem(this.storageKey,n)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(Et.sync)}async restore(){try{const n=await this.getExpirations();if(typeof n>"u"||!n.length)return;if(this.expirations.size){const{message:r}=M("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=n,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(n){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(n)}}getExpiration(n){const r=this.expirations.get(n);if(!r){const{message:s}=M("NO_MATCHING_KEY",`${this.name}: ${n}`);throw this.logger.error(s),new Error(s)}return r}checkExpiry(n,r){const{expiry:s}=r;G.toMiliseconds(s)-Date.now()<=0&&this.expire(n,r)}expire(n,r){this.expirations.delete(n),this.events.emit(Et.expired,{target:n,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((n,r)=>this.checkExpiry(r,n))}registerEventListeners(){this.core.heartbeat.on(hn.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(Et.created,n=>{const r=Et.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:n}),this.persist()}),this.events.on(Et.expired,n=>{const r=Et.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:n}),this.persist()}),this.events.on(Et.deleted,n=>{const r=Et.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:n}),this.persist()})}isInitialized(){if(!this.initialized){const{message:n}=M("NOT_INITIALIZED",this.name);throw new Error(n)}}}class Xy extends Uf{constructor(n,r){super(n,r),this.projectId=n,this.logger=r,this.name=Ro,this.initialized=!1,this.queue=[],this.verifyDisabled=!1,this.init=async s=>{if(this.verifyDisabled||W1()||!qp())return;const a=this.getVerifyUrl(s?.verifyUrl);this.verifyUrl!==a&&this.removeIframe(),this.verifyUrl=a;try{await this.createIframe()}catch(h){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(h)}if(!this.initialized){this.removeIframe(),this.verifyUrl=No;try{await this.createIframe()}catch(h){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(h),this.verifyDisabled=!0}}},this.register=async s=>{this.initialized?this.sendPost(s.attestationId):(this.addToQueue(s.attestationId),await this.init())},this.resolve=async s=>{if(this.isDevEnv)return"";const a=this.getVerifyUrl(s?.verifyUrl);let h;try{h=await this.fetchAttestation(s.attestationId,a)}catch(p){this.logger.info(`failed to resolve attestation: ${s.attestationId} from url: ${a}`),this.logger.info(p),h=await this.fetchAttestation(s.attestationId,No)}return h},this.fetchAttestation=async(s,a)=>{this.logger.info(`resolving attestation: ${s} from url: ${a}`);const h=this.startAbortTimer(G.ONE_SECOND*2),p=await fetch(`${a}/attestation/${s}`,{signal:this.abortController.signal});return clearTimeout(h),p.status===200?await p.json():void 0},this.addToQueue=s=>{this.queue.push(s)},this.processQueue=()=>{this.queue.length!==0&&(this.queue.forEach(s=>this.sendPost(s)),this.queue=[])},this.sendPost=s=>{var a;try{if(!this.iframe)return;(a=this.iframe.contentWindow)==null||a.postMessage(s,"*"),this.logger.info(`postMessage sent: ${s} ${this.verifyUrl}`)}catch{}},this.createIframe=async()=>{let s;const a=h=>{h.data==="verify_ready"&&(this.initialized=!0,this.processQueue(),window.removeEventListener("message",a),s())};await Promise.race([new Promise(h=>{if(document.getElementById(Ro))return h();window.addEventListener("message",a);const p=document.createElement("iframe");p.id=Ro,p.src=`${this.verifyUrl}/${this.projectId}`,p.style.display="none",document.body.append(p),this.iframe=p,s=h}),new Promise((h,p)=>setTimeout(()=>{window.removeEventListener("message",a),p("verify iframe load timeout")},G.toMiliseconds(G.FIVE_SECONDS)))])},this.removeIframe=()=>{this.iframe&&(this.iframe.remove(),this.iframe=void 0,this.initialized=!1)},this.getVerifyUrl=s=>{let a=s||pn;return Sy.includes(a)||(this.logger.info(`verify url: ${a}, not included in trusted list, assigning default: ${pn}`),a=pn),a},this.logger=ce.generateChildLogger(r,this.name),this.verifyUrl=pn,this.abortController=new AbortController,this.isDevEnv=Q1()&&{}.IS_VITEST}get context(){return ce.getLoggerContext(this.logger)}startAbortTimer(n){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),G.toMiliseconds(n))}}class Zy extends Mf{constructor(n,r){super(n,r),this.projectId=n,this.logger=r,this.context=xy,this.registerDeviceToken=async s=>{const{clientId:a,token:h,notificationType:p,enableEncrypted:d=!1}=s,m=`${Ay}/${this.projectId}/clients`;await OD(m,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:a,type:p,token:h,always_raw:d})})},this.logger=ce.generateChildLogger(r,this.context)}}var em=Object.defineProperty,th=Object.getOwnPropertySymbols,tm=Object.prototype.hasOwnProperty,rm=Object.prototype.propertyIsEnumerable,rh=(o,n,r)=>n in o?em(o,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[n]=r,nh=(o,n)=>{for(var r in n||(n={}))tm.call(n,r)&&rh(o,r,n[r]);if(th)for(var r of th(n))rm.call(n,r)&&rh(o,r,n[r]);return o};class jo extends Rf{constructor(n){super(n),this.protocol=Bc,this.version=Zv,this.name=Oo,this.events=new Zt.EventEmitter,this.initialized=!1,this.on=(s,a)=>this.events.on(s,a),this.once=(s,a)=>this.events.once(s,a),this.off=(s,a)=>this.events.off(s,a),this.removeListener=(s,a)=>this.events.removeListener(s,a),this.projectId=n?.projectId,this.relayUrl=n?.relayUrl||Kc,this.customStoragePrefix=n!=null&&n.customStoragePrefix?`:${n.customStoragePrefix}`:"";const r=typeof n?.logger<"u"&&typeof n?.logger!="string"?n.logger:ce.pino(ce.getDefaultLoggerOptions({level:n?.logger||ey.logger}));this.logger=ce.generateChildLogger(r,this.name),this.heartbeat=new hn.HeartBeat,this.crypto=new Ry(this,this.logger,n?.keychain),this.history=new Yy(this,this.logger),this.expirer=new Jy(this,this.logger),this.storage=n!=null&&n.storage?n.storage:new _f(nh(nh({},ty),n?.storageOptions)),this.relayer=new Hy({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new Qy(this,this.logger),this.verify=new Xy(this.projectId||"",this.logger),this.echoClient=new Zy(this.projectId||"",this.logger)}static async init(n){const r=new jo(n);await r.initialize();const s=await r.crypto.getClientId();return await r.storage.setItem(vy,s),r}get context(){return ce.getLoggerContext(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(n){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,n),this.logger.error(n.message),n}}}const nm=jo,ih="wc",sh=2,oh="client",zo=`${ih}@${sh}:${oh}:`,qo={name:oh,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},ah="WALLETCONNECT_DEEPLINK_CHOICE",im="proposal",uh="Proposal expired",sm="session",Ji=G.SEVEN_DAYS,om="engine",ni={wc_sessionPropose:{req:{ttl:G.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:G.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:G.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:G.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:G.ONE_DAY,prompt:!1,tag:1104},res:{ttl:G.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:G.ONE_DAY,prompt:!1,tag:1106},res:{ttl:G.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:G.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:G.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:G.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:G.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:G.ONE_DAY,prompt:!1,tag:1112},res:{ttl:G.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:G.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:G.THIRTY_SECONDS,prompt:!1,tag:1115}}},Fo={min:G.FIVE_MINUTES,max:G.SEVEN_DAYS},tr={idle:"IDLE",active:"ACTIVE"},am="request",um=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"];var cm=Object.defineProperty,hm=Object.defineProperties,lm=Object.getOwnPropertyDescriptors,ch=Object.getOwnPropertySymbols,pm=Object.prototype.hasOwnProperty,fm=Object.prototype.propertyIsEnumerable,hh=(o,n,r)=>n in o?cm(o,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[n]=r,ot=(o,n)=>{for(var r in n||(n={}))pm.call(n,r)&&hh(o,r,n[r]);if(ch)for(var r of ch(n))fm.call(n,r)&&hh(o,r,n[r]);return o},ii=(o,n)=>hm(o,lm(n));class dm extends kf{constructor(n){super(n),this.name=om,this.events=new Pu,this.initialized=!1,this.ignoredPayloadTypes=[Tp],this.requestQueue={state:tr.idle,queue:[]},this.sessionRequestQueue={state:tr.idle,queue:[]},this.requestQueueDelay=G.ONE_SECOND,this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),this.client.core.pairing.register({methods:Object.keys(ni)}),this.initialized=!0,setTimeout(()=>{this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},G.toMiliseconds(this.requestQueueDelay)))},this.connect=async r=>{await this.isInitialized();const s=ii(ot({},r),{requiredNamespaces:r.requiredNamespaces||{},optionalNamespaces:r.optionalNamespaces||{}});await this.isValidConnect(s);const{pairingTopic:a,requiredNamespaces:h,optionalNamespaces:p,sessionProperties:d,relays:m}=s;let v=a,E,C=!1;if(v&&(C=this.client.core.pairing.pairings.get(v).active),!v||!C){const{topic:H,uri:B}=await this.client.core.pairing.create();v=H,E=B}const S=await this.client.core.crypto.generateKeyPair(),z=ot({requiredNamespaces:h,optionalNamespaces:p,relays:m??[{protocol:Hc}],proposer:{publicKey:S,metadata:this.client.metadata}},d&&{sessionProperties:d}),{reject:I,resolve:T,done:k}=Bn(G.FIVE_MINUTES,uh);if(this.events.once(ze("session_connect"),async({error:H,session:B})=>{if(H)I(H);else if(B){B.self.publicKey=S;const W=ii(ot({},B),{requiredNamespaces:B.requiredNamespaces,optionalNamespaces:B.optionalNamespaces});await this.client.session.set(B.topic,W),await this.setExpiry(B.topic,B.expiry),v&&await this.client.core.pairing.updateMetadata({topic:v,metadata:B.peer.metadata}),T(W)}}),!v){const{message:H}=M("NO_MATCHING_KEY",`connect() pairing topic: ${v}`);throw new Error(H)}const K=await this.sendRequest({topic:v,method:"wc_sessionPropose",params:z}),X=Vt(G.FIVE_MINUTES);return await this.setProposal(K,ot({id:K,expiry:X},z)),{uri:E,approval:k}},this.pair=async r=>(await this.isInitialized(),await this.client.core.pairing.pair(r)),this.approve=async r=>{await this.isInitialized(),await this.isValidApprove(r);const{id:s,relayProtocol:a,namespaces:h,sessionProperties:p}=r,d=this.client.proposal.get(s);let{pairingTopic:m,proposer:v,requiredNamespaces:E,optionalNamespaces:C}=d;m=m||"",fo(E)||(E=X1(h,"approve()"));const S=await this.client.core.crypto.generateKeyPair(),z=v.publicKey,I=await this.client.core.crypto.generateSharedKey(S,z);m&&s&&(await this.client.core.pairing.updateMetadata({topic:m,metadata:v.metadata}),await this.sendResult({id:s,topic:m,result:{relay:{protocol:a??"irn"},responderPublicKey:S}}),await this.client.proposal.delete(s,Xe("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:m}));const T=ot({relay:{protocol:a??"irn"},namespaces:h,requiredNamespaces:E,optionalNamespaces:C,pairingTopic:m,controller:{publicKey:S,metadata:this.client.metadata},expiry:Vt(Ji)},p&&{sessionProperties:p});await this.client.core.relayer.subscribe(I),await this.sendRequest({topic:I,method:"wc_sessionSettle",params:T,throwOnFailedPublish:!0});const k=ii(ot({},T),{topic:I,pairingTopic:m,acknowledged:!1,self:T.controller,peer:{publicKey:v.publicKey,metadata:v.metadata},controller:S});return await this.client.session.set(I,k),await this.setExpiry(I,Vt(Ji)),{topic:I,acknowledged:()=>new Promise(K=>setTimeout(()=>K(this.client.session.get(I)),500))}},this.reject=async r=>{await this.isInitialized(),await this.isValidReject(r);const{id:s,reason:a}=r,{pairingTopic:h}=this.client.proposal.get(s);h&&(await this.sendError(s,h,a),await this.client.proposal.delete(s,Xe("USER_DISCONNECTED")))},this.update=async r=>{await this.isInitialized(),await this.isValidUpdate(r);const{topic:s,namespaces:a}=r,h=await this.sendRequest({topic:s,method:"wc_sessionUpdate",params:{namespaces:a}}),{done:p,resolve:d,reject:m}=Bn();return this.events.once(ze("session_update",h),({error:v})=>{v?m(v):d()}),await this.client.session.update(s,{namespaces:a}),{acknowledged:p}},this.extend=async r=>{await this.isInitialized(),await this.isValidExtend(r);const{topic:s}=r,a=await this.sendRequest({topic:s,method:"wc_sessionExtend",params:{}}),{done:h,resolve:p,reject:d}=Bn();return this.events.once(ze("session_extend",a),({error:m})=>{m?d(m):p()}),await this.setExpiry(s,Vt(Ji)),{acknowledged:h}},this.request=async r=>{await this.isInitialized(),await this.isValidRequest(r);const{chainId:s,request:a,topic:h,expiry:p}=r,d=w8(),{done:m,resolve:v,reject:E}=Bn(p,"Request expired. Please try again.");return this.events.once(ze("session_request",d),({error:C,result:S})=>{C?E(C):v(S)}),await Promise.all([new Promise(async C=>{await this.sendRequest({clientRpcId:d,topic:h,method:"wc_sessionRequest",params:{request:a,chainId:s},expiry:p,throwOnFailedPublish:!0}).catch(S=>E(S)),this.client.events.emit("session_request_sent",{topic:h,request:a,chainId:s,id:d}),C()}),new Promise(async C=>{const S=await Z1(this.client.core.storage,ah);e8({id:d,topic:h,wcDeepLink:S}),C()}),m()]).then(C=>C[2])},this.respond=async r=>{await this.isInitialized(),await this.isValidRespond(r);const{topic:s,response:a}=r,{id:h}=a;Fr(a)?await this.sendResult({id:h,topic:s,result:a.result,throwOnFailedPublish:!0}):vr(a)&&await this.sendError(h,s,a.error),this.cleanupAfterResponse(r)},this.ping=async r=>{await this.isInitialized(),await this.isValidPing(r);const{topic:s}=r;if(this.client.session.keys.includes(s)){const a=await this.sendRequest({topic:s,method:"wc_sessionPing",params:{}}),{done:h,resolve:p,reject:d}=Bn();this.events.once(ze("session_ping",a),({error:m})=>{m?d(m):p()}),await h()}else this.client.core.pairing.pairings.keys.includes(s)&&await this.client.core.pairing.ping({topic:s})},this.emit=async r=>{await this.isInitialized(),await this.isValidEmit(r);const{topic:s,event:a,chainId:h}=r;await this.sendRequest({topic:s,method:"wc_sessionEvent",params:{event:a,chainId:h}})},this.disconnect=async r=>{await this.isInitialized(),await this.isValidDisconnect(r);const{topic:s}=r;this.client.session.keys.includes(s)?(await this.sendRequest({topic:s,method:"wc_sessionDelete",params:Xe("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession(s)):await this.client.core.pairing.disconnect({topic:s})},this.find=r=>(this.isInitialized(),this.client.session.getAll().filter(s=>t8(s,r))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.cleanupDuplicatePairings=async r=>{if(r.pairingTopic)try{const s=this.client.core.pairing.pairings.get(r.pairingTopic),a=this.client.core.pairing.pairings.getAll().filter(h=>{var p,d;return((p=h.peerMetadata)==null?void 0:p.url)&&((d=h.peerMetadata)==null?void 0:d.url)===r.peer.metadata.url&&h.topic&&h.topic!==s.topic});if(a.length===0)return;this.client.logger.info(`Cleaning up ${a.length} duplicate pairing(s)`),await Promise.all(a.map(h=>this.client.core.pairing.disconnect({topic:h.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(s){this.client.logger.error(s)}},this.deleteSession=async(r,s)=>{const{self:a}=this.client.session.get(r);await this.client.core.relayer.unsubscribe(r),this.client.session.delete(r,Xe("USER_DISCONNECTED")),this.client.core.crypto.keychain.has(a.publicKey)&&await this.client.core.crypto.deleteKeyPair(a.publicKey),this.client.core.crypto.keychain.has(r)&&await this.client.core.crypto.deleteSymKey(r),s||this.client.core.expirer.del(r),this.client.core.storage.removeItem(ah).catch(h=>this.client.logger.warn(h)),this.getPendingSessionRequests().forEach(h=>{h.topic===r&&this.deletePendingSessionRequest(h.id,Xe("USER_DISCONNECTED"))})},this.deleteProposal=async(r,s)=>{await Promise.all([this.client.proposal.delete(r,Xe("USER_DISCONNECTED")),s?Promise.resolve():this.client.core.expirer.del(r)])},this.deletePendingSessionRequest=async(r,s,a=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,s),a?Promise.resolve():this.client.core.expirer.del(r)]),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(h=>h.id!==r),a&&(this.sessionRequestQueue.state=tr.idle)},this.setExpiry=async(r,s)=>{this.client.session.keys.includes(r)&&await this.client.session.update(r,{expiry:s}),this.client.core.expirer.set(r,s)},this.setProposal=async(r,s)=>{await this.client.proposal.set(r,s),this.client.core.expirer.set(r,s.expiry)},this.setPendingSessionRequest=async r=>{const s=ni.wc_sessionRequest.req.ttl,{id:a,topic:h,params:p,verifyContext:d}=r;await this.client.pendingRequest.set(a,{id:a,topic:h,params:p,verifyContext:d}),s&&this.client.core.expirer.set(a,Vt(s))},this.sendRequest=async r=>{const{topic:s,method:a,params:h,expiry:p,relayRpcId:d,clientRpcId:m,throwOnFailedPublish:v}=r,E=Li(a,h,m);if(qp()&&um.includes(a)){const z=Hn(JSON.stringify(E));this.client.core.verify.register({attestationId:z})}const C=await this.client.core.crypto.encode(s,E),S=ni[a].req;return p&&(S.ttl=p),d&&(S.id=d),this.client.core.history.set(s,E),v?(S.internal=ii(ot({},S.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(s,C,S)):this.client.core.relayer.publish(s,C,S).catch(z=>this.client.logger.error(z)),E.id},this.sendResult=async r=>{const{id:s,topic:a,result:h,throwOnFailedPublish:p}=r,d=Tu(s,h),m=await this.client.core.crypto.encode(a,d),v=await this.client.core.history.get(a,s),E=ni[v.request.method].res;p?(E.internal=ii(ot({},E.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(a,m,E)):this.client.core.relayer.publish(a,m,E).catch(C=>this.client.logger.error(C)),await this.client.core.history.resolve(d)},this.sendError=async(r,s,a)=>{const h=Bp(r,a),p=await this.client.core.crypto.encode(s,h),d=await this.client.core.history.get(s,r),m=ni[d.request.method].res;this.client.core.relayer.publish(s,p,m),await this.client.core.history.resolve(h)},this.cleanup=async()=>{const r=[],s=[];this.client.session.getAll().forEach(a=>{qr(a.expiry)&&r.push(a.topic)}),this.client.proposal.getAll().forEach(a=>{qr(a.expiry)&&s.push(a.id)}),await Promise.all([...r.map(a=>this.deleteSession(a)),...s.map(a=>this.deleteProposal(a))])},this.onRelayEventRequest=async r=>{this.requestQueue.queue.push(r),await this.processRequestsQueue()},this.processRequestsQueue=async()=>{if(this.requestQueue.state===tr.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=tr.active;const r=this.requestQueue.queue.shift();if(r)try{this.processRequest(r),await new Promise(s=>setTimeout(s,300))}catch(s){this.client.logger.warn(s)}}this.requestQueue.state=tr.idle},this.processRequest=r=>{const{topic:s,payload:a}=r,h=a.method;switch(h){case"wc_sessionPropose":return this.onSessionProposeRequest(s,a);case"wc_sessionSettle":return this.onSessionSettleRequest(s,a);case"wc_sessionUpdate":return this.onSessionUpdateRequest(s,a);case"wc_sessionExtend":return this.onSessionExtendRequest(s,a);case"wc_sessionPing":return this.onSessionPingRequest(s,a);case"wc_sessionDelete":return this.onSessionDeleteRequest(s,a);case"wc_sessionRequest":return this.onSessionRequest(s,a);case"wc_sessionEvent":return this.onSessionEventRequest(s,a);default:return this.client.logger.info(`Unsupported request method ${h}`)}},this.onRelayEventResponse=async r=>{const{topic:s,payload:a}=r,h=(await this.client.core.history.get(s,a.id)).request.method;switch(h){case"wc_sessionPropose":return this.onSessionProposeResponse(s,a);case"wc_sessionSettle":return this.onSessionSettleResponse(s,a);case"wc_sessionUpdate":return this.onSessionUpdateResponse(s,a);case"wc_sessionExtend":return this.onSessionExtendResponse(s,a);case"wc_sessionPing":return this.onSessionPingResponse(s,a);case"wc_sessionRequest":return this.onSessionRequestResponse(s,a);default:return this.client.logger.info(`Unsupported response method ${h}`)}},this.onRelayEventUnknownPayload=r=>{const{topic:s}=r,{message:a}=M("MISSING_OR_INVALID",`Decoded payload on topic ${s} is not identifiable as a JSON-RPC request or a response.`);throw new Error(a)},this.onSessionProposeRequest=async(r,s)=>{const{params:a,id:h}=s;try{this.isValidConnect(ot({},s.params));const p=Vt(G.FIVE_MINUTES),d=ot({id:h,pairingTopic:r,expiry:p},a);await this.setProposal(h,d);const m=Hn(JSON.stringify(s)),v=await this.getVerifyContext(m,d.proposer.metadata);this.client.events.emit("session_proposal",{id:h,params:d,verifyContext:v})}catch(p){await this.sendError(h,r,p),this.client.logger.error(p)}},this.onSessionProposeResponse=async(r,s)=>{const{id:a}=s;if(Fr(s)){const{result:h}=s;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:h});const p=this.client.proposal.get(a);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:p});const d=p.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:d});const m=h.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:m});const v=await this.client.core.crypto.generateSharedKey(d,m);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:v});const E=await this.client.core.relayer.subscribe(v);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:E}),await this.client.core.pairing.activate({topic:r})}else vr(s)&&(await this.client.proposal.delete(a,Xe("USER_DISCONNECTED")),this.events.emit(ze("session_connect"),{error:s.error}))},this.onSessionSettleRequest=async(r,s)=>{const{id:a,params:h}=s;try{this.isValidSessionSettleRequest(h);const{relay:p,controller:d,expiry:m,namespaces:v,requiredNamespaces:E,optionalNamespaces:C,sessionProperties:S,pairingTopic:z}=s.params,I=ot({topic:r,relay:p,expiry:m,namespaces:v,acknowledged:!0,pairingTopic:z,requiredNamespaces:E,optionalNamespaces:C,controller:d.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:d.publicKey,metadata:d.metadata}},S&&{sessionProperties:S});await this.sendResult({id:s.id,topic:r,result:!0}),this.events.emit(ze("session_connect"),{session:I}),this.cleanupDuplicatePairings(I)}catch(p){await this.sendError(a,r,p),this.client.logger.error(p)}},this.onSessionSettleResponse=async(r,s)=>{const{id:a}=s;Fr(s)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(ze("session_approve",a),{})):vr(s)&&(await this.client.session.delete(r,Xe("USER_DISCONNECTED")),this.events.emit(ze("session_approve",a),{error:s.error}))},this.onSessionUpdateRequest=async(r,s)=>{const{params:a,id:h}=s;try{const p=`${r}_session_update`,d=go.get(p);if(d&&this.isRequestOutOfSync(d,h)){this.client.logger.info(`Discarding out of sync request - ${h}`);return}this.isValidUpdate(ot({topic:r},a)),await this.client.session.update(r,{namespaces:a.namespaces}),await this.sendResult({id:h,topic:r,result:!0}),this.client.events.emit("session_update",{id:h,topic:r,params:a}),go.set(p,h)}catch(p){await this.sendError(h,r,p),this.client.logger.error(p)}},this.isRequestOutOfSync=(r,s)=>parseInt(s.toString().slice(0,-3))<=parseInt(r.toString().slice(0,-3)),this.onSessionUpdateResponse=(r,s)=>{const{id:a}=s;Fr(s)?this.events.emit(ze("session_update",a),{}):vr(s)&&this.events.emit(ze("session_update",a),{error:s.error})},this.onSessionExtendRequest=async(r,s)=>{const{id:a}=s;try{this.isValidExtend({topic:r}),await this.setExpiry(r,Vt(Ji)),await this.sendResult({id:a,topic:r,result:!0}),this.client.events.emit("session_extend",{id:a,topic:r})}catch(h){await this.sendError(a,r,h),this.client.logger.error(h)}},this.onSessionExtendResponse=(r,s)=>{const{id:a}=s;Fr(s)?this.events.emit(ze("session_extend",a),{}):vr(s)&&this.events.emit(ze("session_extend",a),{error:s.error})},this.onSessionPingRequest=async(r,s)=>{const{id:a}=s;try{this.isValidPing({topic:r}),await this.sendResult({id:a,topic:r,result:!0}),this.client.events.emit("session_ping",{id:a,topic:r})}catch(h){await this.sendError(a,r,h),this.client.logger.error(h)}},this.onSessionPingResponse=(r,s)=>{const{id:a}=s;setTimeout(()=>{Fr(s)?this.events.emit(ze("session_ping",a),{}):vr(s)&&this.events.emit(ze("session_ping",a),{error:s.error})},500)},this.onSessionDeleteRequest=async(r,s)=>{const{id:a}=s;try{this.isValidDisconnect({topic:r,reason:s.params}),await Promise.all([new Promise(h=>{this.client.core.relayer.once(Ge.publish,async()=>{h(await this.deleteSession(r))})}),this.sendResult({id:a,topic:r,result:!0})]),this.client.events.emit("session_delete",{id:a,topic:r})}catch(h){this.client.logger.error(h)}},this.onSessionRequest=async(r,s)=>{const{id:a,params:h}=s;try{this.isValidRequest(ot({topic:r},h));const p=Hn(JSON.stringify(Li("wc_sessionRequest",h,a))),d=this.client.session.get(r),m=await this.getVerifyContext(p,d.peer.metadata),v={id:a,topic:r,params:h,verifyContext:m};await this.setPendingSessionRequest(v),this.addSessionRequestToSessionRequestQueue(v),this.processSessionRequestQueue()}catch(p){await this.sendError(a,r,p),this.client.logger.error(p)}},this.onSessionRequestResponse=(r,s)=>{const{id:a}=s;Fr(s)?this.events.emit(ze("session_request",a),{result:s.result}):vr(s)&&this.events.emit(ze("session_request",a),{error:s.error})},this.onSessionEventRequest=async(r,s)=>{const{id:a,params:h}=s;try{const p=`${r}_session_event_${h.event.name}`,d=go.get(p);if(d&&this.isRequestOutOfSync(d,a)){this.client.logger.info(`Discarding out of sync request - ${a}`);return}this.isValidEmit(ot({topic:r},h)),this.client.events.emit("session_event",{id:a,topic:r,params:h}),go.set(p,a)}catch(p){await this.sendError(a,r,p),this.client.logger.error(p)}},this.addSessionRequestToSessionRequestQueue=r=>{this.sessionRequestQueue.queue.push(r)},this.cleanupAfterResponse=r=>{this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=tr.idle,this.processSessionRequestQueue()},G.toMiliseconds(this.requestQueueDelay))},this.processSessionRequestQueue=()=>{if(this.sessionRequestQueue.state===tr.active){this.client.logger.info("session request queue is already active.");return}const r=this.sessionRequestQueue.queue[0];if(!r){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=tr.active,this.client.events.emit("session_request",r)}catch(s){this.client.logger.error(s)}},this.onPairingCreated=r=>{if(r.active)return;const s=this.client.proposal.getAll().find(a=>a.pairingTopic===r.topic);s&&this.onSessionProposeRequest(r.topic,Li("wc_sessionPropose",{requiredNamespaces:s.requiredNamespaces,optionalNamespaces:s.optionalNamespaces,relays:s.relays,proposer:s.proposer,sessionProperties:s.sessionProperties},s.id))},this.isValidConnect=async r=>{if(!gt(r)){const{message:m}=M("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(m)}const{pairingTopic:s,requiredNamespaces:a,optionalNamespaces:h,sessionProperties:p,relays:d}=r;if(zr(s)||await this.isValidPairingTopic(s),!r8(d,!0)){const{message:m}=M("MISSING_OR_INVALID",`connect() relays: ${d}`);throw new Error(m)}!zr(a)&&fo(a)!==0&&this.validateNamespaces(a,"requiredNamespaces"),!zr(h)&&fo(h)!==0&&this.validateNamespaces(h,"optionalNamespaces"),zr(p)||this.validateSessionProps(p,"sessionProperties")},this.validateNamespaces=(r,s)=>{const a=n8(r,"connect()",s);if(a)throw new Error(a.message)},this.isValidApprove=async r=>{if(!gt(r))throw new Error(M("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:s,namespaces:a,relayProtocol:h,sessionProperties:p}=r;await this.isValidProposalId(s);const d=this.client.proposal.get(s),m=xu(a,"approve()");if(m)throw new Error(m.message);const v=Up(d.requiredNamespaces,a,"approve()");if(v)throw new Error(v.message);if(!Vn(h,!0)){const{message:E}=M("MISSING_OR_INVALID",`approve() relayProtocol: ${h}`);throw new Error(E)}zr(p)||this.validateSessionProps(p,"sessionProperties")},this.isValidReject=async r=>{if(!gt(r)){const{message:h}=M("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(h)}const{id:s,reason:a}=r;if(await this.isValidProposalId(s),!i8(a)){const{message:h}=M("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(a)}`);throw new Error(h)}},this.isValidSessionSettleRequest=r=>{if(!gt(r)){const{message:v}=M("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(v)}const{relay:s,controller:a,namespaces:h,expiry:p}=r;if(!s8(s)){const{message:v}=M("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(v)}const d=o8(a,"onSessionSettleRequest()");if(d)throw new Error(d.message);const m=xu(h,"onSessionSettleRequest()");if(m)throw new Error(m.message);if(qr(p)){const{message:v}=M("EXPIRED","onSessionSettleRequest()");throw new Error(v)}},this.isValidUpdate=async r=>{if(!gt(r)){const{message:m}=M("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(m)}const{topic:s,namespaces:a}=r;await this.isValidSessionTopic(s);const h=this.client.session.get(s),p=xu(a,"update()");if(p)throw new Error(p.message);const d=Up(h.requiredNamespaces,a,"update()");if(d)throw new Error(d.message)},this.isValidExtend=async r=>{if(!gt(r)){const{message:a}=M("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(a)}const{topic:s}=r;await this.isValidSessionTopic(s)},this.isValidRequest=async r=>{if(!gt(r)){const{message:m}=M("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(m)}const{topic:s,request:a,chainId:h,expiry:p}=r;await this.isValidSessionTopic(s);const{namespaces:d}=this.client.session.get(s);if(!Mp(d,h)){const{message:m}=M("MISSING_OR_INVALID",`request() chainId: ${h}`);throw new Error(m)}if(!a8(a)){const{message:m}=M("MISSING_OR_INVALID",`request() ${JSON.stringify(a)}`);throw new Error(m)}if(!u8(d,h,a.method)){const{message:m}=M("MISSING_OR_INVALID",`request() method: ${a.method}`);throw new Error(m)}if(p&&!c8(p,Fo)){const{message:m}=M("MISSING_OR_INVALID",`request() expiry: ${p}. Expiry must be a number (in seconds) between ${Fo.min} and ${Fo.max}`);throw new Error(m)}},this.isValidRespond=async r=>{var s;if(!gt(r)){const{message:p}=M("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(p)}const{topic:a,response:h}=r;try{await this.isValidSessionTopic(a)}catch(p){throw(s=r?.response)!=null&&s.id&&this.cleanupAfterResponse(r),p}if(!h8(h)){const{message:p}=M("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(h)}`);throw new Error(p)}},this.isValidPing=async r=>{if(!gt(r)){const{message:a}=M("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(a)}const{topic:s}=r;await this.isValidSessionOrPairingTopic(s)},this.isValidEmit=async r=>{if(!gt(r)){const{message:d}=M("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(d)}const{topic:s,event:a,chainId:h}=r;await this.isValidSessionTopic(s);const{namespaces:p}=this.client.session.get(s);if(!Mp(p,h)){const{message:d}=M("MISSING_OR_INVALID",`emit() chainId: ${h}`);throw new Error(d)}if(!l8(a)){const{message:d}=M("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(d)}if(!p8(p,h,a.name)){const{message:d}=M("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(d)}},this.isValidDisconnect=async r=>{if(!gt(r)){const{message:a}=M("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(a)}const{topic:s}=r;await this.isValidSessionOrPairingTopic(s)},this.getVerifyContext=async(r,s)=>{const a={verified:{verifyUrl:s.verifyUrl||pn,validation:"UNKNOWN",origin:s.url||""}};try{const h=await this.client.core.verify.resolve({attestationId:r,verifyUrl:s.verifyUrl});h&&(a.verified.origin=h.origin,a.verified.isScam=h.isScam,a.verified.validation=h.origin===new URL(s.url).origin?"VALID":"INVALID")}catch(h){this.client.logger.info(h)}return this.client.logger.info(`Verify context: ${JSON.stringify(a)}`),a},this.validateSessionProps=(r,s)=>{Object.values(r).forEach(a=>{if(!Vn(a,!1)){const{message:h}=M("MISSING_OR_INVALID",`${s} must be in Record<string, string> format. Received: ${JSON.stringify(a)}`);throw new Error(h)}})}}async isInitialized(){if(!this.initialized){const{message:n}=M("NOT_INITIALIZED",this.name);throw new Error(n)}await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(Ge.message,async n=>{const{topic:r,message:s}=n;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(s)))return;const a=await this.client.core.crypto.decode(r,s);try{Ru(a)?(this.client.core.history.set(r,a),this.onRelayEventRequest({topic:r,payload:a})):Nu(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:r,payload:a}),this.client.core.history.delete(r,a.id)):this.onRelayEventUnknownPayload({topic:r,payload:a})}catch(h){this.client.logger.error(h)}})}registerExpirerEvents(){this.client.core.expirer.on(Et.expired,async n=>{const{topic:r,id:s}=zp(n.target);if(s&&this.client.pendingRequest.keys.includes(s))return await this.deletePendingSessionRequest(s,M("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession(r,!0),this.client.events.emit("session_expire",{topic:r})):s&&(await this.deleteProposal(s,!0),this.client.events.emit("proposal_expire",{id:s}))})}registerPairingEvents(){this.client.core.pairing.events.on(ti.create,n=>this.onPairingCreated(n))}isValidPairingTopic(n){if(!Vn(n,!1)){const{message:r}=M("MISSING_OR_INVALID",`pairing topic should be a string: ${n}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(n)){const{message:r}=M("NO_MATCHING_KEY",`pairing topic doesn't exist: ${n}`);throw new Error(r)}if(qr(this.client.core.pairing.pairings.get(n).expiry)){const{message:r}=M("EXPIRED",`pairing topic: ${n}`);throw new Error(r)}}async isValidSessionTopic(n){if(!Vn(n,!1)){const{message:r}=M("MISSING_OR_INVALID",`session topic should be a string: ${n}`);throw new Error(r)}if(!this.client.session.keys.includes(n)){const{message:r}=M("NO_MATCHING_KEY",`session topic doesn't exist: ${n}`);throw new Error(r)}if(qr(this.client.session.get(n).expiry)){await this.deleteSession(n);const{message:r}=M("EXPIRED",`session topic: ${n}`);throw new Error(r)}}async isValidSessionOrPairingTopic(n){if(this.client.session.keys.includes(n))await this.isValidSessionTopic(n);else if(this.client.core.pairing.pairings.keys.includes(n))this.isValidPairingTopic(n);else if(Vn(n,!1)){const{message:r}=M("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${n}`);throw new Error(r)}else{const{message:r}=M("MISSING_OR_INVALID",`session or pairing topic should be a string: ${n}`);throw new Error(r)}}async isValidProposalId(n){if(!f8(n)){const{message:r}=M("MISSING_OR_INVALID",`proposal id should be a number: ${n}`);throw new Error(r)}if(!this.client.proposal.keys.includes(n)){const{message:r}=M("NO_MATCHING_KEY",`proposal id doesn't exist: ${n}`);throw new Error(r)}if(qr(this.client.proposal.get(n).expiry)){await this.deleteProposal(n);const{message:r}=M("EXPIRED",`proposal id: ${n}`);throw new Error(r)}}}class gm extends Yi{constructor(n,r){super(n,r,im,zo),this.core=n,this.logger=r}}class Dm extends Yi{constructor(n,r){super(n,r,sm,zo),this.core=n,this.logger=r}}class vm extends Yi{constructor(n,r){super(n,r,am,zo,s=>s.id),this.core=n,this.logger=r}}let ym=class Hp extends $f{constructor(n){super(n),this.protocol=ih,this.version=sh,this.name=qo.name,this.events=new Zt.EventEmitter,this.on=(s,a)=>this.events.on(s,a),this.once=(s,a)=>this.events.once(s,a),this.off=(s,a)=>this.events.off(s,a),this.removeListener=(s,a)=>this.events.removeListener(s,a),this.removeAllListeners=s=>this.events.removeAllListeners(s),this.connect=async s=>{try{return await this.engine.connect(s)}catch(a){throw this.logger.error(a.message),a}},this.pair=async s=>{try{return await this.engine.pair(s)}catch(a){throw this.logger.error(a.message),a}},this.approve=async s=>{try{return await this.engine.approve(s)}catch(a){throw this.logger.error(a.message),a}},this.reject=async s=>{try{return await this.engine.reject(s)}catch(a){throw this.logger.error(a.message),a}},this.update=async s=>{try{return await this.engine.update(s)}catch(a){throw this.logger.error(a.message),a}},this.extend=async s=>{try{return await this.engine.extend(s)}catch(a){throw this.logger.error(a.message),a}},this.request=async s=>{try{return await this.engine.request(s)}catch(a){throw this.logger.error(a.message),a}},this.respond=async s=>{try{return await this.engine.respond(s)}catch(a){throw this.logger.error(a.message),a}},this.ping=async s=>{try{return await this.engine.ping(s)}catch(a){throw this.logger.error(a.message),a}},this.emit=async s=>{try{return await this.engine.emit(s)}catch(a){throw this.logger.error(a.message),a}},this.disconnect=async s=>{try{return await this.engine.disconnect(s)}catch(a){throw this.logger.error(a.message),a}},this.find=s=>{try{return this.engine.find(s)}catch(a){throw this.logger.error(a.message),a}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(s){throw this.logger.error(s.message),s}},this.name=n?.name||qo.name,this.metadata=n?.metadata||J1();const r=typeof n?.logger<"u"&&typeof n?.logger!="string"?n.logger:ce.pino(ce.getDefaultLoggerOptions({level:n?.logger||qo.logger}));this.core=n?.core||new nm(n),this.logger=ce.generateChildLogger(r,this.name),this.session=new Dm(this.core,this.logger),this.proposal=new gm(this.core,this.logger),this.pendingRequest=new vm(this.core,this.logger),this.engine=new dm(this)}static async init(n){const r=new Hp(n);return await r.initialize(),r}get context(){return ce.getLoggerContext(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(n){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(n.message),n}}};function mm(o,n){return{id:o,jsonrpc:"2.0",result:n}}const lh="error",wm="wss://relay.walletconnect.com",bm="wc",_m="universal_provider",ph=`${bm}@2:${_m}:`,Em="https://rpc.walletconnect.com/v1/",rr={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var si=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof jt.global<"u"?jt.global:typeof self<"u"?self:{},Lo={exports:{}};(function(o,n){(function(){var r,s="4.17.21",a=200,h="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",p="Expected a function",d="Invalid `variable` option passed into `_.template`",m="__lodash_hash_undefined__",v=500,E="__lodash_placeholder__",C=1,S=2,z=4,I=1,T=2,k=1,K=2,X=4,H=8,B=16,W=32,x=64,q=128,F=256,ie=512,re=30,de="...",qe=800,We=16,Z=1,at=2,wr=3,qt=1/0,Ct=9007199254740991,ai=17976931348623157e292,Pe=0/0,He=4294967295,fn=He-1,br=He>>>1,dn=[["ary",q],["bind",k],["bindKey",K],["curry",H],["curryRight",B],["flip",ie],["partial",W],["partialRight",x],["rearg",F]],le="[object Arguments]",Qe="[object Array]",Vo="[object AsyncFunction]",et="[object Boolean]",_r="[object Date]",ts="[object DOMException]",Br="[object Error]",Er="[object Function]",ui="[object GeneratorFunction]",ut="[object Map]",Vr="[object Number]",Ho="[object Null]",Ft="[object Object]",rs="[object Promise]",Ko="[object Proxy]",Hr="[object RegExp]",Dt="[object Set]",Kr="[object String]",gn="[object Symbol]",Go="[object Undefined]",Gr="[object WeakMap]",Wo="[object WeakSet]",Kt="[object ArrayBuffer]",Gt="[object DataView]",Dn="[object Float32Array]",ct="[object Float64Array]",vn="[object Int8Array]",yn="[object Int16Array]",ci="[object Int32Array]",mn="[object Uint8Array]",Cr="[object Uint8ClampedArray]",wn="[object Uint16Array]",bn="[object Uint32Array]",Qo=/\b__p \+= '';/g,nr=/\b(__p \+=) '' \+/g,ns=/(__e\(.*?\)|\b__t\)) \+\n'';/g,is=/&(?:amp|lt|gt|quot|#39);/g,ss=/[&<>"']/g,hi=RegExp(is.source),Wr=RegExp(ss.source),li=/<%-([\s\S]+?)%>/g,pi=/<%([\s\S]+?)%>/g,_n=/<%=([\s\S]+?)%>/g,Qr=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Yo=/^\w*$/,Jo=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,fi=/[\\^$.*+?()[\]{}|]/g,Xo=RegExp(fi.source),di=/^\s+/,os=/\s/,gi=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,ir=/\{\n\/\* \[wrapped with (.+)\] \*/,Zo=/,? & /,ea=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,ta=/[()=,{}\[\]\/\s]/,ra=/\\(\\)?/g,na=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,It=/\w*$/,ia=/^[-+]0x[0-9a-f]+$/i,sa=/^0b[01]+$/i,oa=/^\[object .+?Constructor\]$/,aa=/^0o[0-7]+$/i,ua=/^(?:0|[1-9]\d*)$/,sr=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,En=/($^)/,ca=/['\n\r\u2028\u2029\\]/g,Cn="\uD800-\uDFFF",ha="\\u0300-\\u036f",la="\\ufe20-\\ufe2f",In="\\u20d0-\\u20ff",as=ha+la+In,us="\\u2700-\\u27bf",Lt="a-z\\xdf-\\xf6\\xf8-\\xff",pa="\\xac\\xb1\\xd7\\xf7",fa="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",da="\\u2000-\\u206f",ga=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",cs="A-Z\\xc0-\\xd6\\xd8-\\xde",hs="\\ufe0e\\ufe0f",Yr=pa+fa+da+ga,Di="['\u2019]",Jr="["+Cn+"]",vi="["+Yr+"]",Xr="["+as+"]",ls="\\d+",Da="["+us+"]",ps="["+Lt+"]",fs="[^"+Cn+Yr+ls+us+Lt+cs+"]",Pn="\uD83C[\uDFFB-\uDFFF]",va="(?:"+Xr+"|"+Pn+")",ds="[^"+Cn+"]",Sn="(?:\uD83C[\uDDE6-\uDDFF]){2}",Ir="[\uD800-\uDBFF][\uDC00-\uDFFF]",vt="["+cs+"]",gs="\\u200d",Ds="(?:"+ps+"|"+fs+")",Wt="(?:"+vt+"|"+fs+")",vs="(?:"+Di+"(?:d|ll|m|re|s|t|ve))?",ys="(?:"+Di+"(?:D|LL|M|RE|S|T|VE))?",ms=va+"?",ws="["+hs+"]?",ya="(?:"+gs+"(?:"+[ds,Sn,Ir].join("|")+")"+ws+ms+")*",or="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",bs="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",_s=ws+ms+ya,xn="(?:"+[Da,Sn,Ir].join("|")+")"+_s,ma="(?:"+[ds+Xr+"?",Xr,Sn,Ir,Jr].join("|")+")",yi=RegExp(Di,"g"),wa=RegExp(Xr,"g"),An=RegExp(Pn+"(?="+Pn+")|"+ma+_s,"g"),Es=RegExp([vt+"?"+ps+"+"+vs+"(?="+[vi,vt,"$"].join("|")+")",Wt+"+"+ys+"(?="+[vi,vt+Ds,"$"].join("|")+")",vt+"?"+Ds+"+"+vs,vt+"+"+ys,bs,or,ls,xn].join("|"),"g"),Cs=RegExp("["+gs+Cn+as+hs+"]"),Zr=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Is=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],ba=-1,me={};me[Dn]=me[ct]=me[vn]=me[yn]=me[ci]=me[mn]=me[Cr]=me[wn]=me[bn]=!0,me[le]=me[Qe]=me[Kt]=me[et]=me[Gt]=me[_r]=me[Br]=me[Er]=me[ut]=me[Vr]=me[Ft]=me[Hr]=me[Dt]=me[Kr]=me[Gr]=!1;var ye={};ye[le]=ye[Qe]=ye[Kt]=ye[Gt]=ye[et]=ye[_r]=ye[Dn]=ye[ct]=ye[vn]=ye[yn]=ye[ci]=ye[ut]=ye[Vr]=ye[Ft]=ye[Hr]=ye[Dt]=ye[Kr]=ye[gn]=ye[mn]=ye[Cr]=ye[wn]=ye[bn]=!0,ye[Br]=ye[Er]=ye[Gr]=!1;var g={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},b={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},N={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},U={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},we=parseFloat,ne=parseInt,Ee=typeof si=="object"&&si&&si.Object===Object&&si,Te=typeof self=="object"&&self&&self.Object===Object&&self,pe=Ee||Te||Function("return this")(),be=n&&!n.nodeType&&n,Oe=be&&!0&&o&&!o.nodeType&&o,ht=Oe&&Oe.exports===be,je=ht&&Ee.process,Ce=function(){try{var w=Oe&&Oe.require&&Oe.require("util").types;return w||je&&je.binding&&je.binding("util")}catch{}}(),tt=Ce&&Ce.isArrayBuffer,Ut=Ce&&Ce.isDate,Pt=Ce&&Ce.isMap,Qt=Ce&&Ce.isRegExp,mi=Ce&&Ce.isSet,en=Ce&&Ce.isTypedArray;function Me(w,A,P){switch(P.length){case 0:return w.call(A);case 1:return w.call(A,P[0]);case 2:return w.call(A,P[0],P[1]);case 3:return w.call(A,P[0],P[1],P[2])}return w.apply(A,P)}function Zm(w,A,P,$){for(var ee=-1,ge=w==null?0:w.length;++ee<ge;){var Fe=w[ee];A($,Fe,P(Fe),w)}return $}function St(w,A){for(var P=-1,$=w==null?0:w.length;++P<$&&A(w[P],P,w)!==!1;);return w}function ew(w,A){for(var P=w==null?0:w.length;P--&&A(w[P],P,w)!==!1;);return w}function xh(w,A){for(var P=-1,$=w==null?0:w.length;++P<$;)if(!A(w[P],P,w))return!1;return!0}function Pr(w,A){for(var P=-1,$=w==null?0:w.length,ee=0,ge=[];++P<$;){var Fe=w[P];A(Fe,P,w)&&(ge[ee++]=Fe)}return ge}function Ps(w,A){var P=w==null?0:w.length;return!!P&&On(w,A,0)>-1}function _a(w,A,P){for(var $=-1,ee=w==null?0:w.length;++$<ee;)if(P(A,w[$]))return!0;return!1}function Se(w,A){for(var P=-1,$=w==null?0:w.length,ee=Array($);++P<$;)ee[P]=A(w[P],P,w);return ee}function Sr(w,A){for(var P=-1,$=A.length,ee=w.length;++P<$;)w[ee+P]=A[P];return w}function Ea(w,A,P,$){var ee=-1,ge=w==null?0:w.length;for($&&ge&&(P=w[++ee]);++ee<ge;)P=A(P,w[ee],ee,w);return P}function tw(w,A,P,$){var ee=w==null?0:w.length;for($&&ee&&(P=w[--ee]);ee--;)P=A(P,w[ee],ee,w);return P}function Ca(w,A){for(var P=-1,$=w==null?0:w.length;++P<$;)if(A(w[P],P,w))return!0;return!1}var rw=Ia("length");function nw(w){return w.split("")}function iw(w){return w.match(ea)||[]}function Ah(w,A,P){var $;return P(w,function(ee,ge,Fe){if(A(ee,ge,Fe))return $=ge,!1}),$}function Ss(w,A,P,$){for(var ee=w.length,ge=P+($?1:-1);$?ge--:++ge<ee;)if(A(w[ge],ge,w))return ge;return-1}function On(w,A,P){return A===A?Dw(w,A,P):Ss(w,Oh,P)}function sw(w,A,P,$){for(var ee=P-1,ge=w.length;++ee<ge;)if($(w[ee],A))return ee;return-1}function Oh(w){return w!==w}function Rh(w,A){var P=w==null?0:w.length;return P?Sa(w,A)/P:Pe}function Ia(w){return function(A){return A==null?r:A[w]}}function Pa(w){return function(A){return w==null?r:w[A]}}function Nh(w,A,P,$,ee){return ee(w,function(ge,Fe,_e){P=$?($=!1,ge):A(P,ge,Fe,_e)}),P}function ow(w,A){var P=w.length;for(w.sort(A);P--;)w[P]=w[P].value;return w}function Sa(w,A){for(var P,$=-1,ee=w.length;++$<ee;){var ge=A(w[$]);ge!==r&&(P=P===r?ge:P+ge)}return P}function xa(w,A){for(var P=-1,$=Array(w);++P<w;)$[P]=A(P);return $}function aw(w,A){return Se(A,function(P){return[P,w[P]]})}function Th(w){return w&&w.slice(0,Fh(w)+1).replace(di,"")}function yt(w){return function(A){return w(A)}}function Aa(w,A){return Se(A,function(P){return w[P]})}function wi(w,A){return w.has(A)}function jh(w,A){for(var P=-1,$=w.length;++P<$&&On(A,w[P],0)>-1;);return P}function zh(w,A){for(var P=w.length;P--&&On(A,w[P],0)>-1;);return P}function uw(w,A){for(var P=w.length,$=0;P--;)w[P]===A&&++$;return $}var cw=Pa(g),hw=Pa(b);function lw(w){return"\\"+U[w]}function pw(w,A){return w==null?r:w[A]}function Rn(w){return Cs.test(w)}function fw(w){return Zr.test(w)}function dw(w){for(var A,P=[];!(A=w.next()).done;)P.push(A.value);return P}function Oa(w){var A=-1,P=Array(w.size);return w.forEach(function($,ee){P[++A]=[ee,$]}),P}function qh(w,A){return function(P){return w(A(P))}}function xr(w,A){for(var P=-1,$=w.length,ee=0,ge=[];++P<$;){var Fe=w[P];(Fe===A||Fe===E)&&(w[P]=E,ge[ee++]=P)}return ge}function xs(w){var A=-1,P=Array(w.size);return w.forEach(function($){P[++A]=$}),P}function gw(w){var A=-1,P=Array(w.size);return w.forEach(function($){P[++A]=[$,$]}),P}function Dw(w,A,P){for(var $=P-1,ee=w.length;++$<ee;)if(w[$]===A)return $;return-1}function vw(w,A,P){for(var $=P+1;$--;)if(w[$]===A)return $;return $}function Nn(w){return Rn(w)?mw(w):rw(w)}function Mt(w){return Rn(w)?ww(w):nw(w)}function Fh(w){for(var A=w.length;A--&&os.test(w.charAt(A)););return A}var yw=Pa(N);function mw(w){for(var A=An.lastIndex=0;An.test(w);)++A;return A}function ww(w){return w.match(An)||[]}function bw(w){return w.match(Es)||[]}var _w=function w(A){A=A==null?pe:Tn.defaults(pe.Object(),A,Tn.pick(pe,Is));var P=A.Array,$=A.Date,ee=A.Error,ge=A.Function,Fe=A.Math,_e=A.Object,Ra=A.RegExp,Ew=A.String,xt=A.TypeError,As=P.prototype,Cw=ge.prototype,jn=_e.prototype,Os=A["__core-js_shared__"],Rs=Cw.toString,ve=jn.hasOwnProperty,Iw=0,Lh=function(){var e=/[^.]+$/.exec(Os&&Os.keys&&Os.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),Ns=jn.toString,Pw=Rs.call(_e),Sw=pe._,xw=Ra("^"+Rs.call(ve).replace(fi,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ts=ht?A.Buffer:r,Ar=A.Symbol,js=A.Uint8Array,Uh=Ts?Ts.allocUnsafe:r,zs=qh(_e.getPrototypeOf,_e),Mh=_e.create,$h=jn.propertyIsEnumerable,qs=As.splice,kh=Ar?Ar.isConcatSpreadable:r,bi=Ar?Ar.iterator:r,tn=Ar?Ar.toStringTag:r,Fs=function(){try{var e=an(_e,"defineProperty");return e({},"",{}),e}catch{}}(),Aw=A.clearTimeout!==pe.clearTimeout&&A.clearTimeout,Ow=$&&$.now!==pe.Date.now&&$.now,Rw=A.setTimeout!==pe.setTimeout&&A.setTimeout,Ls=Fe.ceil,Us=Fe.floor,Na=_e.getOwnPropertySymbols,Nw=Ts?Ts.isBuffer:r,Bh=A.isFinite,Tw=As.join,jw=qh(_e.keys,_e),Le=Fe.max,Ye=Fe.min,zw=$.now,qw=A.parseInt,Vh=Fe.random,Fw=As.reverse,Ta=an(A,"DataView"),_i=an(A,"Map"),ja=an(A,"Promise"),zn=an(A,"Set"),Ei=an(A,"WeakMap"),Ci=an(_e,"create"),Ms=Ei&&new Ei,qn={},Lw=un(Ta),Uw=un(_i),Mw=un(ja),$w=un(zn),kw=un(Ei),$s=Ar?Ar.prototype:r,Ii=$s?$s.valueOf:r,Hh=$s?$s.toString:r;function l(e){if(Ae(e)&&!te(e)&&!(e instanceof he)){if(e instanceof At)return e;if(ve.call(e,"__wrapped__"))return Kl(e)}return new At(e)}var Fn=function(){function e(){}return function(t){if(!xe(t))return{};if(Mh)return Mh(t);e.prototype=t;var i=new e;return e.prototype=r,i}}();function ks(){}function At(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=r}l.templateSettings={escape:li,evaluate:pi,interpolate:_n,variable:"",imports:{_:l}},l.prototype=ks.prototype,l.prototype.constructor=l,At.prototype=Fn(ks.prototype),At.prototype.constructor=At;function he(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=He,this.__views__=[]}function Bw(){var e=new he(this.__wrapped__);return e.__actions__=lt(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=lt(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=lt(this.__views__),e}function Vw(){if(this.__filtered__){var e=new he(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function Hw(){var e=this.__wrapped__.value(),t=this.__dir__,i=te(e),u=t<0,c=i?e.length:0,f=n_(0,c,this.__views__),D=f.start,y=f.end,_=y-D,O=u?y:D-1,R=this.__iteratees__,j=R.length,L=0,V=Ye(_,this.__takeCount__);if(!i||!u&&c==_&&V==_)return gl(e,this.__actions__);var Y=[];e:for(;_--&&L<V;){O+=t;for(var oe=-1,J=e[O];++oe<j;){var ue=R[oe],fe=ue.iteratee,bt=ue.type,it=fe(J);if(bt==at)J=it;else if(!it){if(bt==Z)continue e;break e}}Y[L++]=J}return Y}he.prototype=Fn(ks.prototype),he.prototype.constructor=he;function rn(e){var t=-1,i=e==null?0:e.length;for(this.clear();++t<i;){var u=e[t];this.set(u[0],u[1])}}function Kw(){this.__data__=Ci?Ci(null):{},this.size=0}function Gw(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}function Ww(e){var t=this.__data__;if(Ci){var i=t[e];return i===m?r:i}return ve.call(t,e)?t[e]:r}function Qw(e){var t=this.__data__;return Ci?t[e]!==r:ve.call(t,e)}function Yw(e,t){var i=this.__data__;return this.size+=this.has(e)?0:1,i[e]=Ci&&t===r?m:t,this}rn.prototype.clear=Kw,rn.prototype.delete=Gw,rn.prototype.get=Ww,rn.prototype.has=Qw,rn.prototype.set=Yw;function ar(e){var t=-1,i=e==null?0:e.length;for(this.clear();++t<i;){var u=e[t];this.set(u[0],u[1])}}function Jw(){this.__data__=[],this.size=0}function Xw(e){var t=this.__data__,i=Bs(t,e);if(i<0)return!1;var u=t.length-1;return i==u?t.pop():qs.call(t,i,1),--this.size,!0}function Zw(e){var t=this.__data__,i=Bs(t,e);return i<0?r:t[i][1]}function eb(e){return Bs(this.__data__,e)>-1}function tb(e,t){var i=this.__data__,u=Bs(i,e);return u<0?(++this.size,i.push([e,t])):i[u][1]=t,this}ar.prototype.clear=Jw,ar.prototype.delete=Xw,ar.prototype.get=Zw,ar.prototype.has=eb,ar.prototype.set=tb;function ur(e){var t=-1,i=e==null?0:e.length;for(this.clear();++t<i;){var u=e[t];this.set(u[0],u[1])}}function rb(){this.size=0,this.__data__={hash:new rn,map:new(_i||ar),string:new rn}}function nb(e){var t=to(this,e).delete(e);return this.size-=t?1:0,t}function ib(e){return to(this,e).get(e)}function sb(e){return to(this,e).has(e)}function ob(e,t){var i=to(this,e),u=i.size;return i.set(e,t),this.size+=i.size==u?0:1,this}ur.prototype.clear=rb,ur.prototype.delete=nb,ur.prototype.get=ib,ur.prototype.has=sb,ur.prototype.set=ob;function nn(e){var t=-1,i=e==null?0:e.length;for(this.__data__=new ur;++t<i;)this.add(e[t])}function ab(e){return this.__data__.set(e,m),this}function ub(e){return this.__data__.has(e)}nn.prototype.add=nn.prototype.push=ab,nn.prototype.has=ub;function $t(e){var t=this.__data__=new ar(e);this.size=t.size}function cb(){this.__data__=new ar,this.size=0}function hb(e){var t=this.__data__,i=t.delete(e);return this.size=t.size,i}function lb(e){return this.__data__.get(e)}function pb(e){return this.__data__.has(e)}function fb(e,t){var i=this.__data__;if(i instanceof ar){var u=i.__data__;if(!_i||u.length<a-1)return u.push([e,t]),this.size=++i.size,this;i=this.__data__=new ur(u)}return i.set(e,t),this.size=i.size,this}$t.prototype.clear=cb,$t.prototype.delete=hb,$t.prototype.get=lb,$t.prototype.has=pb,$t.prototype.set=fb;function Kh(e,t){var i=te(e),u=!i&&cn(e),c=!i&&!u&&jr(e),f=!i&&!u&&!c&&$n(e),D=i||u||c||f,y=D?xa(e.length,Ew):[],_=y.length;for(var O in e)(t||ve.call(e,O))&&!(D&&(O=="length"||c&&(O=="offset"||O=="parent")||f&&(O=="buffer"||O=="byteLength"||O=="byteOffset")||pr(O,_)))&&y.push(O);return y}function Gh(e){var t=e.length;return t?e[Ha(0,t-1)]:r}function db(e,t){return ro(lt(e),sn(t,0,e.length))}function gb(e){return ro(lt(e))}function za(e,t,i){(i!==r&&!kt(e[t],i)||i===r&&!(t in e))&&cr(e,t,i)}function Pi(e,t,i){var u=e[t];(!(ve.call(e,t)&&kt(u,i))||i===r&&!(t in e))&&cr(e,t,i)}function Bs(e,t){for(var i=e.length;i--;)if(kt(e[i][0],t))return i;return-1}function Db(e,t,i,u){return Or(e,function(c,f,D){t(u,c,i(c),D)}),u}function Wh(e,t){return e&&Jt(t,$e(t),e)}function vb(e,t){return e&&Jt(t,ft(t),e)}function cr(e,t,i){t=="__proto__"&&Fs?Fs(e,t,{configurable:!0,enumerable:!0,value:i,writable:!0}):e[t]=i}function qa(e,t){for(var i=-1,u=t.length,c=P(u),f=e==null;++i<u;)c[i]=f?r:Du(e,t[i]);return c}function sn(e,t,i){return e===e&&(i!==r&&(e=e<=i?e:i),t!==r&&(e=e>=t?e:t)),e}function Ot(e,t,i,u,c,f){var D,y=t&C,_=t&S,O=t&z;if(i&&(D=c?i(e,u,c,f):i(e)),D!==r)return D;if(!xe(e))return e;var R=te(e);if(R){if(D=s_(e),!y)return lt(e,D)}else{var j=Je(e),L=j==Er||j==ui;if(jr(e))return yl(e,y);if(j==Ft||j==le||L&&!c){if(D=_||L?{}:Fl(e),!y)return _?Wb(e,vb(D,e)):Gb(e,Wh(D,e))}else{if(!ye[j])return c?e:{};D=o_(e,j,y)}}f||(f=new $t);var V=f.get(e);if(V)return V;f.set(e,D),pp(e)?e.forEach(function(J){D.add(Ot(J,t,i,J,e,f))}):hp(e)&&e.forEach(function(J,ue){D.set(ue,Ot(J,t,i,ue,e,f))});var Y=O?_?ru:tu:_?ft:$e,oe=R?r:Y(e);return St(oe||e,function(J,ue){oe&&(ue=J,J=e[ue]),Pi(D,ue,Ot(J,t,i,ue,e,f))}),D}function yb(e){var t=$e(e);return function(i){return Qh(i,e,t)}}function Qh(e,t,i){var u=i.length;if(e==null)return!u;for(e=_e(e);u--;){var c=i[u],f=t[c],D=e[c];if(D===r&&!(c in e)||!f(D))return!1}return!0}function Yh(e,t,i){if(typeof e!="function")throw new xt(p);return Ti(function(){e.apply(r,i)},t)}function Si(e,t,i,u){var c=-1,f=Ps,D=!0,y=e.length,_=[],O=t.length;if(!y)return _;i&&(t=Se(t,yt(i))),u?(f=_a,D=!1):t.length>=a&&(f=wi,D=!1,t=new nn(t));e:for(;++c<y;){var R=e[c],j=i==null?R:i(R);if(R=u||R!==0?R:0,D&&j===j){for(var L=O;L--;)if(t[L]===j)continue e;_.push(R)}else f(t,j,u)||_.push(R)}return _}var Or=El(Yt),Jh=El(La,!0);function mb(e,t){var i=!0;return Or(e,function(u,c,f){return i=!!t(u,c,f),i}),i}function Vs(e,t,i){for(var u=-1,c=e.length;++u<c;){var f=e[u],D=t(f);if(D!=null&&(y===r?D===D&&!wt(D):i(D,y)))var y=D,_=f}return _}function wb(e,t,i,u){var c=e.length;for(i=se(i),i<0&&(i=-i>c?0:c+i),u=u===r||u>c?c:se(u),u<0&&(u+=c),u=i>u?0:dp(u);i<u;)e[i++]=t;return e}function Xh(e,t){var i=[];return Or(e,function(u,c,f){t(u,c,f)&&i.push(u)}),i}function Ke(e,t,i,u,c){var f=-1,D=e.length;for(i||(i=u_),c||(c=[]);++f<D;){var y=e[f];t>0&&i(y)?t>1?Ke(y,t-1,i,u,c):Sr(c,y):u||(c[c.length]=y)}return c}var Fa=Cl(),Zh=Cl(!0);function Yt(e,t){return e&&Fa(e,t,$e)}function La(e,t){return e&&Zh(e,t,$e)}function Hs(e,t){return Pr(t,function(i){return fr(e[i])})}function on(e,t){t=Nr(t,e);for(var i=0,u=t.length;e!=null&&i<u;)e=e[Xt(t[i++])];return i&&i==u?e:r}function el(e,t,i){var u=t(e);return te(e)?u:Sr(u,i(e))}function rt(e){return e==null?e===r?Go:Ho:tn&&tn in _e(e)?r_(e):g_(e)}function Ua(e,t){return e>t}function bb(e,t){return e!=null&&ve.call(e,t)}function _b(e,t){return e!=null&&t in _e(e)}function Eb(e,t,i){return e>=Ye(t,i)&&e<Le(t,i)}function Ma(e,t,i){for(var u=i?_a:Ps,c=e[0].length,f=e.length,D=f,y=P(f),_=1/0,O=[];D--;){var R=e[D];D&&t&&(R=Se(R,yt(t))),_=Ye(R.length,_),y[D]=!i&&(t||c>=120&&R.length>=120)?new nn(D&&R):r}R=e[0];var j=-1,L=y[0];e:for(;++j<c&&O.length<_;){var V=R[j],Y=t?t(V):V;if(V=i||V!==0?V:0,!(L?wi(L,Y):u(O,Y,i))){for(D=f;--D;){var oe=y[D];if(!(oe?wi(oe,Y):u(e[D],Y,i)))continue e}L&&L.push(Y),O.push(V)}}return O}function Cb(e,t,i,u){return Yt(e,function(c,f,D){t(u,i(c),f,D)}),u}function xi(e,t,i){t=Nr(t,e),e=$l(e,t);var u=e==null?e:e[Xt(Nt(t))];return u==null?r:Me(u,e,i)}function tl(e){return Ae(e)&&rt(e)==le}function Ib(e){return Ae(e)&&rt(e)==Kt}function Pb(e){return Ae(e)&&rt(e)==_r}function Ai(e,t,i,u,c){return e===t?!0:e==null||t==null||!Ae(e)&&!Ae(t)?e!==e&&t!==t:Sb(e,t,i,u,Ai,c)}function Sb(e,t,i,u,c,f){var D=te(e),y=te(t),_=D?Qe:Je(e),O=y?Qe:Je(t);_=_==le?Ft:_,O=O==le?Ft:O;var R=_==Ft,j=O==Ft,L=_==O;if(L&&jr(e)){if(!jr(t))return!1;D=!0,R=!1}if(L&&!R)return f||(f=new $t),D||$n(e)?jl(e,t,i,u,c,f):e_(e,t,_,i,u,c,f);if(!(i&I)){var V=R&&ve.call(e,"__wrapped__"),Y=j&&ve.call(t,"__wrapped__");if(V||Y){var oe=V?e.value():e,J=Y?t.value():t;return f||(f=new $t),c(oe,J,i,u,f)}}return L?(f||(f=new $t),t_(e,t,i,u,c,f)):!1}function xb(e){return Ae(e)&&Je(e)==ut}function $a(e,t,i,u){var c=i.length,f=c,D=!u;if(e==null)return!f;for(e=_e(e);c--;){var y=i[c];if(D&&y[2]?y[1]!==e[y[0]]:!(y[0]in e))return!1}for(;++c<f;){y=i[c];var _=y[0],O=e[_],R=y[1];if(D&&y[2]){if(O===r&&!(_ in e))return!1}else{var j=new $t;if(u)var L=u(O,R,_,e,t,j);if(!(L===r?Ai(R,O,I|T,u,j):L))return!1}}return!0}function rl(e){if(!xe(e)||h_(e))return!1;var t=fr(e)?xw:oa;return t.test(un(e))}function Ab(e){return Ae(e)&&rt(e)==Hr}function Ob(e){return Ae(e)&&Je(e)==Dt}function Rb(e){return Ae(e)&&uo(e.length)&&!!me[rt(e)]}function nl(e){return typeof e=="function"?e:e==null?dt:typeof e=="object"?te(e)?ol(e[0],e[1]):sl(e):Ip(e)}function ka(e){if(!Ni(e))return jw(e);var t=[];for(var i in _e(e))ve.call(e,i)&&i!="constructor"&&t.push(i);return t}function Nb(e){if(!xe(e))return d_(e);var t=Ni(e),i=[];for(var u in e)u=="constructor"&&(t||!ve.call(e,u))||i.push(u);return i}function Ba(e,t){return e<t}function il(e,t){var i=-1,u=pt(e)?P(e.length):[];return Or(e,function(c,f,D){u[++i]=t(c,f,D)}),u}function sl(e){var t=iu(e);return t.length==1&&t[0][2]?Ul(t[0][0],t[0][1]):function(i){return i===e||$a(i,e,t)}}function ol(e,t){return ou(e)&&Ll(t)?Ul(Xt(e),t):function(i){var u=Du(i,e);return u===r&&u===t?vu(i,e):Ai(t,u,I|T)}}function Ks(e,t,i,u,c){e!==t&&Fa(t,function(f,D){if(c||(c=new $t),xe(f))Tb(e,t,D,i,Ks,u,c);else{var y=u?u(uu(e,D),f,D+"",e,t,c):r;y===r&&(y=f),za(e,D,y)}},ft)}function Tb(e,t,i,u,c,f,D){var y=uu(e,i),_=uu(t,i),O=D.get(_);if(O){za(e,i,O);return}var R=f?f(y,_,i+"",e,t,D):r,j=R===r;if(j){var L=te(_),V=!L&&jr(_),Y=!L&&!V&&$n(_);R=_,L||V||Y?te(y)?R=y:Re(y)?R=lt(y):V?(j=!1,R=yl(_,!0)):Y?(j=!1,R=ml(_,!0)):R=[]:ji(_)||cn(_)?(R=y,cn(y)?R=gp(y):(!xe(y)||fr(y))&&(R=Fl(_))):j=!1}j&&(D.set(_,R),c(R,_,u,f,D),D.delete(_)),za(e,i,R)}function al(e,t){var i=e.length;if(i)return t+=t<0?i:0,pr(t,i)?e[t]:r}function ul(e,t,i){t.length?t=Se(t,function(f){return te(f)?function(D){return on(D,f.length===1?f[0]:f)}:f}):t=[dt];var u=-1;t=Se(t,yt(Q()));var c=il(e,function(f,D,y){var _=Se(t,function(O){return O(f)});return{criteria:_,index:++u,value:f}});return ow(c,function(f,D){return Kb(f,D,i)})}function jb(e,t){return cl(e,t,function(i,u){return vu(e,u)})}function cl(e,t,i){for(var u=-1,c=t.length,f={};++u<c;){var D=t[u],y=on(e,D);i(y,D)&&Oi(f,Nr(D,e),y)}return f}function zb(e){return function(t){return on(t,e)}}function Va(e,t,i,u){var c=u?sw:On,f=-1,D=t.length,y=e;for(e===t&&(t=lt(t)),i&&(y=Se(e,yt(i)));++f<D;)for(var _=0,O=t[f],R=i?i(O):O;(_=c(y,R,_,u))>-1;)y!==e&&qs.call(y,_,1),qs.call(e,_,1);return e}function hl(e,t){for(var i=e?t.length:0,u=i-1;i--;){var c=t[i];if(i==u||c!==f){var f=c;pr(c)?qs.call(e,c,1):Wa(e,c)}}return e}function Ha(e,t){return e+Us(Vh()*(t-e+1))}function qb(e,t,i,u){for(var c=-1,f=Le(Ls((t-e)/(i||1)),0),D=P(f);f--;)D[u?f:++c]=e,e+=i;return D}function Ka(e,t){var i="";if(!e||t<1||t>Ct)return i;do t%2&&(i+=e),t=Us(t/2),t&&(e+=e);while(t);return i}function ae(e,t){return cu(Ml(e,t,dt),e+"")}function Fb(e){return Gh(kn(e))}function Lb(e,t){var i=kn(e);return ro(i,sn(t,0,i.length))}function Oi(e,t,i,u){if(!xe(e))return e;t=Nr(t,e);for(var c=-1,f=t.length,D=f-1,y=e;y!=null&&++c<f;){var _=Xt(t[c]),O=i;if(_==="__proto__"||_==="constructor"||_==="prototype")return e;if(c!=D){var R=y[_];O=u?u(R,_,y):r,O===r&&(O=xe(R)?R:pr(t[c+1])?[]:{})}Pi(y,_,O),y=y[_]}return e}var ll=Ms?function(e,t){return Ms.set(e,t),e}:dt,Ub=Fs?function(e,t){return Fs(e,"toString",{configurable:!0,enumerable:!1,value:mu(t),writable:!0})}:dt;function Mb(e){return ro(kn(e))}function Rt(e,t,i){var u=-1,c=e.length;t<0&&(t=-t>c?0:c+t),i=i>c?c:i,i<0&&(i+=c),c=t>i?0:i-t>>>0,t>>>=0;for(var f=P(c);++u<c;)f[u]=e[u+t];return f}function $b(e,t){var i;return Or(e,function(u,c,f){return i=t(u,c,f),!i}),!!i}function Gs(e,t,i){var u=0,c=e==null?u:e.length;if(typeof t=="number"&&t===t&&c<=br){for(;u<c;){var f=u+c>>>1,D=e[f];D!==null&&!wt(D)&&(i?D<=t:D<t)?u=f+1:c=f}return c}return Ga(e,t,dt,i)}function Ga(e,t,i,u){var c=0,f=e==null?0:e.length;if(f===0)return 0;t=i(t);for(var D=t!==t,y=t===null,_=wt(t),O=t===r;c<f;){var R=Us((c+f)/2),j=i(e[R]),L=j!==r,V=j===null,Y=j===j,oe=wt(j);if(D)var J=u||Y;else O?J=Y&&(u||L):y?J=Y&&L&&(u||!V):_?J=Y&&L&&!V&&(u||!oe):V||oe?J=!1:J=u?j<=t:j<t;J?c=R+1:f=R}return Ye(f,fn)}function pl(e,t){for(var i=-1,u=e.length,c=0,f=[];++i<u;){var D=e[i],y=t?t(D):D;if(!i||!kt(y,_)){var _=y;f[c++]=D===0?0:D}}return f}function fl(e){return typeof e=="number"?e:wt(e)?Pe:+e}function mt(e){if(typeof e=="string")return e;if(te(e))return Se(e,mt)+"";if(wt(e))return Hh?Hh.call(e):"";var t=e+"";return t=="0"&&1/e==-qt?"-0":t}function Rr(e,t,i){var u=-1,c=Ps,f=e.length,D=!0,y=[],_=y;if(i)D=!1,c=_a;else if(f>=a){var O=t?null:Xb(e);if(O)return xs(O);D=!1,c=wi,_=new nn}else _=t?[]:y;e:for(;++u<f;){var R=e[u],j=t?t(R):R;if(R=i||R!==0?R:0,D&&j===j){for(var L=_.length;L--;)if(_[L]===j)continue e;t&&_.push(j),y.push(R)}else c(_,j,i)||(_!==y&&_.push(j),y.push(R))}return y}function Wa(e,t){return t=Nr(t,e),e=$l(e,t),e==null||delete e[Xt(Nt(t))]}function dl(e,t,i,u){return Oi(e,t,i(on(e,t)),u)}function Ws(e,t,i,u){for(var c=e.length,f=u?c:-1;(u?f--:++f<c)&&t(e[f],f,e););return i?Rt(e,u?0:f,u?f+1:c):Rt(e,u?f+1:0,u?c:f)}function gl(e,t){var i=e;return i instanceof he&&(i=i.value()),Ea(t,function(u,c){return c.func.apply(c.thisArg,Sr([u],c.args))},i)}function Qa(e,t,i){var u=e.length;if(u<2)return u?Rr(e[0]):[];for(var c=-1,f=P(u);++c<u;)for(var D=e[c],y=-1;++y<u;)y!=c&&(f[c]=Si(f[c]||D,e[y],t,i));return Rr(Ke(f,1),t,i)}function Dl(e,t,i){for(var u=-1,c=e.length,f=t.length,D={};++u<c;){var y=u<f?t[u]:r;i(D,e[u],y)}return D}function Ya(e){return Re(e)?e:[]}function Ja(e){return typeof e=="function"?e:dt}function Nr(e,t){return te(e)?e:ou(e,t)?[e]:Hl(De(e))}var kb=ae;function Tr(e,t,i){var u=e.length;return i=i===r?u:i,!t&&i>=u?e:Rt(e,t,i)}var vl=Aw||function(e){return pe.clearTimeout(e)};function yl(e,t){if(t)return e.slice();var i=e.length,u=Uh?Uh(i):new e.constructor(i);return e.copy(u),u}function Xa(e){var t=new e.constructor(e.byteLength);return new js(t).set(new js(e)),t}function Bb(e,t){var i=t?Xa(e.buffer):e.buffer;return new e.constructor(i,e.byteOffset,e.byteLength)}function Vb(e){var t=new e.constructor(e.source,It.exec(e));return t.lastIndex=e.lastIndex,t}function Hb(e){return Ii?_e(Ii.call(e)):{}}function ml(e,t){var i=t?Xa(e.buffer):e.buffer;return new e.constructor(i,e.byteOffset,e.length)}function wl(e,t){if(e!==t){var i=e!==r,u=e===null,c=e===e,f=wt(e),D=t!==r,y=t===null,_=t===t,O=wt(t);if(!y&&!O&&!f&&e>t||f&&D&&_&&!y&&!O||u&&D&&_||!i&&_||!c)return 1;if(!u&&!f&&!O&&e<t||O&&i&&c&&!u&&!f||y&&i&&c||!D&&c||!_)return-1}return 0}function Kb(e,t,i){for(var u=-1,c=e.criteria,f=t.criteria,D=c.length,y=i.length;++u<D;){var _=wl(c[u],f[u]);if(_){if(u>=y)return _;var O=i[u];return _*(O=="desc"?-1:1)}}return e.index-t.index}function bl(e,t,i,u){for(var c=-1,f=e.length,D=i.length,y=-1,_=t.length,O=Le(f-D,0),R=P(_+O),j=!u;++y<_;)R[y]=t[y];for(;++c<D;)(j||c<f)&&(R[i[c]]=e[c]);for(;O--;)R[y++]=e[c++];return R}function _l(e,t,i,u){for(var c=-1,f=e.length,D=-1,y=i.length,_=-1,O=t.length,R=Le(f-y,0),j=P(R+O),L=!u;++c<R;)j[c]=e[c];for(var V=c;++_<O;)j[V+_]=t[_];for(;++D<y;)(L||c<f)&&(j[V+i[D]]=e[c++]);return j}function lt(e,t){var i=-1,u=e.length;for(t||(t=P(u));++i<u;)t[i]=e[i];return t}function Jt(e,t,i,u){var c=!i;i||(i={});for(var f=-1,D=t.length;++f<D;){var y=t[f],_=u?u(i[y],e[y],y,i,e):r;_===r&&(_=e[y]),c?cr(i,y,_):Pi(i,y,_)}return i}function Gb(e,t){return Jt(e,su(e),t)}function Wb(e,t){return Jt(e,zl(e),t)}function Qs(e,t){return function(i,u){var c=te(i)?Zm:Db,f=t?t():{};return c(i,e,Q(u,2),f)}}function Ln(e){return ae(function(t,i){var u=-1,c=i.length,f=c>1?i[c-1]:r,D=c>2?i[2]:r;for(f=e.length>3&&typeof f=="function"?(c--,f):r,D&&nt(i[0],i[1],D)&&(f=c<3?r:f,c=1),t=_e(t);++u<c;){var y=i[u];y&&e(t,y,u,f)}return t})}function El(e,t){return function(i,u){if(i==null)return i;if(!pt(i))return e(i,u);for(var c=i.length,f=t?c:-1,D=_e(i);(t?f--:++f<c)&&u(D[f],f,D)!==!1;);return i}}function Cl(e){return function(t,i,u){for(var c=-1,f=_e(t),D=u(t),y=D.length;y--;){var _=D[e?y:++c];if(i(f[_],_,f)===!1)break}return t}}function Qb(e,t,i){var u=t&k,c=Ri(e);function f(){var D=this&&this!==pe&&this instanceof f?c:e;return D.apply(u?i:this,arguments)}return f}function Il(e){return function(t){t=De(t);var i=Rn(t)?Mt(t):r,u=i?i[0]:t.charAt(0),c=i?Tr(i,1).join(""):t.slice(1);return u[e]()+c}}function Un(e){return function(t){return Ea(Ep(_p(t).replace(yi,"")),e,"")}}function Ri(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var i=Fn(e.prototype),u=e.apply(i,t);return xe(u)?u:i}}function Yb(e,t,i){var u=Ri(e);function c(){for(var f=arguments.length,D=P(f),y=f,_=Mn(c);y--;)D[y]=arguments[y];var O=f<3&&D[0]!==_&&D[f-1]!==_?[]:xr(D,_);if(f-=O.length,f<i)return Ol(e,t,Ys,c.placeholder,r,D,O,r,r,i-f);var R=this&&this!==pe&&this instanceof c?u:e;return Me(R,this,D)}return c}function Pl(e){return function(t,i,u){var c=_e(t);if(!pt(t)){var f=Q(i,3);t=$e(t),i=function(y){return f(c[y],y,c)}}var D=e(t,i,u);return D>-1?c[f?t[D]:D]:r}}function Sl(e){return lr(function(t){var i=t.length,u=i,c=At.prototype.thru;for(e&&t.reverse();u--;){var f=t[u];if(typeof f!="function")throw new xt(p);if(c&&!D&&eo(f)=="wrapper")var D=new At([],!0)}for(u=D?u:i;++u<i;){f=t[u];var y=eo(f),_=y=="wrapper"?nu(f):r;_&&au(_[0])&&_[1]==(q|H|W|F)&&!_[4].length&&_[9]==1?D=D[eo(_[0])].apply(D,_[3]):D=f.length==1&&au(f)?D[y]():D.thru(f)}return function(){var O=arguments,R=O[0];if(D&&O.length==1&&te(R))return D.plant(R).value();for(var j=0,L=i?t[j].apply(this,O):R;++j<i;)L=t[j].call(this,L);return L}})}function Ys(e,t,i,u,c,f,D,y,_,O){var R=t&q,j=t&k,L=t&K,V=t&(H|B),Y=t&ie,oe=L?r:Ri(e);function J(){for(var ue=arguments.length,fe=P(ue),bt=ue;bt--;)fe[bt]=arguments[bt];if(V)var it=Mn(J),_t=uw(fe,it);if(u&&(fe=bl(fe,u,c,V)),f&&(fe=_l(fe,f,D,V)),ue-=_t,V&&ue<O){var Ne=xr(fe,it);return Ol(e,t,Ys,J.placeholder,i,fe,Ne,y,_,O-ue)}var Bt=j?i:this,gr=L?Bt[e]:e;return ue=fe.length,y?fe=D_(fe,y):Y&&ue>1&&fe.reverse(),R&&_<ue&&(fe.length=_),this&&this!==pe&&this instanceof J&&(gr=oe||Ri(gr)),gr.apply(Bt,fe)}return J}function xl(e,t){return function(i,u){return Cb(i,e,t(u),{})}}function Js(e,t){return function(i,u){var c;if(i===r&&u===r)return t;if(i!==r&&(c=i),u!==r){if(c===r)return u;typeof i=="string"||typeof u=="string"?(i=mt(i),u=mt(u)):(i=fl(i),u=fl(u)),c=e(i,u)}return c}}function Za(e){return lr(function(t){return t=Se(t,yt(Q())),ae(function(i){var u=this;return e(t,function(c){return Me(c,u,i)})})})}function Xs(e,t){t=t===r?" ":mt(t);var i=t.length;if(i<2)return i?Ka(t,e):t;var u=Ka(t,Ls(e/Nn(t)));return Rn(t)?Tr(Mt(u),0,e).join(""):u.slice(0,e)}function Jb(e,t,i,u){var c=t&k,f=Ri(e);function D(){for(var y=-1,_=arguments.length,O=-1,R=u.length,j=P(R+_),L=this&&this!==pe&&this instanceof D?f:e;++O<R;)j[O]=u[O];for(;_--;)j[O++]=arguments[++y];return Me(L,c?i:this,j)}return D}function Al(e){return function(t,i,u){return u&&typeof u!="number"&&nt(t,i,u)&&(i=u=r),t=dr(t),i===r?(i=t,t=0):i=dr(i),u=u===r?t<i?1:-1:dr(u),qb(t,i,u,e)}}function Zs(e){return function(t,i){return typeof t=="string"&&typeof i=="string"||(t=Tt(t),i=Tt(i)),e(t,i)}}function Ol(e,t,i,u,c,f,D,y,_,O){var R=t&H,j=R?D:r,L=R?r:D,V=R?f:r,Y=R?r:f;t|=R?W:x,t&=~(R?x:W),t&X||(t&=~(k|K));var oe=[e,t,c,V,j,Y,L,y,_,O],J=i.apply(r,oe);return au(e)&&kl(J,oe),J.placeholder=u,Bl(J,e,t)}function eu(e){var t=Fe[e];return function(i,u){if(i=Tt(i),u=u==null?0:Ye(se(u),292),u&&Bh(i)){var c=(De(i)+"e").split("e"),f=t(c[0]+"e"+(+c[1]+u));return c=(De(f)+"e").split("e"),+(c[0]+"e"+(+c[1]-u))}return t(i)}}var Xb=zn&&1/xs(new zn([,-0]))[1]==qt?function(e){return new zn(e)}:_u;function Rl(e){return function(t){var i=Je(t);return i==ut?Oa(t):i==Dt?gw(t):aw(t,e(t))}}function hr(e,t,i,u,c,f,D,y){var _=t&K;if(!_&&typeof e!="function")throw new xt(p);var O=u?u.length:0;if(O||(t&=~(W|x),u=c=r),D=D===r?D:Le(se(D),0),y=y===r?y:se(y),O-=c?c.length:0,t&x){var R=u,j=c;u=c=r}var L=_?r:nu(e),V=[e,t,i,u,c,R,j,f,D,y];if(L&&f_(V,L),e=V[0],t=V[1],i=V[2],u=V[3],c=V[4],y=V[9]=V[9]===r?_?0:e.length:Le(V[9]-O,0),!y&&t&(H|B)&&(t&=~(H|B)),!t||t==k)var Y=Qb(e,t,i);else t==H||t==B?Y=Yb(e,t,y):(t==W||t==(k|W))&&!c.length?Y=Jb(e,t,i,u):Y=Ys.apply(r,V);var oe=L?ll:kl;return Bl(oe(Y,V),e,t)}function Nl(e,t,i,u){return e===r||kt(e,jn[i])&&!ve.call(u,i)?t:e}function Tl(e,t,i,u,c,f){return xe(e)&&xe(t)&&(f.set(t,e),Ks(e,t,r,Tl,f),f.delete(t)),e}function Zb(e){return ji(e)?r:e}function jl(e,t,i,u,c,f){var D=i&I,y=e.length,_=t.length;if(y!=_&&!(D&&_>y))return!1;var O=f.get(e),R=f.get(t);if(O&&R)return O==t&&R==e;var j=-1,L=!0,V=i&T?new nn:r;for(f.set(e,t),f.set(t,e);++j<y;){var Y=e[j],oe=t[j];if(u)var J=D?u(oe,Y,j,t,e,f):u(Y,oe,j,e,t,f);if(J!==r){if(J)continue;L=!1;break}if(V){if(!Ca(t,function(ue,fe){if(!wi(V,fe)&&(Y===ue||c(Y,ue,i,u,f)))return V.push(fe)})){L=!1;break}}else if(!(Y===oe||c(Y,oe,i,u,f))){L=!1;break}}return f.delete(e),f.delete(t),L}function e_(e,t,i,u,c,f,D){switch(i){case Gt:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case Kt:return!(e.byteLength!=t.byteLength||!f(new js(e),new js(t)));case et:case _r:case Vr:return kt(+e,+t);case Br:return e.name==t.name&&e.message==t.message;case Hr:case Kr:return e==t+"";case ut:var y=Oa;case Dt:var _=u&I;if(y||(y=xs),e.size!=t.size&&!_)return!1;var O=D.get(e);if(O)return O==t;u|=T,D.set(e,t);var R=jl(y(e),y(t),u,c,f,D);return D.delete(e),R;case gn:if(Ii)return Ii.call(e)==Ii.call(t)}return!1}function t_(e,t,i,u,c,f){var D=i&I,y=tu(e),_=y.length,O=tu(t),R=O.length;if(_!=R&&!D)return!1;for(var j=_;j--;){var L=y[j];if(!(D?L in t:ve.call(t,L)))return!1}var V=f.get(e),Y=f.get(t);if(V&&Y)return V==t&&Y==e;var oe=!0;f.set(e,t),f.set(t,e);for(var J=D;++j<_;){L=y[j];var ue=e[L],fe=t[L];if(u)var bt=D?u(fe,ue,L,t,e,f):u(ue,fe,L,e,t,f);if(!(bt===r?ue===fe||c(ue,fe,i,u,f):bt)){oe=!1;break}J||(J=L=="constructor")}if(oe&&!J){var it=e.constructor,_t=t.constructor;it!=_t&&"constructor"in e&&"constructor"in t&&!(typeof it=="function"&&it instanceof it&&typeof _t=="function"&&_t instanceof _t)&&(oe=!1)}return f.delete(e),f.delete(t),oe}function lr(e){return cu(Ml(e,r,Ql),e+"")}function tu(e){return el(e,$e,su)}function ru(e){return el(e,ft,zl)}var nu=Ms?function(e){return Ms.get(e)}:_u;function eo(e){for(var t=e.name+"",i=qn[t],u=ve.call(qn,t)?i.length:0;u--;){var c=i[u],f=c.func;if(f==null||f==e)return c.name}return t}function Mn(e){var t=ve.call(l,"placeholder")?l:e;return t.placeholder}function Q(){var e=l.iteratee||wu;return e=e===wu?nl:e,arguments.length?e(arguments[0],arguments[1]):e}function to(e,t){var i=e.__data__;return c_(t)?i[typeof t=="string"?"string":"hash"]:i.map}function iu(e){for(var t=$e(e),i=t.length;i--;){var u=t[i],c=e[u];t[i]=[u,c,Ll(c)]}return t}function an(e,t){var i=pw(e,t);return rl(i)?i:r}function r_(e){var t=ve.call(e,tn),i=e[tn];try{e[tn]=r;var u=!0}catch{}var c=Ns.call(e);return u&&(t?e[tn]=i:delete e[tn]),c}var su=Na?function(e){return e==null?[]:(e=_e(e),Pr(Na(e),function(t){return $h.call(e,t)}))}:Eu,zl=Na?function(e){for(var t=[];e;)Sr(t,su(e)),e=zs(e);return t}:Eu,Je=rt;(Ta&&Je(new Ta(new ArrayBuffer(1)))!=Gt||_i&&Je(new _i)!=ut||ja&&Je(ja.resolve())!=rs||zn&&Je(new zn)!=Dt||Ei&&Je(new Ei)!=Gr)&&(Je=function(e){var t=rt(e),i=t==Ft?e.constructor:r,u=i?un(i):"";if(u)switch(u){case Lw:return Gt;case Uw:return ut;case Mw:return rs;case $w:return Dt;case kw:return Gr}return t});function n_(e,t,i){for(var u=-1,c=i.length;++u<c;){var f=i[u],D=f.size;switch(f.type){case"drop":e+=D;break;case"dropRight":t-=D;break;case"take":t=Ye(t,e+D);break;case"takeRight":e=Le(e,t-D);break}}return{start:e,end:t}}function i_(e){var t=e.match(ir);return t?t[1].split(Zo):[]}function ql(e,t,i){t=Nr(t,e);for(var u=-1,c=t.length,f=!1;++u<c;){var D=Xt(t[u]);if(!(f=e!=null&&i(e,D)))break;e=e[D]}return f||++u!=c?f:(c=e==null?0:e.length,!!c&&uo(c)&&pr(D,c)&&(te(e)||cn(e)))}function s_(e){var t=e.length,i=new e.constructor(t);return t&&typeof e[0]=="string"&&ve.call(e,"index")&&(i.index=e.index,i.input=e.input),i}function Fl(e){return typeof e.constructor=="function"&&!Ni(e)?Fn(zs(e)):{}}function o_(e,t,i){var u=e.constructor;switch(t){case Kt:return Xa(e);case et:case _r:return new u(+e);case Gt:return Bb(e,i);case Dn:case ct:case vn:case yn:case ci:case mn:case Cr:case wn:case bn:return ml(e,i);case ut:return new u;case Vr:case Kr:return new u(e);case Hr:return Vb(e);case Dt:return new u;case gn:return Hb(e)}}function a_(e,t){var i=t.length;if(!i)return e;var u=i-1;return t[u]=(i>1?"& ":"")+t[u],t=t.join(i>2?", ":" "),e.replace(gi,`{
/* [wrapped with `+t+`] */
`)}function u_(e){return te(e)||cn(e)||!!(kh&&e&&e[kh])}function pr(e,t){var i=typeof e;return t=t??Ct,!!t&&(i=="number"||i!="symbol"&&ua.test(e))&&e>-1&&e%1==0&&e<t}function nt(e,t,i){if(!xe(i))return!1;var u=typeof t;return(u=="number"?pt(i)&&pr(t,i.length):u=="string"&&t in i)?kt(i[t],e):!1}function ou(e,t){if(te(e))return!1;var i=typeof e;return i=="number"||i=="symbol"||i=="boolean"||e==null||wt(e)?!0:Yo.test(e)||!Qr.test(e)||t!=null&&e in _e(t)}function c_(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function au(e){var t=eo(e),i=l[t];if(typeof i!="function"||!(t in he.prototype))return!1;if(e===i)return!0;var u=nu(i);return!!u&&e===u[0]}function h_(e){return!!Lh&&Lh in e}var l_=Os?fr:Cu;function Ni(e){var t=e&&e.constructor,i=typeof t=="function"&&t.prototype||jn;return e===i}function Ll(e){return e===e&&!xe(e)}function Ul(e,t){return function(i){return i==null?!1:i[e]===t&&(t!==r||e in _e(i))}}function p_(e){var t=oo(e,function(u){return i.size===v&&i.clear(),u}),i=t.cache;return t}function f_(e,t){var i=e[1],u=t[1],c=i|u,f=c<(k|K|q),D=u==q&&i==H||u==q&&i==F&&e[7].length<=t[8]||u==(q|F)&&t[7].length<=t[8]&&i==H;if(!(f||D))return e;u&k&&(e[2]=t[2],c|=i&k?0:X);var y=t[3];if(y){var _=e[3];e[3]=_?bl(_,y,t[4]):y,e[4]=_?xr(e[3],E):t[4]}return y=t[5],y&&(_=e[5],e[5]=_?_l(_,y,t[6]):y,e[6]=_?xr(e[5],E):t[6]),y=t[7],y&&(e[7]=y),u&q&&(e[8]=e[8]==null?t[8]:Ye(e[8],t[8])),e[9]==null&&(e[9]=t[9]),e[0]=t[0],e[1]=c,e}function d_(e){var t=[];if(e!=null)for(var i in _e(e))t.push(i);return t}function g_(e){return Ns.call(e)}function Ml(e,t,i){return t=Le(t===r?e.length-1:t,0),function(){for(var u=arguments,c=-1,f=Le(u.length-t,0),D=P(f);++c<f;)D[c]=u[t+c];c=-1;for(var y=P(t+1);++c<t;)y[c]=u[c];return y[t]=i(D),Me(e,this,y)}}function $l(e,t){return t.length<2?e:on(e,Rt(t,0,-1))}function D_(e,t){for(var i=e.length,u=Ye(t.length,i),c=lt(e);u--;){var f=t[u];e[u]=pr(f,i)?c[f]:r}return e}function uu(e,t){if(!(t==="constructor"&&typeof e[t]=="function")&&t!="__proto__")return e[t]}var kl=Vl(ll),Ti=Rw||function(e,t){return pe.setTimeout(e,t)},cu=Vl(Ub);function Bl(e,t,i){var u=t+"";return cu(e,a_(u,v_(i_(u),i)))}function Vl(e){var t=0,i=0;return function(){var u=zw(),c=We-(u-i);if(i=u,c>0){if(++t>=qe)return arguments[0]}else t=0;return e.apply(r,arguments)}}function ro(e,t){var i=-1,u=e.length,c=u-1;for(t=t===r?u:t;++i<t;){var f=Ha(i,c),D=e[f];e[f]=e[i],e[i]=D}return e.length=t,e}var Hl=p_(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(Jo,function(i,u,c,f){t.push(c?f.replace(ra,"$1"):u||i)}),t});function Xt(e){if(typeof e=="string"||wt(e))return e;var t=e+"";return t=="0"&&1/e==-qt?"-0":t}function un(e){if(e!=null){try{return Rs.call(e)}catch{}try{return e+""}catch{}}return""}function v_(e,t){return St(dn,function(i){var u="_."+i[0];t&i[1]&&!Ps(e,u)&&e.push(u)}),e.sort()}function Kl(e){if(e instanceof he)return e.clone();var t=new At(e.__wrapped__,e.__chain__);return t.__actions__=lt(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}function y_(e,t,i){(i?nt(e,t,i):t===r)?t=1:t=Le(se(t),0);var u=e==null?0:e.length;if(!u||t<1)return[];for(var c=0,f=0,D=P(Ls(u/t));c<u;)D[f++]=Rt(e,c,c+=t);return D}function m_(e){for(var t=-1,i=e==null?0:e.length,u=0,c=[];++t<i;){var f=e[t];f&&(c[u++]=f)}return c}function w_(){var e=arguments.length;if(!e)return[];for(var t=P(e-1),i=arguments[0],u=e;u--;)t[u-1]=arguments[u];return Sr(te(i)?lt(i):[i],Ke(t,1))}var b_=ae(function(e,t){return Re(e)?Si(e,Ke(t,1,Re,!0)):[]}),__=ae(function(e,t){var i=Nt(t);return Re(i)&&(i=r),Re(e)?Si(e,Ke(t,1,Re,!0),Q(i,2)):[]}),E_=ae(function(e,t){var i=Nt(t);return Re(i)&&(i=r),Re(e)?Si(e,Ke(t,1,Re,!0),r,i):[]});function C_(e,t,i){var u=e==null?0:e.length;return u?(t=i||t===r?1:se(t),Rt(e,t<0?0:t,u)):[]}function I_(e,t,i){var u=e==null?0:e.length;return u?(t=i||t===r?1:se(t),t=u-t,Rt(e,0,t<0?0:t)):[]}function P_(e,t){return e&&e.length?Ws(e,Q(t,3),!0,!0):[]}function S_(e,t){return e&&e.length?Ws(e,Q(t,3),!0):[]}function x_(e,t,i,u){var c=e==null?0:e.length;return c?(i&&typeof i!="number"&&nt(e,t,i)&&(i=0,u=c),wb(e,t,i,u)):[]}function Gl(e,t,i){var u=e==null?0:e.length;if(!u)return-1;var c=i==null?0:se(i);return c<0&&(c=Le(u+c,0)),Ss(e,Q(t,3),c)}function Wl(e,t,i){var u=e==null?0:e.length;if(!u)return-1;var c=u-1;return i!==r&&(c=se(i),c=i<0?Le(u+c,0):Ye(c,u-1)),Ss(e,Q(t,3),c,!0)}function Ql(e){var t=e==null?0:e.length;return t?Ke(e,1):[]}function A_(e){var t=e==null?0:e.length;return t?Ke(e,qt):[]}function O_(e,t){var i=e==null?0:e.length;return i?(t=t===r?1:se(t),Ke(e,t)):[]}function R_(e){for(var t=-1,i=e==null?0:e.length,u={};++t<i;){var c=e[t];u[c[0]]=c[1]}return u}function Yl(e){return e&&e.length?e[0]:r}function N_(e,t,i){var u=e==null?0:e.length;if(!u)return-1;var c=i==null?0:se(i);return c<0&&(c=Le(u+c,0)),On(e,t,c)}function T_(e){var t=e==null?0:e.length;return t?Rt(e,0,-1):[]}var j_=ae(function(e){var t=Se(e,Ya);return t.length&&t[0]===e[0]?Ma(t):[]}),z_=ae(function(e){var t=Nt(e),i=Se(e,Ya);return t===Nt(i)?t=r:i.pop(),i.length&&i[0]===e[0]?Ma(i,Q(t,2)):[]}),q_=ae(function(e){var t=Nt(e),i=Se(e,Ya);return t=typeof t=="function"?t:r,t&&i.pop(),i.length&&i[0]===e[0]?Ma(i,r,t):[]});function F_(e,t){return e==null?"":Tw.call(e,t)}function Nt(e){var t=e==null?0:e.length;return t?e[t-1]:r}function L_(e,t,i){var u=e==null?0:e.length;if(!u)return-1;var c=u;return i!==r&&(c=se(i),c=c<0?Le(u+c,0):Ye(c,u-1)),t===t?vw(e,t,c):Ss(e,Oh,c,!0)}function U_(e,t){return e&&e.length?al(e,se(t)):r}var M_=ae(Jl);function Jl(e,t){return e&&e.length&&t&&t.length?Va(e,t):e}function $_(e,t,i){return e&&e.length&&t&&t.length?Va(e,t,Q(i,2)):e}function k_(e,t,i){return e&&e.length&&t&&t.length?Va(e,t,r,i):e}var B_=lr(function(e,t){var i=e==null?0:e.length,u=qa(e,t);return hl(e,Se(t,function(c){return pr(c,i)?+c:c}).sort(wl)),u});function V_(e,t){var i=[];if(!(e&&e.length))return i;var u=-1,c=[],f=e.length;for(t=Q(t,3);++u<f;){var D=e[u];t(D,u,e)&&(i.push(D),c.push(u))}return hl(e,c),i}function hu(e){return e==null?e:Fw.call(e)}function H_(e,t,i){var u=e==null?0:e.length;return u?(i&&typeof i!="number"&&nt(e,t,i)?(t=0,i=u):(t=t==null?0:se(t),i=i===r?u:se(i)),Rt(e,t,i)):[]}function K_(e,t){return Gs(e,t)}function G_(e,t,i){return Ga(e,t,Q(i,2))}function W_(e,t){var i=e==null?0:e.length;if(i){var u=Gs(e,t);if(u<i&&kt(e[u],t))return u}return-1}function Q_(e,t){return Gs(e,t,!0)}function Y_(e,t,i){return Ga(e,t,Q(i,2),!0)}function J_(e,t){var i=e==null?0:e.length;if(i){var u=Gs(e,t,!0)-1;if(kt(e[u],t))return u}return-1}function X_(e){return e&&e.length?pl(e):[]}function Z_(e,t){return e&&e.length?pl(e,Q(t,2)):[]}function e0(e){var t=e==null?0:e.length;return t?Rt(e,1,t):[]}function t0(e,t,i){return e&&e.length?(t=i||t===r?1:se(t),Rt(e,0,t<0?0:t)):[]}function r0(e,t,i){var u=e==null?0:e.length;return u?(t=i||t===r?1:se(t),t=u-t,Rt(e,t<0?0:t,u)):[]}function n0(e,t){return e&&e.length?Ws(e,Q(t,3),!1,!0):[]}function i0(e,t){return e&&e.length?Ws(e,Q(t,3)):[]}var s0=ae(function(e){return Rr(Ke(e,1,Re,!0))}),o0=ae(function(e){var t=Nt(e);return Re(t)&&(t=r),Rr(Ke(e,1,Re,!0),Q(t,2))}),a0=ae(function(e){var t=Nt(e);return t=typeof t=="function"?t:r,Rr(Ke(e,1,Re,!0),r,t)});function u0(e){return e&&e.length?Rr(e):[]}function c0(e,t){return e&&e.length?Rr(e,Q(t,2)):[]}function h0(e,t){return t=typeof t=="function"?t:r,e&&e.length?Rr(e,r,t):[]}function lu(e){if(!(e&&e.length))return[];var t=0;return e=Pr(e,function(i){if(Re(i))return t=Le(i.length,t),!0}),xa(t,function(i){return Se(e,Ia(i))})}function Xl(e,t){if(!(e&&e.length))return[];var i=lu(e);return t==null?i:Se(i,function(u){return Me(t,r,u)})}var l0=ae(function(e,t){return Re(e)?Si(e,t):[]}),p0=ae(function(e){return Qa(Pr(e,Re))}),f0=ae(function(e){var t=Nt(e);return Re(t)&&(t=r),Qa(Pr(e,Re),Q(t,2))}),d0=ae(function(e){var t=Nt(e);return t=typeof t=="function"?t:r,Qa(Pr(e,Re),r,t)}),g0=ae(lu);function D0(e,t){return Dl(e||[],t||[],Pi)}function v0(e,t){return Dl(e||[],t||[],Oi)}var y0=ae(function(e){var t=e.length,i=t>1?e[t-1]:r;return i=typeof i=="function"?(e.pop(),i):r,Xl(e,i)});function Zl(e){var t=l(e);return t.__chain__=!0,t}function m0(e,t){return t(e),e}function no(e,t){return t(e)}var w0=lr(function(e){var t=e.length,i=t?e[0]:0,u=this.__wrapped__,c=function(f){return qa(f,e)};return t>1||this.__actions__.length||!(u instanceof he)||!pr(i)?this.thru(c):(u=u.slice(i,+i+(t?1:0)),u.__actions__.push({func:no,args:[c],thisArg:r}),new At(u,this.__chain__).thru(function(f){return t&&!f.length&&f.push(r),f}))});function b0(){return Zl(this)}function _0(){return new At(this.value(),this.__chain__)}function E0(){this.__values__===r&&(this.__values__=fp(this.value()));var e=this.__index__>=this.__values__.length,t=e?r:this.__values__[this.__index__++];return{done:e,value:t}}function C0(){return this}function I0(e){for(var t,i=this;i instanceof ks;){var u=Kl(i);u.__index__=0,u.__values__=r,t?c.__wrapped__=u:t=u;var c=u;i=i.__wrapped__}return c.__wrapped__=e,t}function P0(){var e=this.__wrapped__;if(e instanceof he){var t=e;return this.__actions__.length&&(t=new he(this)),t=t.reverse(),t.__actions__.push({func:no,args:[hu],thisArg:r}),new At(t,this.__chain__)}return this.thru(hu)}function S0(){return gl(this.__wrapped__,this.__actions__)}var x0=Qs(function(e,t,i){ve.call(e,i)?++e[i]:cr(e,i,1)});function A0(e,t,i){var u=te(e)?xh:mb;return i&&nt(e,t,i)&&(t=r),u(e,Q(t,3))}function O0(e,t){var i=te(e)?Pr:Xh;return i(e,Q(t,3))}var R0=Pl(Gl),N0=Pl(Wl);function T0(e,t){return Ke(io(e,t),1)}function j0(e,t){return Ke(io(e,t),qt)}function z0(e,t,i){return i=i===r?1:se(i),Ke(io(e,t),i)}function ep(e,t){var i=te(e)?St:Or;return i(e,Q(t,3))}function tp(e,t){var i=te(e)?ew:Jh;return i(e,Q(t,3))}var q0=Qs(function(e,t,i){ve.call(e,i)?e[i].push(t):cr(e,i,[t])});function F0(e,t,i,u){e=pt(e)?e:kn(e),i=i&&!u?se(i):0;var c=e.length;return i<0&&(i=Le(c+i,0)),co(e)?i<=c&&e.indexOf(t,i)>-1:!!c&&On(e,t,i)>-1}var L0=ae(function(e,t,i){var u=-1,c=typeof t=="function",f=pt(e)?P(e.length):[];return Or(e,function(D){f[++u]=c?Me(t,D,i):xi(D,t,i)}),f}),U0=Qs(function(e,t,i){cr(e,i,t)});function io(e,t){var i=te(e)?Se:il;return i(e,Q(t,3))}function M0(e,t,i,u){return e==null?[]:(te(t)||(t=t==null?[]:[t]),i=u?r:i,te(i)||(i=i==null?[]:[i]),ul(e,t,i))}var $0=Qs(function(e,t,i){e[i?0:1].push(t)},function(){return[[],[]]});function k0(e,t,i){var u=te(e)?Ea:Nh,c=arguments.length<3;return u(e,Q(t,4),i,c,Or)}function B0(e,t,i){var u=te(e)?tw:Nh,c=arguments.length<3;return u(e,Q(t,4),i,c,Jh)}function V0(e,t){var i=te(e)?Pr:Xh;return i(e,ao(Q(t,3)))}function H0(e){var t=te(e)?Gh:Fb;return t(e)}function K0(e,t,i){(i?nt(e,t,i):t===r)?t=1:t=se(t);var u=te(e)?db:Lb;return u(e,t)}function G0(e){var t=te(e)?gb:Mb;return t(e)}function W0(e){if(e==null)return 0;if(pt(e))return co(e)?Nn(e):e.length;var t=Je(e);return t==ut||t==Dt?e.size:ka(e).length}function Q0(e,t,i){var u=te(e)?Ca:$b;return i&&nt(e,t,i)&&(t=r),u(e,Q(t,3))}var Y0=ae(function(e,t){if(e==null)return[];var i=t.length;return i>1&&nt(e,t[0],t[1])?t=[]:i>2&&nt(t[0],t[1],t[2])&&(t=[t[0]]),ul(e,Ke(t,1),[])}),so=Ow||function(){return pe.Date.now()};function J0(e,t){if(typeof t!="function")throw new xt(p);return e=se(e),function(){if(--e<1)return t.apply(this,arguments)}}function rp(e,t,i){return t=i?r:t,t=e&&t==null?e.length:t,hr(e,q,r,r,r,r,t)}function np(e,t){var i;if(typeof t!="function")throw new xt(p);return e=se(e),function(){return--e>0&&(i=t.apply(this,arguments)),e<=1&&(t=r),i}}var pu=ae(function(e,t,i){var u=k;if(i.length){var c=xr(i,Mn(pu));u|=W}return hr(e,u,t,i,c)}),ip=ae(function(e,t,i){var u=k|K;if(i.length){var c=xr(i,Mn(ip));u|=W}return hr(t,u,e,i,c)});function sp(e,t,i){t=i?r:t;var u=hr(e,H,r,r,r,r,r,t);return u.placeholder=sp.placeholder,u}function op(e,t,i){t=i?r:t;var u=hr(e,B,r,r,r,r,r,t);return u.placeholder=op.placeholder,u}function ap(e,t,i){var u,c,f,D,y,_,O=0,R=!1,j=!1,L=!0;if(typeof e!="function")throw new xt(p);t=Tt(t)||0,xe(i)&&(R=!!i.leading,j="maxWait"in i,f=j?Le(Tt(i.maxWait)||0,t):f,L="trailing"in i?!!i.trailing:L);function V(Ne){var Bt=u,gr=c;return u=c=r,O=Ne,D=e.apply(gr,Bt),D}function Y(Ne){return O=Ne,y=Ti(ue,t),R?V(Ne):D}function oe(Ne){var Bt=Ne-_,gr=Ne-O,Pp=t-Bt;return j?Ye(Pp,f-gr):Pp}function J(Ne){var Bt=Ne-_,gr=Ne-O;return _===r||Bt>=t||Bt<0||j&&gr>=f}function ue(){var Ne=so();if(J(Ne))return fe(Ne);y=Ti(ue,oe(Ne))}function fe(Ne){return y=r,L&&u?V(Ne):(u=c=r,D)}function bt(){y!==r&&vl(y),O=0,u=_=c=y=r}function it(){return y===r?D:fe(so())}function _t(){var Ne=so(),Bt=J(Ne);if(u=arguments,c=this,_=Ne,Bt){if(y===r)return Y(_);if(j)return vl(y),y=Ti(ue,t),V(_)}return y===r&&(y=Ti(ue,t)),D}return _t.cancel=bt,_t.flush=it,_t}var X0=ae(function(e,t){return Yh(e,1,t)}),Z0=ae(function(e,t,i){return Yh(e,Tt(t)||0,i)});function eE(e){return hr(e,ie)}function oo(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new xt(p);var i=function(){var u=arguments,c=t?t.apply(this,u):u[0],f=i.cache;if(f.has(c))return f.get(c);var D=e.apply(this,u);return i.cache=f.set(c,D)||f,D};return i.cache=new(oo.Cache||ur),i}oo.Cache=ur;function ao(e){if(typeof e!="function")throw new xt(p);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function tE(e){return np(2,e)}var rE=kb(function(e,t){t=t.length==1&&te(t[0])?Se(t[0],yt(Q())):Se(Ke(t,1),yt(Q()));var i=t.length;return ae(function(u){for(var c=-1,f=Ye(u.length,i);++c<f;)u[c]=t[c].call(this,u[c]);return Me(e,this,u)})}),fu=ae(function(e,t){var i=xr(t,Mn(fu));return hr(e,W,r,t,i)}),up=ae(function(e,t){var i=xr(t,Mn(up));return hr(e,x,r,t,i)}),nE=lr(function(e,t){return hr(e,F,r,r,r,t)});function iE(e,t){if(typeof e!="function")throw new xt(p);return t=t===r?t:se(t),ae(e,t)}function sE(e,t){if(typeof e!="function")throw new xt(p);return t=t==null?0:Le(se(t),0),ae(function(i){var u=i[t],c=Tr(i,0,t);return u&&Sr(c,u),Me(e,this,c)})}function oE(e,t,i){var u=!0,c=!0;if(typeof e!="function")throw new xt(p);return xe(i)&&(u="leading"in i?!!i.leading:u,c="trailing"in i?!!i.trailing:c),ap(e,t,{leading:u,maxWait:t,trailing:c})}function aE(e){return rp(e,1)}function uE(e,t){return fu(Ja(t),e)}function cE(){if(!arguments.length)return[];var e=arguments[0];return te(e)?e:[e]}function hE(e){return Ot(e,z)}function lE(e,t){return t=typeof t=="function"?t:r,Ot(e,z,t)}function pE(e){return Ot(e,C|z)}function fE(e,t){return t=typeof t=="function"?t:r,Ot(e,C|z,t)}function dE(e,t){return t==null||Qh(e,t,$e(t))}function kt(e,t){return e===t||e!==e&&t!==t}var gE=Zs(Ua),DE=Zs(function(e,t){return e>=t}),cn=tl(function(){return arguments}())?tl:function(e){return Ae(e)&&ve.call(e,"callee")&&!$h.call(e,"callee")},te=P.isArray,vE=tt?yt(tt):Ib;function pt(e){return e!=null&&uo(e.length)&&!fr(e)}function Re(e){return Ae(e)&&pt(e)}function yE(e){return e===!0||e===!1||Ae(e)&&rt(e)==et}var jr=Nw||Cu,mE=Ut?yt(Ut):Pb;function wE(e){return Ae(e)&&e.nodeType===1&&!ji(e)}function bE(e){if(e==null)return!0;if(pt(e)&&(te(e)||typeof e=="string"||typeof e.splice=="function"||jr(e)||$n(e)||cn(e)))return!e.length;var t=Je(e);if(t==ut||t==Dt)return!e.size;if(Ni(e))return!ka(e).length;for(var i in e)if(ve.call(e,i))return!1;return!0}function _E(e,t){return Ai(e,t)}function EE(e,t,i){i=typeof i=="function"?i:r;var u=i?i(e,t):r;return u===r?Ai(e,t,r,i):!!u}function du(e){if(!Ae(e))return!1;var t=rt(e);return t==Br||t==ts||typeof e.message=="string"&&typeof e.name=="string"&&!ji(e)}function CE(e){return typeof e=="number"&&Bh(e)}function fr(e){if(!xe(e))return!1;var t=rt(e);return t==Er||t==ui||t==Vo||t==Ko}function cp(e){return typeof e=="number"&&e==se(e)}function uo(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=Ct}function xe(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}function Ae(e){return e!=null&&typeof e=="object"}var hp=Pt?yt(Pt):xb;function IE(e,t){return e===t||$a(e,t,iu(t))}function PE(e,t,i){return i=typeof i=="function"?i:r,$a(e,t,iu(t),i)}function SE(e){return lp(e)&&e!=+e}function xE(e){if(l_(e))throw new ee(h);return rl(e)}function AE(e){return e===null}function OE(e){return e==null}function lp(e){return typeof e=="number"||Ae(e)&&rt(e)==Vr}function ji(e){if(!Ae(e)||rt(e)!=Ft)return!1;var t=zs(e);if(t===null)return!0;var i=ve.call(t,"constructor")&&t.constructor;return typeof i=="function"&&i instanceof i&&Rs.call(i)==Pw}var gu=Qt?yt(Qt):Ab;function RE(e){return cp(e)&&e>=-Ct&&e<=Ct}var pp=mi?yt(mi):Ob;function co(e){return typeof e=="string"||!te(e)&&Ae(e)&&rt(e)==Kr}function wt(e){return typeof e=="symbol"||Ae(e)&&rt(e)==gn}var $n=en?yt(en):Rb;function NE(e){return e===r}function TE(e){return Ae(e)&&Je(e)==Gr}function jE(e){return Ae(e)&&rt(e)==Wo}var zE=Zs(Ba),qE=Zs(function(e,t){return e<=t});function fp(e){if(!e)return[];if(pt(e))return co(e)?Mt(e):lt(e);if(bi&&e[bi])return dw(e[bi]());var t=Je(e),i=t==ut?Oa:t==Dt?xs:kn;return i(e)}function dr(e){if(!e)return e===0?e:0;if(e=Tt(e),e===qt||e===-qt){var t=e<0?-1:1;return t*ai}return e===e?e:0}function se(e){var t=dr(e),i=t%1;return t===t?i?t-i:t:0}function dp(e){return e?sn(se(e),0,He):0}function Tt(e){if(typeof e=="number")return e;if(wt(e))return Pe;if(xe(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=xe(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=Th(e);var i=sa.test(e);return i||aa.test(e)?ne(e.slice(2),i?2:8):ia.test(e)?Pe:+e}function gp(e){return Jt(e,ft(e))}function FE(e){return e?sn(se(e),-Ct,Ct):e===0?e:0}function De(e){return e==null?"":mt(e)}var LE=Ln(function(e,t){if(Ni(t)||pt(t)){Jt(t,$e(t),e);return}for(var i in t)ve.call(t,i)&&Pi(e,i,t[i])}),Dp=Ln(function(e,t){Jt(t,ft(t),e)}),ho=Ln(function(e,t,i,u){Jt(t,ft(t),e,u)}),UE=Ln(function(e,t,i,u){Jt(t,$e(t),e,u)}),ME=lr(qa);function $E(e,t){var i=Fn(e);return t==null?i:Wh(i,t)}var kE=ae(function(e,t){e=_e(e);var i=-1,u=t.length,c=u>2?t[2]:r;for(c&&nt(t[0],t[1],c)&&(u=1);++i<u;)for(var f=t[i],D=ft(f),y=-1,_=D.length;++y<_;){var O=D[y],R=e[O];(R===r||kt(R,jn[O])&&!ve.call(e,O))&&(e[O]=f[O])}return e}),BE=ae(function(e){return e.push(r,Tl),Me(vp,r,e)});function VE(e,t){return Ah(e,Q(t,3),Yt)}function HE(e,t){return Ah(e,Q(t,3),La)}function KE(e,t){return e==null?e:Fa(e,Q(t,3),ft)}function GE(e,t){return e==null?e:Zh(e,Q(t,3),ft)}function WE(e,t){return e&&Yt(e,Q(t,3))}function QE(e,t){return e&&La(e,Q(t,3))}function YE(e){return e==null?[]:Hs(e,$e(e))}function JE(e){return e==null?[]:Hs(e,ft(e))}function Du(e,t,i){var u=e==null?r:on(e,t);return u===r?i:u}function XE(e,t){return e!=null&&ql(e,t,bb)}function vu(e,t){return e!=null&&ql(e,t,_b)}var ZE=xl(function(e,t,i){t!=null&&typeof t.toString!="function"&&(t=Ns.call(t)),e[t]=i},mu(dt)),e3=xl(function(e,t,i){t!=null&&typeof t.toString!="function"&&(t=Ns.call(t)),ve.call(e,t)?e[t].push(i):e[t]=[i]},Q),t3=ae(xi);function $e(e){return pt(e)?Kh(e):ka(e)}function ft(e){return pt(e)?Kh(e,!0):Nb(e)}function r3(e,t){var i={};return t=Q(t,3),Yt(e,function(u,c,f){cr(i,t(u,c,f),u)}),i}function n3(e,t){var i={};return t=Q(t,3),Yt(e,function(u,c,f){cr(i,c,t(u,c,f))}),i}var i3=Ln(function(e,t,i){Ks(e,t,i)}),vp=Ln(function(e,t,i,u){Ks(e,t,i,u)}),s3=lr(function(e,t){var i={};if(e==null)return i;var u=!1;t=Se(t,function(f){return f=Nr(f,e),u||(u=f.length>1),f}),Jt(e,ru(e),i),u&&(i=Ot(i,C|S|z,Zb));for(var c=t.length;c--;)Wa(i,t[c]);return i});function o3(e,t){return yp(e,ao(Q(t)))}var a3=lr(function(e,t){return e==null?{}:jb(e,t)});function yp(e,t){if(e==null)return{};var i=Se(ru(e),function(u){return[u]});return t=Q(t),cl(e,i,function(u,c){return t(u,c[0])})}function u3(e,t,i){t=Nr(t,e);var u=-1,c=t.length;for(c||(c=1,e=r);++u<c;){var f=e==null?r:e[Xt(t[u])];f===r&&(u=c,f=i),e=fr(f)?f.call(e):f}return e}function c3(e,t,i){return e==null?e:Oi(e,t,i)}function h3(e,t,i,u){return u=typeof u=="function"?u:r,e==null?e:Oi(e,t,i,u)}var mp=Rl($e),wp=Rl(ft);function l3(e,t,i){var u=te(e),c=u||jr(e)||$n(e);if(t=Q(t,4),i==null){var f=e&&e.constructor;c?i=u?new f:[]:xe(e)?i=fr(f)?Fn(zs(e)):{}:i={}}return(c?St:Yt)(e,function(D,y,_){return t(i,D,y,_)}),i}function p3(e,t){return e==null?!0:Wa(e,t)}function f3(e,t,i){return e==null?e:dl(e,t,Ja(i))}function d3(e,t,i,u){return u=typeof u=="function"?u:r,e==null?e:dl(e,t,Ja(i),u)}function kn(e){return e==null?[]:Aa(e,$e(e))}function g3(e){return e==null?[]:Aa(e,ft(e))}function D3(e,t,i){return i===r&&(i=t,t=r),i!==r&&(i=Tt(i),i=i===i?i:0),t!==r&&(t=Tt(t),t=t===t?t:0),sn(Tt(e),t,i)}function v3(e,t,i){return t=dr(t),i===r?(i=t,t=0):i=dr(i),e=Tt(e),Eb(e,t,i)}function y3(e,t,i){if(i&&typeof i!="boolean"&&nt(e,t,i)&&(t=i=r),i===r&&(typeof t=="boolean"?(i=t,t=r):typeof e=="boolean"&&(i=e,e=r)),e===r&&t===r?(e=0,t=1):(e=dr(e),t===r?(t=e,e=0):t=dr(t)),e>t){var u=e;e=t,t=u}if(i||e%1||t%1){var c=Vh();return Ye(e+c*(t-e+we("1e-"+((c+"").length-1))),t)}return Ha(e,t)}var m3=Un(function(e,t,i){return t=t.toLowerCase(),e+(i?bp(t):t)});function bp(e){return yu(De(e).toLowerCase())}function _p(e){return e=De(e),e&&e.replace(sr,cw).replace(wa,"")}function w3(e,t,i){e=De(e),t=mt(t);var u=e.length;i=i===r?u:sn(se(i),0,u);var c=i;return i-=t.length,i>=0&&e.slice(i,c)==t}function b3(e){return e=De(e),e&&Wr.test(e)?e.replace(ss,hw):e}function _3(e){return e=De(e),e&&Xo.test(e)?e.replace(fi,"\\$&"):e}var E3=Un(function(e,t,i){return e+(i?"-":"")+t.toLowerCase()}),C3=Un(function(e,t,i){return e+(i?" ":"")+t.toLowerCase()}),I3=Il("toLowerCase");function P3(e,t,i){e=De(e),t=se(t);var u=t?Nn(e):0;if(!t||u>=t)return e;var c=(t-u)/2;return Xs(Us(c),i)+e+Xs(Ls(c),i)}function S3(e,t,i){e=De(e),t=se(t);var u=t?Nn(e):0;return t&&u<t?e+Xs(t-u,i):e}function x3(e,t,i){e=De(e),t=se(t);var u=t?Nn(e):0;return t&&u<t?Xs(t-u,i)+e:e}function A3(e,t,i){return i||t==null?t=0:t&&(t=+t),qw(De(e).replace(di,""),t||0)}function O3(e,t,i){return(i?nt(e,t,i):t===r)?t=1:t=se(t),Ka(De(e),t)}function R3(){var e=arguments,t=De(e[0]);return e.length<3?t:t.replace(e[1],e[2])}var N3=Un(function(e,t,i){return e+(i?"_":"")+t.toLowerCase()});function T3(e,t,i){return i&&typeof i!="number"&&nt(e,t,i)&&(t=i=r),i=i===r?He:i>>>0,i?(e=De(e),e&&(typeof t=="string"||t!=null&&!gu(t))&&(t=mt(t),!t&&Rn(e))?Tr(Mt(e),0,i):e.split(t,i)):[]}var j3=Un(function(e,t,i){return e+(i?" ":"")+yu(t)});function z3(e,t,i){return e=De(e),i=i==null?0:sn(se(i),0,e.length),t=mt(t),e.slice(i,i+t.length)==t}function q3(e,t,i){var u=l.templateSettings;i&&nt(e,t,i)&&(t=r),e=De(e),t=ho({},t,u,Nl);var c=ho({},t.imports,u.imports,Nl),f=$e(c),D=Aa(c,f),y,_,O=0,R=t.interpolate||En,j="__p += '",L=Ra((t.escape||En).source+"|"+R.source+"|"+(R===_n?na:En).source+"|"+(t.evaluate||En).source+"|$","g"),V="//# sourceURL="+(ve.call(t,"sourceURL")?(t.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++ba+"]")+`
`;e.replace(L,function(J,ue,fe,bt,it,_t){return fe||(fe=bt),j+=e.slice(O,_t).replace(ca,lw),ue&&(y=!0,j+=`' +
__e(`+ue+`) +
'`),it&&(_=!0,j+=`';
`+it+`;
__p += '`),fe&&(j+=`' +
((__t = (`+fe+`)) == null ? '' : __t) +
'`),O=_t+J.length,J}),j+=`';
`;var Y=ve.call(t,"variable")&&t.variable;if(!Y)j=`with (obj) {
`+j+`
}
`;else if(ta.test(Y))throw new ee(d);j=(_?j.replace(Qo,""):j).replace(nr,"$1").replace(ns,"$1;"),j="function("+(Y||"obj")+`) {
`+(Y?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(y?", __e = _.escape":"")+(_?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+j+`return __p
}`;var oe=Cp(function(){return ge(f,V+"return "+j).apply(r,D)});if(oe.source=j,du(oe))throw oe;return oe}function F3(e){return De(e).toLowerCase()}function L3(e){return De(e).toUpperCase()}function U3(e,t,i){if(e=De(e),e&&(i||t===r))return Th(e);if(!e||!(t=mt(t)))return e;var u=Mt(e),c=Mt(t),f=jh(u,c),D=zh(u,c)+1;return Tr(u,f,D).join("")}function M3(e,t,i){if(e=De(e),e&&(i||t===r))return e.slice(0,Fh(e)+1);if(!e||!(t=mt(t)))return e;var u=Mt(e),c=zh(u,Mt(t))+1;return Tr(u,0,c).join("")}function $3(e,t,i){if(e=De(e),e&&(i||t===r))return e.replace(di,"");if(!e||!(t=mt(t)))return e;var u=Mt(e),c=jh(u,Mt(t));return Tr(u,c).join("")}function k3(e,t){var i=re,u=de;if(xe(t)){var c="separator"in t?t.separator:c;i="length"in t?se(t.length):i,u="omission"in t?mt(t.omission):u}e=De(e);var f=e.length;if(Rn(e)){var D=Mt(e);f=D.length}if(i>=f)return e;var y=i-Nn(u);if(y<1)return u;var _=D?Tr(D,0,y).join(""):e.slice(0,y);if(c===r)return _+u;if(D&&(y+=_.length-y),gu(c)){if(e.slice(y).search(c)){var O,R=_;for(c.global||(c=Ra(c.source,De(It.exec(c))+"g")),c.lastIndex=0;O=c.exec(R);)var j=O.index;_=_.slice(0,j===r?y:j)}}else if(e.indexOf(mt(c),y)!=y){var L=_.lastIndexOf(c);L>-1&&(_=_.slice(0,L))}return _+u}function B3(e){return e=De(e),e&&hi.test(e)?e.replace(is,yw):e}var V3=Un(function(e,t,i){return e+(i?" ":"")+t.toUpperCase()}),yu=Il("toUpperCase");function Ep(e,t,i){return e=De(e),t=i?r:t,t===r?fw(e)?bw(e):iw(e):e.match(t)||[]}var Cp=ae(function(e,t){try{return Me(e,r,t)}catch(i){return du(i)?i:new ee(i)}}),H3=lr(function(e,t){return St(t,function(i){i=Xt(i),cr(e,i,pu(e[i],e))}),e});function K3(e){var t=e==null?0:e.length,i=Q();return e=t?Se(e,function(u){if(typeof u[1]!="function")throw new xt(p);return[i(u[0]),u[1]]}):[],ae(function(u){for(var c=-1;++c<t;){var f=e[c];if(Me(f[0],this,u))return Me(f[1],this,u)}})}function G3(e){return yb(Ot(e,C))}function mu(e){return function(){return e}}function W3(e,t){return e==null||e!==e?t:e}var Q3=Sl(),Y3=Sl(!0);function dt(e){return e}function wu(e){return nl(typeof e=="function"?e:Ot(e,C))}function J3(e){return sl(Ot(e,C))}function X3(e,t){return ol(e,Ot(t,C))}var Z3=ae(function(e,t){return function(i){return xi(i,e,t)}}),e1=ae(function(e,t){return function(i){return xi(e,i,t)}});function bu(e,t,i){var u=$e(t),c=Hs(t,u);i==null&&!(xe(t)&&(c.length||!u.length))&&(i=t,t=e,e=this,c=Hs(t,$e(t)));var f=!(xe(i)&&"chain"in i)||!!i.chain,D=fr(e);return St(c,function(y){var _=t[y];e[y]=_,D&&(e.prototype[y]=function(){var O=this.__chain__;if(f||O){var R=e(this.__wrapped__),j=R.__actions__=lt(this.__actions__);return j.push({func:_,args:arguments,thisArg:e}),R.__chain__=O,R}return _.apply(e,Sr([this.value()],arguments))})}),e}function t1(){return pe._===this&&(pe._=Sw),this}function _u(){}function r1(e){return e=se(e),ae(function(t){return al(t,e)})}var n1=Za(Se),i1=Za(xh),s1=Za(Ca);function Ip(e){return ou(e)?Ia(Xt(e)):zb(e)}function o1(e){return function(t){return e==null?r:on(e,t)}}var a1=Al(),u1=Al(!0);function Eu(){return[]}function Cu(){return!1}function c1(){return{}}function h1(){return""}function l1(){return!0}function p1(e,t){if(e=se(e),e<1||e>Ct)return[];var i=He,u=Ye(e,He);t=Q(t),e-=He;for(var c=xa(u,t);++i<e;)t(i);return c}function f1(e){return te(e)?Se(e,Xt):wt(e)?[e]:lt(Hl(De(e)))}function d1(e){var t=++Iw;return De(e)+t}var g1=Js(function(e,t){return e+t},0),D1=eu("ceil"),v1=Js(function(e,t){return e/t},1),y1=eu("floor");function m1(e){return e&&e.length?Vs(e,dt,Ua):r}function w1(e,t){return e&&e.length?Vs(e,Q(t,2),Ua):r}function b1(e){return Rh(e,dt)}function _1(e,t){return Rh(e,Q(t,2))}function E1(e){return e&&e.length?Vs(e,dt,Ba):r}function C1(e,t){return e&&e.length?Vs(e,Q(t,2),Ba):r}var I1=Js(function(e,t){return e*t},1),P1=eu("round"),S1=Js(function(e,t){return e-t},0);function x1(e){return e&&e.length?Sa(e,dt):0}function A1(e,t){return e&&e.length?Sa(e,Q(t,2)):0}return l.after=J0,l.ary=rp,l.assign=LE,l.assignIn=Dp,l.assignInWith=ho,l.assignWith=UE,l.at=ME,l.before=np,l.bind=pu,l.bindAll=H3,l.bindKey=ip,l.castArray=cE,l.chain=Zl,l.chunk=y_,l.compact=m_,l.concat=w_,l.cond=K3,l.conforms=G3,l.constant=mu,l.countBy=x0,l.create=$E,l.curry=sp,l.curryRight=op,l.debounce=ap,l.defaults=kE,l.defaultsDeep=BE,l.defer=X0,l.delay=Z0,l.difference=b_,l.differenceBy=__,l.differenceWith=E_,l.drop=C_,l.dropRight=I_,l.dropRightWhile=P_,l.dropWhile=S_,l.fill=x_,l.filter=O0,l.flatMap=T0,l.flatMapDeep=j0,l.flatMapDepth=z0,l.flatten=Ql,l.flattenDeep=A_,l.flattenDepth=O_,l.flip=eE,l.flow=Q3,l.flowRight=Y3,l.fromPairs=R_,l.functions=YE,l.functionsIn=JE,l.groupBy=q0,l.initial=T_,l.intersection=j_,l.intersectionBy=z_,l.intersectionWith=q_,l.invert=ZE,l.invertBy=e3,l.invokeMap=L0,l.iteratee=wu,l.keyBy=U0,l.keys=$e,l.keysIn=ft,l.map=io,l.mapKeys=r3,l.mapValues=n3,l.matches=J3,l.matchesProperty=X3,l.memoize=oo,l.merge=i3,l.mergeWith=vp,l.method=Z3,l.methodOf=e1,l.mixin=bu,l.negate=ao,l.nthArg=r1,l.omit=s3,l.omitBy=o3,l.once=tE,l.orderBy=M0,l.over=n1,l.overArgs=rE,l.overEvery=i1,l.overSome=s1,l.partial=fu,l.partialRight=up,l.partition=$0,l.pick=a3,l.pickBy=yp,l.property=Ip,l.propertyOf=o1,l.pull=M_,l.pullAll=Jl,l.pullAllBy=$_,l.pullAllWith=k_,l.pullAt=B_,l.range=a1,l.rangeRight=u1,l.rearg=nE,l.reject=V0,l.remove=V_,l.rest=iE,l.reverse=hu,l.sampleSize=K0,l.set=c3,l.setWith=h3,l.shuffle=G0,l.slice=H_,l.sortBy=Y0,l.sortedUniq=X_,l.sortedUniqBy=Z_,l.split=T3,l.spread=sE,l.tail=e0,l.take=t0,l.takeRight=r0,l.takeRightWhile=n0,l.takeWhile=i0,l.tap=m0,l.throttle=oE,l.thru=no,l.toArray=fp,l.toPairs=mp,l.toPairsIn=wp,l.toPath=f1,l.toPlainObject=gp,l.transform=l3,l.unary=aE,l.union=s0,l.unionBy=o0,l.unionWith=a0,l.uniq=u0,l.uniqBy=c0,l.uniqWith=h0,l.unset=p3,l.unzip=lu,l.unzipWith=Xl,l.update=f3,l.updateWith=d3,l.values=kn,l.valuesIn=g3,l.without=l0,l.words=Ep,l.wrap=uE,l.xor=p0,l.xorBy=f0,l.xorWith=d0,l.zip=g0,l.zipObject=D0,l.zipObjectDeep=v0,l.zipWith=y0,l.entries=mp,l.entriesIn=wp,l.extend=Dp,l.extendWith=ho,bu(l,l),l.add=g1,l.attempt=Cp,l.camelCase=m3,l.capitalize=bp,l.ceil=D1,l.clamp=D3,l.clone=hE,l.cloneDeep=pE,l.cloneDeepWith=fE,l.cloneWith=lE,l.conformsTo=dE,l.deburr=_p,l.defaultTo=W3,l.divide=v1,l.endsWith=w3,l.eq=kt,l.escape=b3,l.escapeRegExp=_3,l.every=A0,l.find=R0,l.findIndex=Gl,l.findKey=VE,l.findLast=N0,l.findLastIndex=Wl,l.findLastKey=HE,l.floor=y1,l.forEach=ep,l.forEachRight=tp,l.forIn=KE,l.forInRight=GE,l.forOwn=WE,l.forOwnRight=QE,l.get=Du,l.gt=gE,l.gte=DE,l.has=XE,l.hasIn=vu,l.head=Yl,l.identity=dt,l.includes=F0,l.indexOf=N_,l.inRange=v3,l.invoke=t3,l.isArguments=cn,l.isArray=te,l.isArrayBuffer=vE,l.isArrayLike=pt,l.isArrayLikeObject=Re,l.isBoolean=yE,l.isBuffer=jr,l.isDate=mE,l.isElement=wE,l.isEmpty=bE,l.isEqual=_E,l.isEqualWith=EE,l.isError=du,l.isFinite=CE,l.isFunction=fr,l.isInteger=cp,l.isLength=uo,l.isMap=hp,l.isMatch=IE,l.isMatchWith=PE,l.isNaN=SE,l.isNative=xE,l.isNil=OE,l.isNull=AE,l.isNumber=lp,l.isObject=xe,l.isObjectLike=Ae,l.isPlainObject=ji,l.isRegExp=gu,l.isSafeInteger=RE,l.isSet=pp,l.isString=co,l.isSymbol=wt,l.isTypedArray=$n,l.isUndefined=NE,l.isWeakMap=TE,l.isWeakSet=jE,l.join=F_,l.kebabCase=E3,l.last=Nt,l.lastIndexOf=L_,l.lowerCase=C3,l.lowerFirst=I3,l.lt=zE,l.lte=qE,l.max=m1,l.maxBy=w1,l.mean=b1,l.meanBy=_1,l.min=E1,l.minBy=C1,l.stubArray=Eu,l.stubFalse=Cu,l.stubObject=c1,l.stubString=h1,l.stubTrue=l1,l.multiply=I1,l.nth=U_,l.noConflict=t1,l.noop=_u,l.now=so,l.pad=P3,l.padEnd=S3,l.padStart=x3,l.parseInt=A3,l.random=y3,l.reduce=k0,l.reduceRight=B0,l.repeat=O3,l.replace=R3,l.result=u3,l.round=P1,l.runInContext=w,l.sample=H0,l.size=W0,l.snakeCase=N3,l.some=Q0,l.sortedIndex=K_,l.sortedIndexBy=G_,l.sortedIndexOf=W_,l.sortedLastIndex=Q_,l.sortedLastIndexBy=Y_,l.sortedLastIndexOf=J_,l.startCase=j3,l.startsWith=z3,l.subtract=S1,l.sum=x1,l.sumBy=A1,l.template=q3,l.times=p1,l.toFinite=dr,l.toInteger=se,l.toLength=dp,l.toLower=F3,l.toNumber=Tt,l.toSafeInteger=FE,l.toString=De,l.toUpper=L3,l.trim=U3,l.trimEnd=M3,l.trimStart=$3,l.truncate=k3,l.unescape=B3,l.uniqueId=d1,l.upperCase=V3,l.upperFirst=yu,l.each=ep,l.eachRight=tp,l.first=Yl,bu(l,function(){var e={};return Yt(l,function(t,i){ve.call(l.prototype,i)||(e[i]=t)}),e}(),{chain:!1}),l.VERSION=s,St(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){l[e].placeholder=l}),St(["drop","take"],function(e,t){he.prototype[e]=function(i){i=i===r?1:Le(se(i),0);var u=this.__filtered__&&!t?new he(this):this.clone();return u.__filtered__?u.__takeCount__=Ye(i,u.__takeCount__):u.__views__.push({size:Ye(i,He),type:e+(u.__dir__<0?"Right":"")}),u},he.prototype[e+"Right"]=function(i){return this.reverse()[e](i).reverse()}}),St(["filter","map","takeWhile"],function(e,t){var i=t+1,u=i==Z||i==wr;he.prototype[e]=function(c){var f=this.clone();return f.__iteratees__.push({iteratee:Q(c,3),type:i}),f.__filtered__=f.__filtered__||u,f}}),St(["head","last"],function(e,t){var i="take"+(t?"Right":"");he.prototype[e]=function(){return this[i](1).value()[0]}}),St(["initial","tail"],function(e,t){var i="drop"+(t?"":"Right");he.prototype[e]=function(){return this.__filtered__?new he(this):this[i](1)}}),he.prototype.compact=function(){return this.filter(dt)},he.prototype.find=function(e){return this.filter(e).head()},he.prototype.findLast=function(e){return this.reverse().find(e)},he.prototype.invokeMap=ae(function(e,t){return typeof e=="function"?new he(this):this.map(function(i){return xi(i,e,t)})}),he.prototype.reject=function(e){return this.filter(ao(Q(e)))},he.prototype.slice=function(e,t){e=se(e);var i=this;return i.__filtered__&&(e>0||t<0)?new he(i):(e<0?i=i.takeRight(-e):e&&(i=i.drop(e)),t!==r&&(t=se(t),i=t<0?i.dropRight(-t):i.take(t-e)),i)},he.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},he.prototype.toArray=function(){return this.take(He)},Yt(he.prototype,function(e,t){var i=/^(?:filter|find|map|reject)|While$/.test(t),u=/^(?:head|last)$/.test(t),c=l[u?"take"+(t=="last"?"Right":""):t],f=u||/^find/.test(t);c&&(l.prototype[t]=function(){var D=this.__wrapped__,y=u?[1]:arguments,_=D instanceof he,O=y[0],R=_||te(D),j=function(ue){var fe=c.apply(l,Sr([ue],y));return u&&L?fe[0]:fe};R&&i&&typeof O=="function"&&O.length!=1&&(_=R=!1);var L=this.__chain__,V=!!this.__actions__.length,Y=f&&!L,oe=_&&!V;if(!f&&R){D=oe?D:new he(this);var J=e.apply(D,y);return J.__actions__.push({func:no,args:[j],thisArg:r}),new At(J,L)}return Y&&oe?e.apply(this,y):(J=this.thru(j),Y?u?J.value()[0]:J.value():J)})}),St(["pop","push","shift","sort","splice","unshift"],function(e){var t=As[e],i=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",u=/^(?:pop|shift)$/.test(e);l.prototype[e]=function(){var c=arguments;if(u&&!this.__chain__){var f=this.value();return t.apply(te(f)?f:[],c)}return this[i](function(D){return t.apply(te(D)?D:[],c)})}}),Yt(he.prototype,function(e,t){var i=l[t];if(i){var u=i.name+"";ve.call(qn,u)||(qn[u]=[]),qn[u].push({name:t,func:i})}}),qn[Ys(r,K).name]=[{name:"wrapper",func:r}],he.prototype.clone=Bw,he.prototype.reverse=Vw,he.prototype.value=Hw,l.prototype.at=w0,l.prototype.chain=b0,l.prototype.commit=_0,l.prototype.next=E0,l.prototype.plant=I0,l.prototype.reverse=P0,l.prototype.toJSON=l.prototype.valueOf=l.prototype.value=S0,l.prototype.first=l.prototype.head,bi&&(l.prototype[bi]=C0),l},Tn=_w();Oe?((Oe.exports=Tn)._=Tn,be._=Tn):pe._=Tn}).call(si)})(Lo,Lo.exports);var Cm=Object.defineProperty,Im=Object.defineProperties,Pm=Object.getOwnPropertyDescriptors,fh=Object.getOwnPropertySymbols,Sm=Object.prototype.hasOwnProperty,xm=Object.prototype.propertyIsEnumerable,dh=(o,n,r)=>n in o?Cm(o,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[n]=r,Xi=(o,n)=>{for(var r in n||(n={}))Sm.call(n,r)&&dh(o,r,n[r]);if(fh)for(var r of fh(n))xm.call(n,r)&&dh(o,r,n[r]);return o},Am=(o,n)=>Im(o,Pm(n));function mr(o,n,r){var s;const a=d8(o);return((s=n.rpcMap)==null?void 0:s[a.reference])||`${Em}?chainId=${a.namespace}:${a.reference}&projectId=${r}`}function kr(o){return o.includes(":")?o.split(":")[1]:o}function gh(o){return o.map(n=>`${n.split(":")[0]}:${n.split(":")[1]}`)}function Om(o,n){const r=Object.keys(n.namespaces).filter(a=>a.includes(o));if(!r.length)return[];const s=[];return r.forEach(a=>{const h=n.namespaces[a].accounts;s.push(...h)}),s}function Rm(o={},n={}){const r=Dh(o),s=Dh(n);return Lo.exports.merge(r,s)}function Dh(o){var n,r,s,a;const h={};if(!fo(o))return h;for(const[p,d]of Object.entries(o)){const m=$p(p)?[p]:d.chains,v=d.methods||[],E=d.events||[],C=d.rpcMap||{},S=Fi(p);h[S]=Am(Xi(Xi({},h[S]),d),{chains:Au(m,(n=h[S])==null?void 0:n.chains),methods:Au(v,(r=h[S])==null?void 0:r.methods),events:Au(E,(s=h[S])==null?void 0:s.events),rpcMap:Xi(Xi({},C),(a=h[S])==null?void 0:a.rpcMap)})}return h}function Nm(o){return o.includes(":")?o.split(":")[2]:o}function Tm(o){const n={};for(const[r,s]of Object.entries(o)){const a=s.methods||[],h=s.events||[],p=s.accounts||[],d=$p(r)?[r]:s.chains?s.chains:gh(s.accounts);n[r]={chains:d,methods:a,events:h,accounts:p}}return n}function Uo(o){return typeof o=="number"?o:o.includes("0x")?parseInt(o,16):o.includes(":")?Number(o.split(":")[1]):Number(o)}const vh={},Ie=o=>vh[o],Mo=(o,n)=>{vh[o]=n};class jm{constructor(n){this.name="polkadot",this.namespace=n.namespace,this.events=Ie("events"),this.client=Ie("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(n){this.namespace=Object.assign(this.namespace,n)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const n=this.namespace.chains[0];if(!n)throw new Error("ChainId not found");return n.split(":")[1]}request(n){return this.namespace.methods.includes(n.request.method)?this.client.request(n):this.getHttpProvider().request(n.request)}setDefaultChain(n,r){this.httpProviders[n]||this.setHttpProvider(n,r),this.chainId=n,this.events.emit(rr.DEFAULT_CHAIN_CHANGED,`${this.name}:${n}`)}getAccounts(){const n=this.namespace.accounts;return n?n.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const n={};return this.namespace.chains.forEach(r=>{var s;const a=kr(r);n[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[r])}),n}getHttpProvider(){const n=`${this.name}:${this.chainId}`,r=this.httpProviders[n];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${n} not found`);return r}setHttpProvider(n,r){const s=this.createHttpProvider(n,r);s&&(this.httpProviders[n]=s)}createHttpProvider(n,r){const s=r||mr(n,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${n}`);return new Dr(new Lr(s,Ie("disableProviderPing")))}}class zm{constructor(n){this.name="eip155",this.namespace=n.namespace,this.events=Ie("events"),this.client=Ie("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(n){switch(n.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(n);case"eth_chainId":return parseInt(this.getDefaultChain())}return this.namespace.methods.includes(n.request.method)?await this.client.request(n):this.getHttpProvider().request(n.request)}updateNamespace(n){this.namespace=Object.assign(this.namespace,n)}setDefaultChain(n,r){this.httpProviders[n]||this.setHttpProvider(parseInt(n),r),this.chainId=parseInt(n),this.events.emit(rr.DEFAULT_CHAIN_CHANGED,`${this.name}:${n}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const n=this.namespace.chains[0];if(!n)throw new Error("ChainId not found");return n.split(":")[1]}createHttpProvider(n,r){const s=r||mr(`${this.name}:${n}`,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${n}`);return new Dr(new Lr(s,Ie("disableProviderPing")))}setHttpProvider(n,r){const s=this.createHttpProvider(n,r);s&&(this.httpProviders[n]=s)}createHttpProviders(){const n={};return this.namespace.chains.forEach(r=>{var s;const a=parseInt(kr(r));n[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[r])}),n}getAccounts(){const n=this.namespace.accounts;return n?[...new Set(n.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}getHttpProvider(){const n=this.chainId,r=this.httpProviders[n];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${n} not found`);return r}async handleSwitchChain(n){var r,s;let a=n.request.params?(r=n.request.params[0])==null?void 0:r.chainId:"0x0";a=a.startsWith("0x")?a:`0x${a}`;const h=parseInt(a,16);if(this.isChainApproved(h))this.setDefaultChain(`${h}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:n.topic,request:{method:n.request.method,params:[{chainId:a}]},chainId:(s=this.namespace.chains)==null?void 0:s[0]}),this.setDefaultChain(`${h}`);else throw new Error(`Failed to switch to chain 'eip155:${h}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(n){return this.namespace.chains.includes(`${this.name}:${n}`)}}class qm{constructor(n){this.name="solana",this.namespace=n.namespace,this.events=Ie("events"),this.client=Ie("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(n){this.namespace=Object.assign(this.namespace,n)}requestAccounts(){return this.getAccounts()}request(n){return this.namespace.methods.includes(n.request.method)?this.client.request(n):this.getHttpProvider().request(n.request)}setDefaultChain(n,r){this.httpProviders[n]||this.setHttpProvider(n,r),this.chainId=n,this.events.emit(rr.DEFAULT_CHAIN_CHANGED,`${this.name}:${n}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const n=this.namespace.chains[0];if(!n)throw new Error("ChainId not found");return n.split(":")[1]}getAccounts(){const n=this.namespace.accounts;return n?[...new Set(n.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const n={};return this.namespace.chains.forEach(r=>{var s;const a=kr(r);n[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[r])}),n}getHttpProvider(){const n=`${this.name}:${this.chainId}`,r=this.httpProviders[n];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${n} not found`);return r}setHttpProvider(n,r){const s=this.createHttpProvider(n,r);s&&(this.httpProviders[n]=s)}createHttpProvider(n,r){const s=r||mr(n,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${n}`);return new Dr(new Lr(s,Ie("disableProviderPing")))}}class Fm{constructor(n){this.name="cosmos",this.namespace=n.namespace,this.events=Ie("events"),this.client=Ie("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(n){this.namespace=Object.assign(this.namespace,n)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const n=this.namespace.chains[0];if(!n)throw new Error("ChainId not found");return n.split(":")[1]}request(n){return this.namespace.methods.includes(n.request.method)?this.client.request(n):this.getHttpProvider().request(n.request)}setDefaultChain(n,r){this.httpProviders[n]||this.setHttpProvider(n,r),this.chainId=n,this.events.emit(rr.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const n=this.namespace.accounts;return n?[...new Set(n.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const n={};return this.namespace.chains.forEach(r=>{var s;const a=kr(r);n[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[r])}),n}getHttpProvider(){const n=`${this.name}:${this.chainId}`,r=this.httpProviders[n];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${n} not found`);return r}setHttpProvider(n,r){const s=this.createHttpProvider(n,r);s&&(this.httpProviders[n]=s)}createHttpProvider(n,r){const s=r||mr(n,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${n}`);return new Dr(new Lr(s,Ie("disableProviderPing")))}}class Lm{constructor(n){this.name="cip34",this.namespace=n.namespace,this.events=Ie("events"),this.client=Ie("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(n){this.namespace=Object.assign(this.namespace,n)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const n=this.namespace.chains[0];if(!n)throw new Error("ChainId not found");return n.split(":")[1]}request(n){return this.namespace.methods.includes(n.request.method)?this.client.request(n):this.getHttpProvider().request(n.request)}setDefaultChain(n,r){this.httpProviders[n]||this.setHttpProvider(n,r),this.chainId=n,this.events.emit(rr.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const n=this.namespace.accounts;return n?[...new Set(n.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const n={};return this.namespace.chains.forEach(r=>{const s=this.getCardanoRPCUrl(r),a=kr(r);n[a]=this.createHttpProvider(a,s)}),n}getHttpProvider(){const n=`${this.name}:${this.chainId}`,r=this.httpProviders[n];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${n} not found`);return r}getCardanoRPCUrl(n){const r=this.namespace.rpcMap;if(r)return r[n]}setHttpProvider(n,r){const s=this.createHttpProvider(n,r);s&&(this.httpProviders[n]=s)}createHttpProvider(n,r){const s=r||this.getCardanoRPCUrl(n);if(!s)throw new Error(`No RPC url provided for chainId: ${n}`);return new Dr(new Lr(s,Ie("disableProviderPing")))}}class Um{constructor(n){this.name="elrond",this.namespace=n.namespace,this.events=Ie("events"),this.client=Ie("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(n){this.namespace=Object.assign(this.namespace,n)}requestAccounts(){return this.getAccounts()}request(n){return this.namespace.methods.includes(n.request.method)?this.client.request(n):this.getHttpProvider().request(n.request)}setDefaultChain(n,r){this.httpProviders[n]||this.setHttpProvider(n,r),this.chainId=n,this.events.emit(rr.DEFAULT_CHAIN_CHANGED,`${this.name}:${n}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const n=this.namespace.chains[0];if(!n)throw new Error("ChainId not found");return n.split(":")[1]}getAccounts(){const n=this.namespace.accounts;return n?[...new Set(n.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const n={};return this.namespace.chains.forEach(r=>{var s;const a=kr(r);n[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[r])}),n}getHttpProvider(){const n=`${this.name}:${this.chainId}`,r=this.httpProviders[n];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${n} not found`);return r}setHttpProvider(n,r){const s=this.createHttpProvider(n,r);s&&(this.httpProviders[n]=s)}createHttpProvider(n,r){const s=r||mr(n,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${n}`);return new Dr(new Lr(s,Ie("disableProviderPing")))}}class Mm{constructor(n){this.name="multiversx",this.namespace=n.namespace,this.events=Ie("events"),this.client=Ie("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(n){this.namespace=Object.assign(this.namespace,n)}requestAccounts(){return this.getAccounts()}request(n){return this.namespace.methods.includes(n.request.method)?this.client.request(n):this.getHttpProvider().request(n.request)}setDefaultChain(n,r){this.httpProviders[n]||this.setHttpProvider(n,r),this.chainId=n,this.events.emit(rr.DEFAULT_CHAIN_CHANGED,`${this.name}:${n}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const n=this.namespace.chains[0];if(!n)throw new Error("ChainId not found");return n.split(":")[1]}getAccounts(){const n=this.namespace.accounts;return n?[...new Set(n.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const n={};return this.namespace.chains.forEach(r=>{var s;const a=kr(r);n[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[r])}),n}getHttpProvider(){const n=`${this.name}:${this.chainId}`,r=this.httpProviders[n];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${n} not found`);return r}setHttpProvider(n,r){const s=this.createHttpProvider(n,r);s&&(this.httpProviders[n]=s)}createHttpProvider(n,r){const s=r||mr(n,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${n}`);return new Dr(new Lr(s,Ie("disableProviderPing")))}}class $m{constructor(n){this.name="near",this.namespace=n.namespace,this.events=Ie("events"),this.client=Ie("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(n){this.namespace=Object.assign(this.namespace,n)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const n=this.namespace.chains[0];if(!n)throw new Error("ChainId not found");return n.split(":")[1]}request(n){return this.namespace.methods.includes(n.request.method)?this.client.request(n):this.getHttpProvider().request(n.request)}setDefaultChain(n,r){if(this.chainId=n,!this.httpProviders[n]){const s=r||mr(`${this.name}:${n}`,this.namespace);if(!s)throw new Error(`No RPC url provided for chainId: ${n}`);this.setHttpProvider(n,s)}this.events.emit(rr.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const n=this.namespace.accounts;return n?n.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const n={};return this.namespace.chains.forEach(r=>{var s;n[r]=this.createHttpProvider(r,(s=this.namespace.rpcMap)==null?void 0:s[r])}),n}getHttpProvider(){const n=`${this.name}:${this.chainId}`,r=this.httpProviders[n];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${n} not found`);return r}setHttpProvider(n,r){const s=this.createHttpProvider(n,r);s&&(this.httpProviders[n]=s)}createHttpProvider(n,r){const s=r||mr(n,this.namespace);return typeof s>"u"?void 0:new Dr(new Lr(s,Ie("disableProviderPing")))}}var km=Object.defineProperty,Bm=Object.defineProperties,Vm=Object.getOwnPropertyDescriptors,yh=Object.getOwnPropertySymbols,Hm=Object.prototype.hasOwnProperty,Km=Object.prototype.propertyIsEnumerable,mh=(o,n,r)=>n in o?km(o,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[n]=r,Zi=(o,n)=>{for(var r in n||(n={}))Hm.call(n,r)&&mh(o,r,n[r]);if(yh)for(var r of yh(n))Km.call(n,r)&&mh(o,r,n[r]);return o},$o=(o,n)=>Bm(o,Vm(n));class ko{constructor(n){this.events=new Pu,this.rpcProviders={},this.shouldAbortPairingAttempt=!1,this.maxPairingAttempts=10,this.disableProviderPing=!1,this.providerOpts=n,this.logger=typeof n?.logger<"u"&&typeof n?.logger!="string"?n.logger:ce.pino(ce.getDefaultLoggerOptions({level:n?.logger||lh})),this.disableProviderPing=n?.disableProviderPing||!1}static async init(n){const r=new ko(n);return await r.initialize(),r}async request(n,r){const[s,a]=this.validateChain(r);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(s).request({request:Zi({},n),chainId:`${s}:${a}`,topic:this.session.topic})}sendAsync(n,r,s){const a=new Date().getTime();this.request(n,s).then(h=>r(null,mm(a,h))).catch(h=>r(h,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var n;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(n=this.session)==null?void 0:n.topic,reason:Xe("USER_DISCONNECTED")}),await this.cleanup()}async connect(n){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(n),await this.cleanupPendingPairings(),!n.skipPairing)return await this.pair(n.pairingTopic)}on(n,r){this.events.on(n,r)}once(n,r){this.events.once(n,r)}removeListener(n,r){this.events.removeListener(n,r)}off(n,r){this.events.off(n,r)}get isWalletConnect(){return!0}async pair(n){this.shouldAbortPairingAttempt=!1;let r=0;do{if(this.shouldAbortPairingAttempt)throw new Error("Pairing aborted");if(r>=this.maxPairingAttempts)throw new Error("Max auto pairing attempts reached");const{uri:s,approval:a}=await this.client.connect({pairingTopic:n,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});s&&(this.uri=s,this.events.emit("display_uri",s)),await a().then(h=>{this.session=h,this.namespaces||(this.namespaces=Tm(h.namespaces),this.persist("namespaces",this.namespaces))}).catch(h=>{if(h.message!==uh)throw h;r++})}while(!this.session);return this.onConnect(),this.session}setDefaultChain(n,r){try{if(!this.session)return;const[s,a]=this.validateChain(n);this.getProvider(s).setDefaultChain(a,r)}catch(s){if(!/Please call connect/.test(s.message))throw s}}async cleanupPendingPairings(n={}){this.logger.info("Cleaning up inactive pairings...");const r=this.client.pairing.getAll();if(Kn(r)){for(const s of r)n.deletePairings?this.client.core.expirer.set(s.topic,0):await this.client.core.relayer.subscriber.unsubscribe(s.topic);this.logger.info(`Inactive pairings cleared: ${r.length}`)}}abortPairingAttempt(){this.shouldAbortPairingAttempt=!0}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces"),this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const n=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[n]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await ym.init({logger:this.providerOpts.logger||lh,relayUrl:this.providerOpts.relayUrl||wm,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const n=[...new Set(Object.keys(this.session.namespaces).map(r=>Fi(r)))];Mo("client",this.client),Mo("events",this.events),Mo("disableProviderPing",this.disableProviderPing),n.forEach(r=>{if(!this.session)return;const s=Om(r,this.session),a=gh(s),h=Rm(this.namespaces,this.optionalNamespaces),p=$o(Zi({},h[r]),{accounts:s,chains:a});switch(r){case"eip155":this.rpcProviders[r]=new zm({namespace:p});break;case"solana":this.rpcProviders[r]=new qm({namespace:p});break;case"cosmos":this.rpcProviders[r]=new Fm({namespace:p});break;case"polkadot":this.rpcProviders[r]=new jm({namespace:p});break;case"cip34":this.rpcProviders[r]=new Lm({namespace:p});break;case"elrond":this.rpcProviders[r]=new Um({namespace:p});break;case"multiversx":this.rpcProviders[r]=new Mm({namespace:p});break;case"near":this.rpcProviders[r]=new $m({namespace:p});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",n=>{this.events.emit("session_ping",n)}),this.client.on("session_event",n=>{const{params:r}=n,{event:s}=r;if(s.name==="accountsChanged"){const a=s.data;a&&Kn(a)&&this.events.emit("accountsChanged",a.map(Nm))}else if(s.name==="chainChanged"){const a=r.chainId,h=r.event.data,p=Fi(a),d=Uo(a)!==Uo(h)?`${p}:${Uo(h)}`:a;this.onChainChanged(d)}else this.events.emit(s.name,s.data);this.events.emit("session_event",n)}),this.client.on("session_update",({topic:n,params:r})=>{var s;const{namespaces:a}=r,h=(s=this.client)==null?void 0:s.session.get(n);this.session=$o(Zi({},h),{namespaces:a}),this.onSessionUpdate(),this.events.emit("session_update",{topic:n,params:r})}),this.client.on("session_delete",async n=>{await this.cleanup(),this.events.emit("session_delete",n),this.events.emit("disconnect",$o(Zi({},Xe("USER_DISCONNECTED")),{data:n.topic}))}),this.on(rr.DEFAULT_CHAIN_CHANGED,n=>{this.onChainChanged(n,!0)})}getProvider(n){if(!this.rpcProviders[n])throw new Error(`Provider not found: ${n}`);return this.rpcProviders[n]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(n=>{var r;this.getProvider(n).updateNamespace((r=this.session)==null?void 0:r.namespaces[n])})}setNamespaces(n){const{namespaces:r,optionalNamespaces:s,sessionProperties:a}=n;r&&Object.keys(r).length&&(this.namespaces=r),s&&Object.keys(s).length&&(this.optionalNamespaces=s),this.sessionProperties=a,this.persist("namespaces",r),this.persist("optionalNamespaces",s)}validateChain(n){const[r,s]=n?.split(":")||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[r,s];if(r&&!Object.keys(this.namespaces||{}).map(p=>Fi(p)).includes(r))throw new Error(`Namespace '${r}' is not configured. Please call connect() first with namespace config.`);if(r&&s)return[r,s];const a=Fi(Object.keys(this.namespaces)[0]),h=this.rpcProviders[a].getDefaultChain();return[a,h]}async requestAccounts(){const[n]=this.validateChain();return await this.getProvider(n).requestAccounts()}onChainChanged(n,r=!1){var s;if(!this.namespaces)return;const[a,h]=this.validateChain(n);r||this.getProvider(a).setDefaultChain(h),((s=this.namespaces[a])!=null?s:this.namespaces[`${a}:${h}`]).defaultChain=h,this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",h)}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,this.persist("namespaces",void 0),this.persist("optionalNamespaces",void 0),this.persist("sessionProperties",void 0),await this.cleanupPendingPairings({deletePairings:!0})}persist(n,r){this.client.core.storage.setItem(`${ph}/${n}`,r)}async getFromStore(n){return await this.client.core.storage.getItem(`${ph}/${n}`)}}let wh,bh,_h,Eh,Ch;wh=ko,bh="wc",_h="ethereum_provider",Eh=`${bh}@2:${_h}:`,Ch="https://rpc.walletconnect.com/v1/",Mi=["eth_sendTransaction","personal_sign"],zu=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"],Ui=["chainChanged","accountsChanged"],ju=["chainChanged","accountsChanged","message","disconnect","connect"];var Gm=Object.defineProperty,Wm=Object.defineProperties,Qm=Object.getOwnPropertyDescriptors,Ih=Object.getOwnPropertySymbols,Ym=Object.prototype.hasOwnProperty,Jm=Object.prototype.propertyIsEnumerable,Ph=(o,n,r)=>n in o?Gm(o,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[n]=r,oi=(o,n)=>{for(var r in n||(n={}))Ym.call(n,r)&&Ph(o,r,n[r]);if(Ih)for(var r of Ih(n))Jm.call(n,r)&&Ph(o,r,n[r]);return o},Sh=(o,n)=>Wm(o,Qm(n));function es(o){return Number(o[0].split(":")[1])}function Bo(o){return`0x${o.toString(16)}`}function Xm(o){const{chains:n,optionalChains:r,methods:s,optionalMethods:a,events:h,optionalEvents:p,rpcMap:d}=o;if(!Kn(n))throw new Error("Invalid chains");const m={chains:n,methods:s||Mi,events:h||Ui,rpcMap:oi({},n.length?{[es(n)]:d[es(n)]}:{})},v=h?.filter(z=>!Ui.includes(z)),E=s?.filter(z=>!Mi.includes(z));if(!r&&!p&&!a&&!(v!=null&&v.length)&&!(E!=null&&E.length))return{required:n.length?m:void 0};const C=v?.length&&E?.length||!r,S={chains:[...new Set(C?m.chains.concat(r||[]):r)],methods:[...new Set(m.methods.concat(a!=null&&a.length?a:zu))],events:[...new Set(m.events.concat(p!=null&&p.length?p:ju))],rpcMap:d};return{required:n.length?m:void 0,optional:r.length?S:void 0}}Do=class{constructor(){this.events=new Zt.EventEmitter,this.namespace="eip155",this.accounts=[],this.chainId=1,this.STORAGE_KEY=Eh,this.on=(o,n)=>(this.events.on(o,n),this),this.once=(o,n)=>(this.events.once(o,n),this),this.removeListener=(o,n)=>(this.events.removeListener(o,n),this),this.off=(o,n)=>(this.events.off(o,n),this),this.parseAccount=o=>this.isCompatibleChainId(o)?this.parseAccountId(o).address:o,this.signer={},this.rpc={}}static async init(o){const n=new Do;return await n.initialize(o),n}async request(o){return await this.signer.request(o,this.formatChainId(this.chainId))}sendAsync(o,n){this.signer.sendAsync(o,n,this.formatChainId(this.chainId))}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(o){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(o);const{required:n,optional:r}=Xm(this.rpc);try{const s=await new Promise(async(h,p)=>{var d;this.rpc.showQrModal&&((d=this.modal)==null||d.subscribeModal(m=>{!m.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),p(new Error("Connection request reset. Please try again.")))})),await this.signer.connect(Sh(oi({namespaces:oi({},n&&{[this.namespace]:n})},r&&{optionalNamespaces:{[this.namespace]:r}}),{pairingTopic:o?.pairingTopic})).then(m=>{h(m)}).catch(m=>{p(new Error(m.message))})});if(!s)return;const a=g8(s.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:a),this.setAccounts(a),this.events.emit("connect",{chainId:Bo(this.chainId)})}catch(s){throw this.signer.logger.error(s),s}finally{this.modal&&this.modal.closeModal()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",o=>{const{params:n}=o,{event:r}=n;r.name==="accountsChanged"?(this.accounts=this.parseAccounts(r.data),this.events.emit("accountsChanged",this.accounts)):r.name==="chainChanged"?this.setChainId(this.formatChainId(r.data)):this.events.emit(r.name,r.data),this.events.emit("session_event",o)}),this.signer.on("chainChanged",o=>{const n=parseInt(o);this.chainId=n,this.events.emit("chainChanged",Bo(this.chainId)),this.persist()}),this.signer.on("session_update",o=>{this.events.emit("session_update",o)}),this.signer.on("session_delete",o=>{this.reset(),this.events.emit("session_delete",o),this.events.emit("disconnect",Sh(oi({},Xe("USER_DISCONNECTED")),{data:o.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",o=>{var n,r;this.rpc.showQrModal&&((n=this.modal)==null||n.closeModal(),(r=this.modal)==null||r.openModal({uri:o})),this.events.emit("display_uri",o)})}switchEthereumChain(o){this.request({method:"wallet_switchEthereumChain",params:[{chainId:o.toString(16)}]})}isCompatibleChainId(o){return typeof o=="string"?o.startsWith(`${this.namespace}:`):!1}formatChainId(o){return`${this.namespace}:${o}`}parseChainId(o){return Number(o.split(":")[1])}setChainIds(o){const n=o.filter(r=>this.isCompatibleChainId(r)).map(r=>this.parseChainId(r));n.length&&(this.chainId=n[0],this.events.emit("chainChanged",Bo(this.chainId)),this.persist())}setChainId(o){if(this.isCompatibleChainId(o)){const n=this.parseChainId(o);this.chainId=n,this.switchEthereumChain(n)}}parseAccountId(o){const[n,r,s]=o.split(":");return{chainId:`${n}:${r}`,address:s}}setAccounts(o){this.accounts=o.filter(n=>this.parseChainId(this.parseAccountId(n).chainId)===this.chainId).map(n=>this.parseAccountId(n).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(o){var n,r;const s=(n=o?.chains)!=null?n:[],a=(r=o?.optionalChains)!=null?r:[],h=s.concat(a);if(!h.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const p=s.length?o?.methods||Mi:[],d=s.length?o?.events||Ui:[],m=o?.optionalMethods||[],v=o?.optionalEvents||[],E=o?.rpcMap||this.buildRpcMap(h,o.projectId),C=o?.qrModalOptions||void 0;return{chains:s?.map(S=>this.formatChainId(S)),optionalChains:a.map(S=>this.formatChainId(S)),methods:p,events:d,optionalMethods:m,optionalEvents:v,rpcMap:E,showQrModal:!!(o!=null&&o.showQrModal),qrModalOptions:C,projectId:o.projectId,metadata:o.metadata}}buildRpcMap(o,n){const r={};return o.forEach(s=>{r[s]=this.getRpcUrl(s,n)}),r}async initialize(o){if(this.rpc=this.getRpcConfig(o),this.chainId=this.rpc.chains.length?es(this.rpc.chains):es(this.rpc.optionalChains),this.signer=await wh.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:o.disableProviderPing,relayUrl:o.relayUrl,storageOptions:o.storageOptions}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let n;try{const{WalletConnectModal:r}=await D8(()=>import("./index-62d554f0.js").then(async s=>(await s.__tla,s)).then(s=>s.i),["assets/index-62d554f0.js","assets/index-64320997.js","assets/index-a24e527b.css"]);n=r}catch{throw new Error("To use QR modal, please install @walletconnect/modal package")}if(n)try{this.modal=new n(oi({projectId:this.rpc.projectId},this.rpc.qrModalOptions))}catch(r){throw this.signer.logger.error(r),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(o){if(!o)return;const{chains:n,optionalChains:r,rpcMap:s}=o;n&&Kn(n)&&(this.rpc.chains=n.map(a=>this.formatChainId(a)),n.forEach(a=>{this.rpc.rpcMap[a]=s?.[a]||this.getRpcUrl(a)})),r&&Kn(r)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=r?.map(a=>this.formatChainId(a)),r.forEach(a=>{this.rpc.rpcMap[a]=s?.[a]||this.getRpcUrl(a)}))}getRpcUrl(o,n){var r;return((r=this.rpc.rpcMap)==null?void 0:r[o])||`${Ch}?chainId=eip155:${o}&projectId=${n||this.rpc.projectId}`}async loadPersistedSession(){if(!this.session)return;const o=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),n=this.session.namespaces[`${this.namespace}:${o}`]?this.session.namespaces[`${this.namespace}:${o}`]:this.session.namespaces[this.namespace];this.setChainIds(o?[this.formatChainId(o)]:n?.accounts),this.setAccounts(n?.accounts)}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(o){return typeof o=="string"||o instanceof String?[this.parseAccount(o)]:o.map(n=>this.parseAccount(n))}},Vp=Do});export{Vp as EthereumProvider,ju as OPTIONAL_EVENTS,zu as OPTIONAL_METHODS,Ui as REQUIRED_EVENTS,Mi as REQUIRED_METHODS,b8 as __tla,Do as default};
